# Internationalization (i18n)

Load this document when adding or modifying user-facing strings or translation files.

---

## Guidelines

- **NEVER use hardcoded text** for user-facing strings in frontend or backend
- **ALWAYS use the translation system** for all user-facing content
- **Source of Truth**: `.yml` files in `frontend/packages/ui/src/i18n/sources/`

---

## Adding Translations (CRITICAL - READ CAREFULLY)

**FLAT KEYS ONLY - NEVER USE NESTED YAML STRUCTURES**

Translation files use **dot notation IN THE KEY NAME** as a flat structure. Each translation entry is a top-level key.

```yaml
# ✅ CORRECT - flat keys with dots in the key name
button.submit:
  context: Submit button text
  en: Submit
  de: Absenden

button.cancel:
  context: Cancel button text
  en: Cancel
  de: Abbrechen

dialog.title:
  context: Dialog title
  en: Confirm Action
  de: Aktion bestätigen
```

```yaml
# ❌ WRONG - nested YAML structure (NEVER DO THIS)
button:
  submit:
    context: Submit button text
    en: Submit
    de: Absenden
  cancel:
    context: Cancel button text
    en: Cancel
    de: Abbrechen

dialog:
  title:
    context: Dialog title
    en: Confirm Action
    de: Aktion bestätigen
```

**Why this matters:** Nested structures break the translation build system. The key `button.submit` is looked up as a literal string, not as `button` → `submit`.

---

## Translation Entry Structure

Every translation entry MUST have this exact structure:

```yaml
key_name:
  context: Description of how/where the text is used
  en: English text
  de: German translation
  # ... other languages
  verified_by_human: []
```

---

## Generated Files - DO NOT Commit

The JSON files in `frontend/packages/ui/src/i18n/locales/*.json` are **generated build artifacts** produced by `npm run build:translations`. They are already in `.gitignore`.

- **NEVER edit** the `locales/*.json` files directly — they will be overwritten on the next build
- **NEVER commit** them to git (even with `git add -f`)
- **Only edit** the source `.yml` files in `frontend/packages/ui/src/i18n/sources/`

---

## Adding New Translations - Step by Step

1. Open the appropriate `.yml` file in `frontend/packages/ui/src/i18n/sources/`
2. Add your new key as a **top-level entry** (not nested under another key)
3. Include `context`, `en`, and ideally `de` at minimum
4. Run `npm run build:translations` in `frontend/packages/ui`

---

## Usage

- **Frontend**: Use the `$text` store: `$text('filename.key_name')` (e.g., `$text('chats.context_menu.download')`)
- **Backend**: Use `TranslationService` to resolve translations
- **Metadata**: Use `name_translation_key` instead of hardcoded strings