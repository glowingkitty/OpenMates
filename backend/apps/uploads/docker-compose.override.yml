# backend/apps/uploads/docker-compose.override.yml
#
# Development overrides for the uploads service.
# Applied automatically when running docker compose from the uploads directory on the dev server.
#
# KEY DIFFERENCES FROM PRODUCTION:
#   - app-uploads joins the 'openmates' Docker network (core stack) so that
#     CORE_API_URL=http://api:8000 resolves via Docker DNS.
#   - Port 8004 is exposed on localhost so Caddy can proxy /api/uploads/* to it.
#   - vault-setup-data volume is shared from the core stack (external: true in docker-compose.yml).
#
# On the production uploads VM, NONE of these overrides are needed:
#   - Use CORE_API_URL=<private_IP_of_api_server> instead of Docker DNS.
#   - Do not expose port 8004; the uploads VM is accessed via upload.openmates.org (Caddy on that VM).

services:
  app-uploads:
    ports:
      # Expose on localhost only â€” Caddy on this server proxies /api/uploads/* to this port.
      # Port 8004 chosen to avoid conflict with main API (8000) and other local services.
      - "127.0.0.1:8004:8000"
    networks:
      # Also join the shared 'openmates' network so Docker DNS resolves api, cms, vault
      - openmates

networks:
  openmates:
    # Must be declared as external here to reference the core stack's network
    external: true
    name: openmates
