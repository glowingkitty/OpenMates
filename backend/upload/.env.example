# backend/upload/.env.example
#
# Environment variables for the OpenMates Upload Server (dedicated VM).
# Copy this file to .env in the same directory and fill in all <PLACEHOLDER> values.
#
#   cp .env.example .env
#   nano .env
#
# On the upload VM, docker-compose.prod.yml overrides env_file to point here.
# On dev, the project root .env is used instead (via the base docker-compose.yml).
#
# This upload server handles requests from BOTH the dev and prod frontends.
# Caddy injects an X-Target-Env header ("dev" or "prod") based on which domain
# the request arrived on. FastAPI reads this header and selects the correct
# CORE_API_URL and INTERNAL_API_SHARED_TOKEN pair to use for that request.
#
# See docs/architecture/file-upload-pipeline.md for full documentation.

# ---------------------------------------------------------------------------
# Production core API connection
# ---------------------------------------------------------------------------
# Private IP of the production API server (internal network).
PROD_CORE_API_URL=http://<PROD_SERVER_PRIVATE_IP>:8000

# Shared secret for prod service-to-service auth.
# Must match INTERNAL_API_SHARED_TOKEN on the production API server.
PROD_INTERNAL_API_SHARED_TOKEN=<PROD_SHARED_SECRET>

# ---------------------------------------------------------------------------
# Dev core API connection
# ---------------------------------------------------------------------------
# Private IP of the dev API server (internal network).
DEV_CORE_API_URL=http://<DEV_SERVER_PRIVATE_IP>:8000

# Shared secret for dev service-to-service auth.
# Must match INTERNAL_API_SHARED_TOKEN on the dev API server.
DEV_INTERNAL_API_SHARED_TOKEN=<DEV_SHARED_SECRET>

# ---------------------------------------------------------------------------
# Local Vault
# ---------------------------------------------------------------------------
# Root token for the local Vault instance (dev mode, in-memory).
# Auto-generated by cloud-init: python3 -c "import uuid; print(uuid.uuid4())"
# This token is only used locally by vault-setup to populate the Vault.
UPLOADS_VAULT_ROOT_TOKEN=<RANDOM_UUID>

# ---------------------------------------------------------------------------
# S3 Object Storage credentials
# ---------------------------------------------------------------------------
# These are migrated into the local Vault by vault-setup on startup.
# The upload service reads them from Vault at runtime (not from env vars directly).
SECRET__HETZNER__S3_ACCESS_KEY=<S3_ACCESS_KEY>
SECRET__HETZNER__S3_SECRET_KEY=<S3_SECRET_KEY>
SECRET__HETZNER__S3_REGION_NAME=<S3_REGION>

# ---------------------------------------------------------------------------
# SightEngine AI detection (optional)
# ---------------------------------------------------------------------------
# Used to detect AI-generated images. If not set, AI detection is disabled
# and uploads proceed without this check.
SECRET__SIGHTENGINE__API_USER=<SIGHTENGINE_USER>
SECRET__SIGHTENGINE__API_SECRET=<SIGHTENGINE_SECRET>

# ---------------------------------------------------------------------------
# Runtime configuration
# ---------------------------------------------------------------------------
SERVER_ENVIRONMENT=production
LOG_LEVEL=info
