# backend/upload/docker-compose.prod.yml
#
# Production overrides for the uploads service on the dedicated upload VM.
#
# USAGE (on the upload VM):
#   cd ~/projects/OpenMates
#   docker compose -f backend/upload/docker-compose.yml \
#                  -f backend/upload/docker-compose.prod.yml up -d
#
# WHY THIS EXISTS:
#   The base docker-compose.yml does NOT expose any ports (by design — the dev
#   override exposes port 8004 for the dev server where the main API already
#   occupies port 8000). On the dedicated upload VM, there is no main API, so
#   we expose port 8000 on localhost for Caddy to proxy to.
#
#   The base file also uses env_file: ../../.env (project root .env, shared with
#   the core stack on dev). On the upload VM, we override this to use a local
#   .env file at backend/upload/.env (upload-specific credentials only).
#
# WHAT THIS DOES:
#   - Exposes app-uploads on 127.0.0.1:8000 (localhost only — Caddy proxies to it)
#   - Points env_file to the local .env (not the project root)
#   - Does NOT join any external Docker network (no Docker DNS needed on prod —
#     CORE_API_URL points to the main server's private IP directly)

services:
  vault-setup:
    # Override env_file to use the upload-specific .env (not the project root .env)
    env_file: .env

  app-uploads:
    # Override env_file to use the upload-specific .env (not the project root .env)
    env_file: .env
    ports:
      # Expose on localhost only — Caddy on this VM proxies to this port.
      # Only accessible from the VM itself (not from the internet).
      - "127.0.0.1:8000:8000"
