chats:
  type: collection
  fields:
    id: # chat_id
      type: uuid
      note: "Primary Key - Unique identifier for the chat (chat_id)"

    hashed_user_id:
      type: string
      note: "[Hashed] Backend hashes the user's actual ID before storing/querying"

    encrypted_title:
      type: text # Suitable for potentially longer titles
      note: "[Encrypted] User-defined title of the chat, encrypted using the key from Vault"

    messages_version:
      type: integer
      note: "Version number for messages, increments when a new message is added"

    title_version:
      type: integer
      note: "Version number for the title, increments when the title is updated"

    last_edited_overall_timestamp:
      type: integer
      note: "Unix timestamp (seconds) of the most recent modification to messages or draft (not title). Used for sorting chats by recency."

    unread_count:
      type: integer
      note: "Number of unread messages in this chat for the user"

    created_at:
      type: integer
      note: "Unix timestamp (seconds) when the chat was first initiated, e.g., first draft saved"

    updated_at:
      type: integer
      note: "Unix timestamp (seconds) of the last update to metadata, draft, or addition of a message"

    last_message_timestamp:
      type: integer
      note: "Unix timestamp (seconds) of the most recent completed message, for sorting"

    encrypted_active_focus_id:
      type: string
      note: "[Encrypted] ID of the currently active focus for this chat (e.g., 'travel/plan_trip'). Encrypted with chat-specific key."