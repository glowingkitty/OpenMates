chats:
  type: collection
  fields:
    id:
      type: string
      note: "Primary Key - format: {first 8 chars of hashed user id}_{client_generated_chat_id}"

    hashed_user_id:
      type: string
      note: "[Hashed] Backend hashes the user's actual ID before storing/querying"

    vault_key_reference:
      type: string
      length: 64
      note: "Reference/Path to the chat's encryption key stored in Hashicorp Vault"

    encrypted_title:
      type: text
      note: "[Encrypted] Title for the chat, encrypted using the key from Vault"

    encrypted_draft:
      type: textfield
      note: "[Encrypted] Tiptap JSON representing the current user draft, encrypted"

    version:
      type: integer
      default: 1
      note: "Used for optimistic locking/version control of drafts and potentially titles"

    created_at:
      type: datetime
      note: "Timestamp when the chat was first initiated, e.g., first draft saved"

    updated_at:
      type: datetime
      note: "Timestamp of the last update to metadata, draft, or addition of a message"

    last_message_timestamp:
      type: datetime
      note: "Timestamp of the most recent completed message, for sorting"