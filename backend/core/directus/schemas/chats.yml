chats:
  type: collection
  fields:
    id: # chat_id
      type: string
      note: "Primary Key - Unique identifier for the chat (chat_id)"

    hashed_user_id:
      type: string
      note: "[Hashed] Backend hashes the user's actual ID before storing/querying"

    vault_key_reference:
      type: string
      length: 64 # Assuming key references are not excessively long
      note: "Reference/Path to the chat's encryption key stored in Hashicorp Vault"

    encrypted_title:
      type: text # Suitable for potentially longer titles
      note: "[Encrypted] User-defined title of the chat, encrypted using the key from Vault"

    messages_version:
      type: integer
      note: "Version number for messages, increments when a new message is added"

    title_version:
      type: integer
      note: "Version number for the title, increments when the title is updated"

    last_edited_overall_timestamp:
      type: datetime
      note: "Timestamp of the most recent modification to messages or draft (not title). Used for sorting chats by recency."

    unread_count:
      type: integer
      note: "Number of unread messages in this chat for the user"

    created_at:
      type: datetime
      note: "Timestamp when the chat was first initiated, e.g., first draft saved"

    updated_at:
      type: datetime
      note: "Timestamp of the last update to metadata, draft, or addition of a message"

    last_message_timestamp:
      type: datetime
      note: "Timestamp of the most recent completed message, for sorting"