All checks passed!
Python: ok __init__.py
E701 Multiple statements on one line (colon)
  --> backend/apps/ai/llm_providers/anthropic_bedrock.py:92:22
   |
90 |         if not anthropic_messages:
91 |             err_msg = "Message history is empty after processing."
92 |             if stream: raise ValueError(err_msg)
   |                      ^
93 |             return UnifiedAnthropicResponse(task_id=task_id, model_id=model_id, success=False, error_message=err_msg)
   |

E701 Multiple statements on one line (colon)
   --> backend/apps/ai/llm_providers/anthropic_bedrock.py:126:18
    |
124 |         err_msg = f"Error during AWS Bedrock request preparation: {e}"
125 |         logger.error(f"{log_prefix} {err_msg}", exc_info=True)
126 |         if stream: raise ValueError(err_msg)
    |                  ^
127 |         return UnifiedAnthropicResponse(task_id=task_id, model_id=model_id, success=False, error_message=err_msg)
    |

Found 2 errors.
Python: error backend/apps/ai/llm_providers/anthropic_bedrock.py
E701 Multiple statements on one line (colon)
   --> backend/apps/ai/llm_providers/anthropic_client.py:176:22
    |
174 |             error_msg = "SecretsManager not provided, and Anthropic client is not initialized."
175 |             logger.error(f"[{task_id}] {error_msg}")
176 |             if stream: raise ValueError(error_msg)
    |                      ^
177 |             return UnifiedAnthropicResponse(task_id=task_id, model_id=model_id, success=False, error_message=error_msg)
    |

E701 Multiple statements on one line (colon)
   --> backend/apps/ai/llm_providers/anthropic_client.py:182:18
    |
180 |         error_msg = "Anthropic client initialization failed. Check logs for details."
181 |         logger.error(f"[{task_id}] {error_msg}")
182 |         if stream: raise ValueError(error_msg)
    |                  ^
183 |         return UnifiedAnthropicResponse(task_id=task_id, model_id=model_id, success=False, error_message=error_msg)
    |

E701 Multiple statements on one line (colon)
   --> backend/apps/ai/llm_providers/anthropic_client.py:202:18
    |
200 |         error_msg = "No available Anthropic client (neither direct API nor AWS Bedrock)."
201 |         logger.error(f"[{task_id}] {error_msg}")
202 |         if stream: raise ValueError(error_msg)
    |                  ^
203 |         return UnifiedAnthropicResponse(task_id=task_id, model_id=model_id, success=False, error_message=error_msg)
    |

Found 3 errors.
Python: error backend/apps/ai/llm_providers/anthropic_client.py
E701 Multiple statements on one line (colon)
  --> backend/apps/ai/llm_providers/anthropic_direct_api.py:42:22
   |
40 |         if not anthropic_messages:
41 |             err_msg = "Message history is empty after processing."
42 |             if stream: raise ValueError(err_msg)
   |                      ^
43 |             return UnifiedAnthropicResponse(task_id=task_id, model_id=model_id, success=False, error_message=err_msg)
   |

E701 Multiple statements on one line (colon)
  --> backend/apps/ai/llm_providers/anthropic_direct_api.py:76:18
   |
74 |         err_msg = f"Error during direct API request preparation: {e}"
75 |         logger.error(f"{log_prefix} {err_msg}", exc_info=True)
76 |         if stream: raise ValueError(err_msg)
   |                  ^
77 |         return UnifiedAnthropicResponse(task_id=task_id, model_id=model_id, success=False, error_message=err_msg)
   |

Found 2 errors.
Python: error backend/apps/ai/llm_providers/anthropic_direct_api.py
F401 [*] `pydantic.Field` imported but unused
 --> backend/apps/ai/llm_providers/anthropic_shared.py:6:33
  |
4 | import logging
5 | from typing import Dict, Any, List, Optional, Union
6 | from pydantic import BaseModel, Field
  |                                 ^^^^^
7 |
8 | logger = logging.getLogger(__name__)
  |
help: Remove unused import: `pydantic.Field`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/apps/ai/llm_providers/anthropic_shared.py
F401 [*] `asyncio` imported but unused
  --> backend/apps/ai/llm_providers/cerebras_client.py:13:8
   |
11 | import json
12 | import httpx
13 | import asyncio
   |        ^^^^^^^
14 | from typing import Dict, Any, List, Optional, Union, AsyncIterator
15 | import time
   |
help: Remove unused import: `asyncio`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/apps/ai/llm_providers/cerebras_client.py
All checks passed!
Python: ok backend/apps/ai/llm_providers/cerebras_wrapper.py
All checks passed!
Python: ok backend/apps/ai/llm_providers/google_client.py
All checks passed!
Python: ok backend/apps/ai/llm_providers/groq_client.py
F401 [*] `os` imported but unused
  --> backend/apps/ai/llm_providers/mistral_client.py:8:8
   |
 6 | import httpx
 7 | import json
 8 | import os
   |        ^^
 9 | from pydantic import BaseModel, Field
10 | import tiktoken
   |
help: Remove unused import: `os`

F401 [*] `pydantic.Field` imported but unused
  --> backend/apps/ai/llm_providers/mistral_client.py:9:33
   |
 7 | import json
 8 | import os
 9 | from pydantic import BaseModel, Field
   |                                 ^^^^^
10 | import tiktoken
   |
help: Remove unused import: `pydantic.Field`

E701 Multiple statements on one line (colon)
   --> backend/apps/ai/llm_providers/mistral_client.py:206:52
    |
204 | …     if current_tool_function_name:
205 | …         parsed_args, err_msg = None, "Incomplete tool call"
206 | …         try: parsed_args = json.loads(current_tool_function_args_buffer)
    |              ^
207 | …         except json.JSONDecodeError as e: err_msg += f" JSONDecodeError: {e}"
208 | …         yield ParsedMistralToolCall(tool_call_id=current_tool_call_id, function_name=current_tool_function_name, function_arguments…
    |

E701 Multiple statements on one line (colon)
   --> backend/apps/ai/llm_providers/mistral_client.py:207:81
    |
205 | …         parsed_args, err_msg = None, "Incomplete tool call"
206 | …         try: parsed_args = json.loads(current_tool_function_args_buffer)
207 | …         except json.JSONDecodeError as e: err_msg += f" JSONDecodeError: {e}"
    |                                           ^
208 | …         yield ParsedMistralToolCall(tool_call_id=current_tool_call_id, function_name=current_tool_function_name, function_arguments…
209 | …     current_tool_call_id = new_tool_id
    |

Found 4 errors.
[*] 2 fixable with the `--fix` option.
Python: error backend/apps/ai/llm_providers/mistral_client.py
All checks passed!
Python: ok backend/apps/ai/llm_providers/openai_client.py
All checks passed!
Python: ok backend/apps/ai/llm_providers/openai_openrouter.py
F401 [*] `typing.Union` imported but unused
 --> backend/apps/ai/llm_providers/openai_shared.py:5:47
  |
4 | import logging
5 | from typing import Dict, Any, List, Optional, Union
  |                                               ^^^^^
6 | from pydantic import BaseModel, Field
  |
help: Remove unused import: `typing.Union`

F401 [*] `pydantic.Field` imported but unused
 --> backend/apps/ai/llm_providers/openai_shared.py:6:33
  |
4 | import logging
5 | from typing import Dict, Any, List, Optional, Union
6 | from pydantic import BaseModel, Field
  |                                 ^^^^^
7 |
8 | logger = logging.getLogger(__name__)
  |
help: Remove unused import: `pydantic.Field`

Found 2 errors.
[*] 2 fixable with the `--fix` option.
Python: error backend/apps/ai/llm_providers/openai_shared.py
F401 [*] `asyncio` imported but unused
 --> backend/apps/ai/llm_providers/openrouter_client.py:7:8
  |
5 | import json
6 | import httpx
7 | import asyncio
  |        ^^^^^^^
8 | from typing import Dict, Any, List, Optional, Union, AsyncIterator
9 | import time
  |
help: Remove unused import: `asyncio`

F841 Local variable `tc_index` is assigned to but never used
   --> backend/apps/ai/llm_providers/openrouter_client.py:418:33
    |
416 | …                     for tc_delta in delta["tool_calls"]:
417 | …                         tc_id = tc_delta.get("id", "")
418 | …                         tc_index = tc_delta.get("index", 0)
    |                           ^^^^^^^^
419 | …                         
420 | …                         # Initialize or update the tool call in the buffer
    |
help: Remove assignment to unused variable `tc_index`

Found 2 errors.
[*] 1 fixable with the `--fix` option (1 hidden fix can be enabled with the `--unsafe-fixes` option).
Python: error backend/apps/ai/llm_providers/openrouter_client.py
All checks passed!
Python: ok backend/apps/ai/processing/celery_helpers.py
F541 [*] f-string without any placeholders
   --> backend/apps/ai/processing/content_sanitization.py:175:26
    |
173 |             config = yaml.safe_load(f)
174 |         if not config:
175 |             logger.error(f"Prompt injection detection config is empty or malformed")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
176 |             return None
177 |         logger.debug(f"Successfully loaded prompt injection detection config from {config_path}")
    |
help: Remove extraneous `f` prefix

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/apps/ai/processing/content_sanitization.py
E722 Do not use bare `except`
    --> backend/apps/ai/processing/main_processor.py:1824:17
     |
1822 |                     }
1823 |                     tool_calls_info.append(tool_call_info)
1824 |                 except:
     |                 ^^^^^^
1825 |                     pass  # Don't fail if tracking fails
1826 |                 # Update embed status to error if placeholder exists
     |

E722 Do not use bare `except`
    --> backend/apps/ai/processing/main_processor.py:1865:17
     |
1863 |                         error="Invalid JSON in function arguments"
1864 |                     )
1865 |                 except:
     |                 ^^^^^^
1866 |                     pass  # Don't fail if status publish fails
1867 |             except ValueError as e:
     |

E722 Do not use bare `except`
    --> backend/apps/ai/processing/main_processor.py:1881:17
     |
1879 |                     }
1880 |                     tool_calls_info.append(tool_call_info)
1881 |                 except:
     |                 ^^^^^^
1882 |                     pass  # Don't fail if tracking fails
1883 |                 # Update embed status to error if placeholder exists
     |

E722 Do not use bare `except`
    --> backend/apps/ai/processing/main_processor.py:1897:25
     |
1895 |                         try:
1896 |                             app_id, skill_id = tool_name.split('-', 1)
1897 |                         except:
     |                         ^^^^^^
1898 |                             app_id = "unknown"
1899 |                             skill_id = "unknown"
     |

E722 Do not use bare `except`
    --> backend/apps/ai/processing/main_processor.py:1927:17
     |
1925 |                         error="Invalid tool name format"
1926 |                     )
1927 |                 except:
     |                 ^^^^^^
1928 |                     pass  # Don't fail if status publish fails
1929 |             except Exception as e:
     |

E722 Do not use bare `except`
    --> backend/apps/ai/processing/main_processor.py:1943:17
     |
1941 |                     }
1942 |                     tool_calls_info.append(tool_call_info)
1943 |                 except:
     |                 ^^^^^^
1944 |                     pass  # Don't fail if tracking fails
1945 |                 # Update embed status to error if placeholder exists
     |

E722 Do not use bare `except`
    --> backend/apps/ai/processing/main_processor.py:1984:17
     |
1982 |                         error=str(e)
1983 |                     )
1984 |                 except:
     |                 ^^^^^^
1985 |                     pass  # Don't fail if status publish fails
     |

Found 7 errors.
Python: error backend/apps/ai/processing/main_processor.py
All checks passed!
Python: ok backend/apps/ai/processing/postprocessor.py
F541 [*] f-string without any placeholders
   --> backend/apps/ai/processing/preprocessor.py:468:17
    |
466 |     logger.info(f"  - Tool to call by LLM: {tool_definition_for_llm.get('function', {}).get('name')}")
467 |     logger.info(f"  - Available app skills for tool preselection ({len(available_skills_list)} total): {', '.join(available_skills_li…
468 |     logger.info(f"  - Dynamic context for LLM prompt:")
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
469 |     logger.info(f"    - CATEGORIES_LIST: {available_categories_list}")
470 |     logger.info(f"    - AVAILABLE_APP_SKILLS: {available_skills_list if available_skills_list else 'None'}")
    |
help: Remove extraneous `f` prefix

F841 Local variable `category_was_retried` is assigned to but never used
   --> backend/apps/ai/processing/preprocessor.py:699:21
    |
697 |                     logger.info(f"{log_prefix} Retry successful! LLM returned valid category '{retry_category}'.")
698 |                     validated_category = retry_category
699 |                     category_was_retried = True
    |                     ^^^^^^^^^^^^^^^^^^^^
700 |                     # Update llm_analysis_args with the validated category for consistency
701 |                     llm_analysis_args["category"] = validated_category
    |
help: Remove assignment to unused variable `category_was_retried`

Found 2 errors.
[*] 1 fixable with the `--fix` option (1 hidden fix can be enabled with the `--unsafe-fixes` option).
Python: error backend/apps/ai/processing/preprocessor.py
F541 [*] f-string without any placeholders
   --> backend/apps/ai/processing/rate_limiting.py:135:28
    |
133 |         client = await cache_service.client
134 |         if not client:
135 |             logger.warning(f"Cache client not available for rate limit check, allowing request")
    |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
136 |             return (True, None)
    |
help: Remove extraneous `f` prefix

F401 [*] `backend.apps.ai.processing.celery_helpers.execute_skill_via_celery` imported but unused
   --> backend/apps/ai/processing/rate_limiting.py:249:71
    |
247 |         if app_id and skill_id_for_celery and arguments is not None:
248 |             try:
249 |                 from backend.apps.ai.processing.celery_helpers import execute_skill_via_celery
    |                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^
250 |                 
251 |                 # Schedule the skill execution with countdown
    |
help: Remove unused import: `backend.apps.ai.processing.celery_helpers.execute_skill_via_celery`

F841 Local variable `result` is assigned to but never used
   --> backend/apps/ai/processing/rate_limiting.py:293:17
    |
291 |                 # The followup task will receive skill_result as first argument automatically
292 |                 task_chain = chain(skill_task, followup_task)
293 |                 result = task_chain.apply_async()
    |                 ^^^^^^
294 |                 
295 |                 # Get the skill task ID (first task in chain)
    |
help: Remove assignment to unused variable `result`

F541 [*] f-string without any placeholders
   --> backend/apps/ai/processing/rate_limiting.py:309:29
    |
307 |                     task_id=skill_task_id,
308 |                     wait_time=retry_after,
309 |                     message=f"Skill execution scheduled via Celery due to rate limit"
    |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
310 |                 )
311 |             except Exception as e:
    |
help: Remove extraneous `f` prefix

Found 4 errors.
[*] 3 fixable with the `--fix` option (1 hidden fix can be enabled with the `--unsafe-fixes` option).
Python: error backend/apps/ai/processing/rate_limiting.py
F401 [*] `asyncio` imported but unused
  --> backend/apps/ai/processing/skill_executor.py:16:8
   |
14 | from typing import Dict, Any, List, Optional
15 | import httpx
16 | import asyncio
   |        ^^^^^^^
17 |
18 | logger = logging.getLogger(__name__)
   |
help: Remove unused import: `asyncio`

E402 Module level import not at top of file
  --> backend/apps/ai/processing/skill_executor.py:21:1
   |
20 |   # Import helper modules
21 | / from backend.apps.ai.processing.rate_limiting import (
22 | |     check_rate_limit,
23 | |     wait_for_rate_limit,
24 | |     RateLimitScheduledException
25 | | )
   | |_^
26 |   from backend.apps.ai.processing.celery_helpers import execute_skill_via_celery, get_celery_task_status
27 |   from backend.apps.ai.processing.content_sanitization import sanitize_external_content
   |

E402 Module level import not at top of file
  --> backend/apps/ai/processing/skill_executor.py:26:1
   |
24 |     RateLimitScheduledException
25 | )
26 | from backend.apps.ai.processing.celery_helpers import execute_skill_via_celery, get_celery_task_status
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
27 | from backend.apps.ai.processing.content_sanitization import sanitize_external_content
   |

E402 Module level import not at top of file
  --> backend/apps/ai/processing/skill_executor.py:27:1
   |
25 | )
26 | from backend.apps.ai.processing.celery_helpers import execute_skill_via_celery, get_celery_task_status
27 | from backend.apps.ai.processing.content_sanitization import sanitize_external_content
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
28 |
29 | # Re-export helper functions and exceptions for backward compatibility
   |

Found 4 errors.
[*] 1 fixable with the `--fix` option.
Python: error backend/apps/ai/processing/skill_executor.py
F401 [*] `importlib` imported but unused
  --> backend/apps/ai/processing/tool_generator.py:11:8
   |
 9 | import copy
10 | from typing import Dict, Any, List, Optional, Set, TYPE_CHECKING
11 | import importlib
   |        ^^^^^^^^^
12 | import inspect
13 | from pydantic import BaseModel
   |
help: Remove unused import: `importlib`

F401 [*] `inspect` imported but unused
  --> backend/apps/ai/processing/tool_generator.py:12:8
   |
10 | from typing import Dict, Any, List, Optional, Set, TYPE_CHECKING
11 | import importlib
12 | import inspect
   |        ^^^^^^^
13 | from pydantic import BaseModel
   |
help: Remove unused import: `inspect`

F401 [*] `pydantic.BaseModel` imported but unused
  --> backend/apps/ai/processing/tool_generator.py:13:22
   |
11 | import importlib
12 | import inspect
13 | from pydantic import BaseModel
   |                      ^^^^^^^^^
14 |
15 | from backend.shared.python_schemas.app_metadata_schemas import AppYAML, AppSkillDefinition
   |
help: Remove unused import: `pydantic.BaseModel`

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/apps/ai/processing/tool_generator.py
All checks passed!
Python: ok backend/apps/ai/processing/url_corrector.py
F401 [*] `typing.Optional` imported but unused
  --> backend/apps/ai/processing/url_validator.py:9:37
   |
 7 | import asyncio
 8 | import logging
 9 | from typing import List, Dict, Any, Optional
   |                                     ^^^^^^^^
10 |
11 | from backend.shared.python_utils.url_normalizer import sanitize_url_remove_fragment
   |
help: Remove unused import: `typing.Optional`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/apps/ai/processing/url_validator.py
F401 [*] `os` imported but unused
 --> backend/apps/ai/skills/ask_skill.py:8:8
  |
6 | from fastapi import HTTPException
7 | from pydantic import BaseModel, Field
8 | import os # For environment variables
  |        ^^
9 | from celery import Celery # For sending tasks
  |
help: Remove unused import: `os`

F401 [*] `backend.core.api.app.tasks.celery_config.app` imported but unused
   --> backend/apps/ai/skills/ask_skill.py:127:73
    |
125 |             # Use the shared Celery app from celery_config and import the task directly
126 |             # This ensures we use the registered task object, which is more reliable than send_task
127 |             from backend.core.api.app.tasks.celery_config import app as celery_app
    |                                                                         ^^^^^^^^^^
128 |             from backend.apps.ai.tasks.ask_skill_task import process_ai_skill_ask_task
    |
help: Remove unused import: `backend.core.api.app.tasks.celery_config.app`

Found 2 errors.
[*] 2 fixable with the `--fix` option.
Python: error backend/apps/ai/skills/ask_skill.py
All checks passed!
Python: ok backend/apps/ai/tasks/__init__.py
F401 [*] `hashlib` imported but unused
  --> backend/apps/ai/tasks/ask_skill_task.py:17:8
   |
15 | import time
16 | import os
17 | import hashlib
   |        ^^^^^^^
18 | import uuid
19 | from typing import Dict, Any, List, Optional
   |
help: Remove unused import: `hashlib`

F401 [*] `json` imported but unused
  --> backend/apps/ai/tasks/ask_skill_task.py:20:8
   |
18 | import uuid
19 | from typing import Dict, Any, List, Optional
20 | import json
   |        ^^^^
21 | import httpx
22 | from pydantic import ValidationError
   |
help: Remove unused import: `json`

Found 2 errors.
[*] 2 fixable with the `--fix` option.
Python: error backend/apps/ai/tasks/ask_skill_task.py
F401 [*] `backend.core.api.app.tasks.celery_config.app` imported but unused
  --> backend/apps/ai/tasks/rate_limit_followup_task.py:10:61
   |
 8 | from typing import Dict, Any, Optional
 9 |
10 | from backend.core.api.app.tasks.celery_config import app as celery_app
   |                                                             ^^^^^^^^^^
11 | from backend.core.api.app.services.cache import CacheService
12 | from backend.core.api.app.services.directus import DirectusService
   |
help: Remove unused import: `backend.core.api.app.tasks.celery_config.app`

F541 [*] f-string without any placeholders
  --> backend/apps/ai/tasks/rate_limit_followup_task.py:49:18
   |
47 |         Dict with processing status
48 |     """
49 |     log_prefix = f"[RATE_LIMIT_FOLLOWUP]"
   |                  ^^^^^^^^^^^^^^^^^^^^^^^^
50 |     logger.info(f"{log_prefix} Starting followup processing for skill '{app_id}.{skill_id}'")
   |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
  --> backend/apps/ai/tasks/rate_limit_followup_task.py:56:25
   |
54 |         skill_results = skill_result
55 |         if not skill_results:
56 |             error_msg = f"No results from skill task"
   |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
57 |             logger.error(f"{log_prefix} {error_msg}")
58 |             return {"status": "error", "message": error_msg}
   |
help: Remove extraneous `f` prefix

F821 Undefined name `app`
   --> backend/apps/ai/tasks/rate_limit_followup_task.py:236:2
    |
236 | @app.task(
    |  ^^^
237 |     name="apps.ai.tasks.rate_limit_followup",
238 |     bind=True,
    |

Found 4 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/apps/ai/tasks/rate_limit_followup_task.py
F401 [*] `json` imported but unused
 --> backend/apps/ai/tasks/stream_consumer.py:5:8
  |
4 | import logging
5 | import json
  |        ^^^^
6 | import time
7 | import httpx
  |
help: Remove unused import: `json`

F841 Local variable `pending_code_fence_chunk` is assigned to but never used
   --> backend/apps/ai/tasks/stream_consumer.py:947:29
    |
945 | …     # Bare fence with no content - language might come in next chunk
946 | …     waiting_for_code_language = True
947 | …     pending_code_fence_chunk = chunk  # Save original chunk
    |       ^^^^^^^^^^^^^^^^^^^^^^^^
948 | …     chunk = ""  # Don't emit anything yet
949 | …     logger.info(f"{log_prefix} [CODE_BLOCK_DEBUG] Detected bare fence '```', waiting for potential language in next chunk")
    |
help: Remove assignment to unused variable `pending_code_fence_chunk`

Found 2 errors.
[*] 1 fixable with the `--fix` option (1 hidden fix can be enabled with the `--unsafe-fixes` option).
Python: error backend/apps/ai/tasks/stream_consumer.py
All checks passed!
Python: ok backend/apps/ai/utils/instruction_loader.py
E402 Module level import not at top of file
  --> backend/apps/ai/utils/llm_utils.py:19:1
   |
18 | # Import response types (these are shared types, not provider-specific)
19 | from backend.apps.ai.llm_providers.mistral_client import UnifiedMistralResponse as UnifiedMistralResponse, ParsedMistralToolCall
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
20 | from backend.apps.ai.llm_providers.google_client import UnifiedGoogleResponse, ParsedGoogleToolCall as ParsedGoogleToolCall
21 | from backend.apps.ai.llm_providers.anthropic_client import UnifiedAnthropicResponse, ParsedAnthropicToolCall
   |

F401 [*] `backend.apps.ai.llm_providers.mistral_client.ParsedMistralToolCall` imported but unused
  --> backend/apps/ai/utils/llm_utils.py:19:108
   |
18 | # Import response types (these are shared types, not provider-specific)
19 | from backend.apps.ai.llm_providers.mistral_client import UnifiedMistralResponse as UnifiedMistralResponse, ParsedMistralToolCall
   |                                                                                                            ^^^^^^^^^^^^^^^^^^^^^
20 | from backend.apps.ai.llm_providers.google_client import UnifiedGoogleResponse, ParsedGoogleToolCall as ParsedGoogleToolCall
21 | from backend.apps.ai.llm_providers.anthropic_client import UnifiedAnthropicResponse, ParsedAnthropicToolCall
   |
help: Remove unused import: `backend.apps.ai.llm_providers.mistral_client.ParsedMistralToolCall`

E402 Module level import not at top of file
  --> backend/apps/ai/utils/llm_utils.py:20:1
   |
18 | # Import response types (these are shared types, not provider-specific)
19 | from backend.apps.ai.llm_providers.mistral_client import UnifiedMistralResponse as UnifiedMistralResponse, ParsedMistralToolCall
20 | from backend.apps.ai.llm_providers.google_client import UnifiedGoogleResponse, ParsedGoogleToolCall as ParsedGoogleToolCall
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
21 | from backend.apps.ai.llm_providers.anthropic_client import UnifiedAnthropicResponse, ParsedAnthropicToolCall
22 | from backend.apps.ai.llm_providers.openai_shared import UnifiedOpenAIResponse, ParsedOpenAIToolCall, OpenAIUsageMetadata, _sanitize_sc…
   |

E402 Module level import not at top of file
  --> backend/apps/ai/utils/llm_utils.py:21:1
   |
19 | from backend.apps.ai.llm_providers.mistral_client import UnifiedMistralResponse as UnifiedMistralResponse, ParsedMistralToolCall
20 | from backend.apps.ai.llm_providers.google_client import UnifiedGoogleResponse, ParsedGoogleToolCall as ParsedGoogleToolCall
21 | from backend.apps.ai.llm_providers.anthropic_client import UnifiedAnthropicResponse, ParsedAnthropicToolCall
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
22 | from backend.apps.ai.llm_providers.openai_shared import UnifiedOpenAIResponse, ParsedOpenAIToolCall, OpenAIUsageMetadata, _sanitize_sc…
23 | from backend.apps.ai.utils.stream_utils import aggregate_paragraphs
   |

F401 [*] `backend.apps.ai.llm_providers.anthropic_client.ParsedAnthropicToolCall` imported but unused
  --> backend/apps/ai/utils/llm_utils.py:21:86
   |
19 | from backend.apps.ai.llm_providers.mistral_client import UnifiedMistralResponse as UnifiedMistralResponse, ParsedMistralToolCall
20 | from backend.apps.ai.llm_providers.google_client import UnifiedGoogleResponse, ParsedGoogleToolCall as ParsedGoogleToolCall
21 | from backend.apps.ai.llm_providers.anthropic_client import UnifiedAnthropicResponse, ParsedAnthropicToolCall
   |                                                                                      ^^^^^^^^^^^^^^^^^^^^^^^
22 | from backend.apps.ai.llm_providers.openai_shared import UnifiedOpenAIResponse, ParsedOpenAIToolCall, OpenAIUsageMetadata, _sanitize_sc…
23 | from backend.apps.ai.utils.stream_utils import aggregate_paragraphs
   |
help: Remove unused import: `backend.apps.ai.llm_providers.anthropic_client.ParsedAnthropicToolCall`

E402 Module level import not at top of file
  --> backend/apps/ai/utils/llm_utils.py:22:1
   |
20 | from backend.apps.ai.llm_providers.google_client import UnifiedGoogleResponse, ParsedGoogleToolCall as ParsedGoogleToolCall
21 | from backend.apps.ai.llm_providers.anthropic_client import UnifiedAnthropicResponse, ParsedAnthropicToolCall
22 | from backend.apps.ai.llm_providers.openai_shared import UnifiedOpenAIResponse, ParsedOpenAIToolCall, OpenAIUsageMetadata, _sanitize_schema_for_llm_providers
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
23 | from backend.apps.ai.utils.stream_utils import aggregate_paragraphs
24 | from backend.apps.ai.utils.timeout_utils import (
   |

F401 [*] `backend.apps.ai.llm_providers.openai_shared.ParsedOpenAIToolCall` imported but unused
  --> backend/apps/ai/utils/llm_utils.py:22:80
   |
20 | from backend.apps.ai.llm_providers.google_client import UnifiedGoogleResponse, ParsedGoogleToolCall as ParsedGoogleToolCall
21 | from backend.apps.ai.llm_providers.anthropic_client import UnifiedAnthropicResponse, ParsedAnthropicToolCall
22 | from backend.apps.ai.llm_providers.openai_shared import UnifiedOpenAIResponse, ParsedOpenAIToolCall, OpenAIUsageMetadata, _sanitize_sc…
   |                                                                                ^^^^^^^^^^^^^^^^^^^^
23 | from backend.apps.ai.utils.stream_utils import aggregate_paragraphs
24 | from backend.apps.ai.utils.timeout_utils import (
   |
help: Remove unused import

F401 [*] `backend.apps.ai.llm_providers.openai_shared.OpenAIUsageMetadata` imported but unused
  --> backend/apps/ai/utils/llm_utils.py:22:102
   |
20 | from backend.apps.ai.llm_providers.google_client import UnifiedGoogleResponse, ParsedGoogleToolCall as ParsedGoogleToolCall
21 | from backend.apps.ai.llm_providers.anthropic_client import UnifiedAnthropicResponse, ParsedAnthropicToolCall
22 | from backend.apps.ai.llm_providers.openai_shared import UnifiedOpenAIResponse, ParsedOpenAIToolCall, OpenAIUsageMetadata, _sanitize_sc…
   |                                                                                                      ^^^^^^^^^^^^^^^^^^^
23 | from backend.apps.ai.utils.stream_utils import aggregate_paragraphs
24 | from backend.apps.ai.utils.timeout_utils import (
   |
help: Remove unused import

E402 Module level import not at top of file
  --> backend/apps/ai/utils/llm_utils.py:23:1
   |
21 | from backend.apps.ai.llm_providers.anthropic_client import UnifiedAnthropicResponse, ParsedAnthropicToolCall
22 | from backend.apps.ai.llm_providers.openai_shared import UnifiedOpenAIResponse, ParsedOpenAIToolCall, OpenAIUsageMetadata, _sanitize_sc…
23 | from backend.apps.ai.utils.stream_utils import aggregate_paragraphs
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
24 | from backend.apps.ai.utils.timeout_utils import (
25 |     stream_with_first_chunk_timeout,
   |

E402 Module level import not at top of file
  --> backend/apps/ai/utils/llm_utils.py:24:1
   |
22 |   from backend.apps.ai.llm_providers.openai_shared import UnifiedOpenAIResponse, ParsedOpenAIToolCall, OpenAIUsageMetadata, _sanitize_sc…
23 |   from backend.apps.ai.utils.stream_utils import aggregate_paragraphs
24 | / from backend.apps.ai.utils.timeout_utils import (
25 | |     stream_with_first_chunk_timeout,
26 | |     FIRST_CHUNK_TIMEOUT_SECONDS,
27 | |     PREPROCESSING_TIMEOUT_SECONDS,
28 | |     get_first_chunk_timeout_seconds,
29 | | )
   | |_^
30 |   from backend.core.api.app.utils.secrets_manager import SecretsManager
31 |   from backend.core.api.app.utils.config_manager import config_manager
   |

F401 [*] `backend.apps.ai.utils.timeout_utils.FIRST_CHUNK_TIMEOUT_SECONDS` imported but unused
  --> backend/apps/ai/utils/llm_utils.py:26:5
   |
24 | from backend.apps.ai.utils.timeout_utils import (
25 |     stream_with_first_chunk_timeout,
26 |     FIRST_CHUNK_TIMEOUT_SECONDS,
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
27 |     PREPROCESSING_TIMEOUT_SECONDS,
28 |     get_first_chunk_timeout_seconds,
   |
help: Remove unused import: `backend.apps.ai.utils.timeout_utils.FIRST_CHUNK_TIMEOUT_SECONDS`

E402 Module level import not at top of file
  --> backend/apps/ai/utils/llm_utils.py:30:1
   |
28 |     get_first_chunk_timeout_seconds,
29 | )
30 | from backend.core.api.app.utils.secrets_manager import SecretsManager
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
31 | from backend.core.api.app.utils.config_manager import config_manager
32 | from backend.core.api.app.services.cache import CacheService
   |

E402 Module level import not at top of file
  --> backend/apps/ai/utils/llm_utils.py:31:1
   |
29 | )
30 | from backend.core.api.app.utils.secrets_manager import SecretsManager
31 | from backend.core.api.app.utils.config_manager import config_manager
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
32 | from backend.core.api.app.services.cache import CacheService
33 | from toon_format import decode, encode
   |

E402 Module level import not at top of file
  --> backend/apps/ai/utils/llm_utils.py:32:1
   |
30 | from backend.core.api.app.utils.secrets_manager import SecretsManager
31 | from backend.core.api.app.utils.config_manager import config_manager
32 | from backend.core.api.app.services.cache import CacheService
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
33 | from toon_format import decode, encode
   |

E402 Module level import not at top of file
  --> backend/apps/ai/utils/llm_utils.py:33:1
   |
31 | from backend.core.api.app.utils.config_manager import config_manager
32 | from backend.core.api.app.services.cache import CacheService
33 | from toon_format import decode, encode
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
34 |
35 | logger = logging.getLogger(__name__)
   |

E722 Do not use bare `except`
   --> backend/apps/ai/utils/llm_utils.py:196:13
    |
194 |             try:
195 |                 return str(tiptap_content)
196 |             except:
    |             ^^^^^^
197 |                 return ""
198 |         return ""
    |

F541 [*] f-string without any placeholders
   --> backend/apps/ai/utils/llm_utils.py:577:33
    |
575 | …                     # If both TOON and JSON decode fail, use content as-is
576 | …                     logger.warning(
577 | …                         f"Failed to decode tool result content for filtering (TOON and JSON decode failed). "
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
578 | …                         f"Using content as-is. This may result in higher token usage."
579 | …                     )
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/apps/ai/utils/llm_utils.py:578:33
    |
576 |                             logger.warning(
577 |                                 f"Failed to decode tool result content for filtering (TOON and JSON decode failed). "
578 |                                 f"Using content as-is. This may result in higher token usage."
    |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
579 |                             )
580 |                 except ImportError:
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/apps/ai/utils/llm_utils.py:583:25
    |
581 |                     # If import fails (circular dependency), use content as-is
582 |                     logger.warning(
583 |                         f"Could not import _filter_skill_results_for_llm for filtering tool results. "
    |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
584 |                         f"Using content as-is. This may result in higher token usage."
585 |                     )
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/apps/ai/utils/llm_utils.py:584:25
    |
582 |                     logger.warning(
583 |                         f"Could not import _filter_skill_results_for_llm for filtering tool results. "
584 |                         f"Using content as-is. This may result in higher token usage."
    |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
585 |                     )
586 |                 except Exception as e:
    |
help: Remove extraneous `f` prefix

F841 Local variable `provider_prefix` is assigned to but never used
   --> backend/apps/ai/utils/llm_utils.py:974:17
    |
972 |             if "/" in model_id:
973 |                 parts = model_id.split("/", 1)
974 |                 provider_prefix = parts[0]
    |                 ^^^^^^^^^^^^^^^
975 |                 actual_model_id = parts[1]
976 |             else:
    |
help: Remove assignment to unused variable `provider_prefix`

F841 Local variable `actual_model_id` is assigned to but never used
   --> backend/apps/ai/utils/llm_utils.py:975:17
    |
973 |                 parts = model_id.split("/", 1)
974 |                 provider_prefix = parts[0]
975 |                 actual_model_id = parts[1]
    |                 ^^^^^^^^^^^^^^^
976 |             else:
977 |                 logger.warning(f"{log_prefix} Transformed model_id '{model_id}' does not contain a provider prefix.")
    |
help: Remove assignment to unused variable `actual_model_id`

F841 Local variable `server_original_model_id` is assigned to but never used
    --> backend/apps/ai/utils/llm_utils.py:1036:9
     |
1034 |         server_provider_prefix = ""
1035 |         server_actual_model_id = server_model_id
1036 |         server_original_model_id = original_model_id  # Keep original for openrouter
     |         ^^^^^^^^^^^^^^^^^^^^^^^^
1037 |         
1038 |         if "/" in server_model_id:
     |
help: Remove assignment to unused variable `server_original_model_id`

Found 23 errors.
[*] 9 fixable with the `--fix` option (3 hidden fixes can be enabled with the `--unsafe-fixes` option).
Python: error backend/apps/ai/utils/llm_utils.py
F401 [*] `typing.Dict` imported but unused
 --> backend/apps/ai/utils/mate_utils.py:5:26
  |
4 | import logging
5 | from typing import List, Dict, Any, Optional
  |                          ^^^^
6 | import yaml
7 | from pydantic import BaseModel, ValidationError, Field
  |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
 --> backend/apps/ai/utils/mate_utils.py:5:32
  |
4 | import logging
5 | from typing import List, Dict, Any, Optional
  |                                ^^^
6 | import yaml
7 | from pydantic import BaseModel, ValidationError, Field
  |
help: Remove unused import

Found 2 errors.
[*] 2 fixable with the `--fix` option.
Python: error backend/apps/ai/utils/mate_utils.py
F401 [*] `re` imported but unused
 --> backend/apps/ai/utils/stream_utils.py:6:8
  |
4 | import logging
5 | from typing import AsyncIterator
6 | import re
  |        ^^
7 |
8 | logger = logging.getLogger(__name__)
  |
help: Remove unused import: `re`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/apps/ai/utils/stream_utils.py
All checks passed!
Python: ok backend/apps/ai/utils/timeout_utils.py
F401 [*] `typing.Union` imported but unused
  --> backend/apps/base_app.py:10:47
   |
 8 | import os
 9 | import logging
10 | from typing import Dict, Any, List, Optional, Union
   |                                               ^^^^^
11 | from pydantic import Field, BaseModel
12 | from fastapi import FastAPI, HTTPException, Depends, Request, Body
   |
help: Remove unused import: `typing.Union`

F401 [*] `pydantic.Field` imported but unused
  --> backend/apps/base_app.py:11:22
   |
 9 | import logging
10 | from typing import Dict, Any, List, Optional, Union
11 | from pydantic import Field, BaseModel
   |                      ^^^^^
12 | from fastapi import FastAPI, HTTPException, Depends, Request, Body
13 | from fastapi.requests import Request
   |
help: Remove unused import: `pydantic.Field`

F401 [*] `fastapi.Depends` imported but unused
  --> backend/apps/base_app.py:12:45
   |
10 | from typing import Dict, Any, List, Optional, Union
11 | from pydantic import Field, BaseModel
12 | from fastapi import FastAPI, HTTPException, Depends, Request, Body
   |                                             ^^^^^^^
13 | from fastapi.requests import Request
14 | import httpx
   |
help: Remove unused import

F401 [*] `fastapi.Body` imported but unused
  --> backend/apps/base_app.py:12:63
   |
10 | from typing import Dict, Any, List, Optional, Union
11 | from pydantic import Field, BaseModel
12 | from fastapi import FastAPI, HTTPException, Depends, Request, Body
   |                                                               ^^^^
13 | from fastapi.requests import Request
14 | import httpx
   |
help: Remove unused import

F811 Redefinition of unused `Request` from line 12
  --> backend/apps/base_app.py:12:54
   |
10 | from typing import Dict, Any, List, Optional, Union
11 | from pydantic import Field, BaseModel
12 | from fastapi import FastAPI, HTTPException, Depends, Request, Body
   |                                                      ------- previous definition of `Request` here
13 | from fastapi.requests import Request
   |                              ^^^^^^^ `Request` redefined here
14 | import httpx
15 | import importlib
   |
help: Remove definition: `Request`

F401 [*] `backend.shared.python_schemas.app_metadata_schemas.IconColorGradient` imported but unused
  --> backend/apps/base_app.py:23:5
   |
21 | from backend.shared.python_schemas.app_metadata_schemas import (
22 |     AppYAML,
23 |     IconColorGradient,
   |     ^^^^^^^^^^^^^^^^^
24 |     AppPricing,
25 |     AppSkillDefinition,
   |
help: Remove unused import

F401 [*] `backend.shared.python_schemas.app_metadata_schemas.AppPricing` imported but unused
  --> backend/apps/base_app.py:24:5
   |
22 |     AppYAML,
23 |     IconColorGradient,
24 |     AppPricing,
   |     ^^^^^^^^^^
25 |     AppSkillDefinition,
26 |     AppFocusDefinition,
   |
help: Remove unused import

F401 [*] `backend.core.api.app.utils.internal_auth.verify_internal_token` imported but unused
  --> backend/apps/base_app.py:29:54
   |
27 |     AppMemoryFieldDefinition
28 | )
29 | from backend.core.api.app.utils.internal_auth import verify_internal_token
   |                                                      ^^^^^^^^^^^^^^^^^^^^^
30 | from backend.core.api.app.services.translations import TranslationService
31 | from backend.apps.ai.processing.rate_limiting import RateLimitScheduledException
   |
help: Remove unused import: `backend.core.api.app.utils.internal_auth.verify_internal_token`

F401 [*] `uvicorn` imported but unused
   --> backend/apps/base_app.py:558:12
    |
557 | if __name__ == '__main__':
558 |     import uvicorn
    |            ^^^^^^^
559 |     import asyncio
    |
help: Remove unused import: `uvicorn`

Found 9 errors.
[*] 8 fixable with the `--fix` option.
Python: error backend/apps/base_app.py
F401 [*] `pythonjsonlogger.jsonlogger` imported but unused
  --> backend/apps/base_main.py:9:30
   |
 7 | import sys
 8 | import logging.config
 9 | from pythonjsonlogger import jsonlogger
   |                              ^^^^^^^^^^
10 | from apps.base_app import BaseApp # Available at /app/apps/base_app.py
   |
help: Remove unused import: `pythonjsonlogger.jsonlogger`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/apps/base_main.py
F401 [*] `typing.Union` imported but unused
 --> backend/apps/base_skill.py:6:41
  |
4 | # common logic, configuration handling, and integration points for skills.
5 |
6 | from typing import Optional, Dict, Any, Union, Tuple, Set, List, Callable, Type, TYPE_CHECKING
  |                                         ^^^^^
7 | from pydantic import BaseModel, Field, validator
8 | import asyncio # For potential async operations
  |
help: Remove unused import: `typing.Union`

F401 [*] `backend.shared.python_utils.billing_utils.BillingError` imported but unused
  --> backend/apps/base_skill.py:14:80
   |
13 | # Import shared utilities
14 | from backend.shared.python_utils.billing_utils import calculate_total_credits, BillingError, MINIMUM_CREDITS_CHARGED
   |                                                                                ^^^^^^^^^^^^
15 |
16 | if TYPE_CHECKING:
   |
help: Remove unused import: `backend.shared.python_utils.billing_utils.BillingError`

F541 [*] f-string without any placeholders
   --> backend/apps/base_skill.py:326:26
    |
324 |             if "id" not in req:
325 |                 req["id"] = 1  # Default to 1 for single requests
326 |                 log_func(f"Auto-generated 'id'=1 for single request")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
327 |         else:
328 |             # Multiple requests: 'id' is required
    |
help: Remove extraneous `f` prefix

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/apps/base_skill.py
All checks passed!
Python: ok backend/apps/maps/skills/__init__.py
F401 [*] `asyncio` imported but unused
  --> backend/apps/maps/skills/search_skill.py:12:8
   |
10 | import os
11 | import yaml
12 | import asyncio
   |        ^^^^^^^
13 | from typing import Dict, Any, List, Optional, Tuple
14 | from pydantic import BaseModel, Field
   |
help: Remove unused import: `asyncio`

F541 [*] f-string without any placeholders
   --> backend/apps/maps/skills/search_skill.py:237:40
    |
235 | …
236 | …
237 | …rning(f"Follow-up suggestions not found or invalid in app.yml for search skill, suggestions_follow_up_requests will be empty")
    |        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
238 | …estions_follow_up_requests = []
239 | …
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/apps/maps/skills/search_skill.py:242:26
    |
241 |             # If search skill not found
242 |             logger.error(f"Search skill not found in app.yml, suggestions_follow_up_requests will be empty")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
243 |             self.suggestions_follow_up_requests = []
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/apps/maps/skills/search_skill.py:282:37
    |
280 |         search_query = req.get("query")
281 |         if not search_query:
282 |             return (request_id, [], f"Missing 'query' parameter")
    |                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
283 |         
284 |         # Extract request-specific parameters (with defaults from schema)
    |
help: Remove extraneous `f` prefix

F841 [*] Local variable `e` is assigned to but never used
   --> backend/apps/maps/skills/search_skill.py:341:37
    |
339 |                         celery_task_context=celery_task_context
340 |                     )
341 |                 except Exception as e:
    |                                     ^
342 |                     # Re-raise exceptions from wait_for_rate_limit (e.g., RateLimitScheduledException)
343 |                     # These should bubble up to the route handler
    |
help: Remove assignment to unused variable `e`

Found 5 errors.
[*] 5 fixable with the `--fix` option.
Python: error backend/apps/maps/skills/search_skill.py
All checks passed!
Python: ok backend/apps/news/skills/__init__.py
F401 [*] `json` imported but unused
  --> backend/apps/news/skills/search_skill.py:11:8
   |
 9 | import logging
10 | import os
11 | import json
   |        ^^^^
12 | import yaml
13 | import asyncio
   |
help: Remove unused import: `json`

F401 [*] `asyncio` imported but unused
  --> backend/apps/news/skills/search_skill.py:13:8
   |
11 | import json
12 | import yaml
13 | import asyncio
   |        ^^^^^^^
14 | from typing import Dict, Any, List, Optional, Tuple
15 | from pydantic import BaseModel, Field
   |
help: Remove unused import: `asyncio`

F541 [*] f-string without any placeholders
   --> backend/apps/news/skills/search_skill.py:244:40
    |
242 | …
243 | …
244 | …rning(f"Follow-up suggestions not found or invalid in app.yml for search skill, suggestions_follow_up_requests will be empty")
    |        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
245 | …estions_follow_up_requests = []
246 | …
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/apps/news/skills/search_skill.py:249:26
    |
248 |             # If search skill not found
249 |             logger.error(f"Search skill not found in app.yml, suggestions_follow_up_requests will be empty")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
250 |             self.suggestions_follow_up_requests = []
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/apps/news/skills/search_skill.py:288:37
    |
286 |         search_query = req.get("query") or req.get("q")
287 |         if not search_query:
288 |             return (request_id, [], f"Missing 'query' parameter")
    |                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
289 |         
290 |         # Extract request-specific parameters (with defaults from schema)
    |
help: Remove extraneous `f` prefix

F841 [*] Local variable `e` is assigned to but never used
   --> backend/apps/news/skills/search_skill.py:361:37
    |
359 |                         celery_task_context=celery_task_context
360 |                     )
361 |                 except Exception as e:
    |                                     ^
362 |                     # Re-raise exceptions from wait_for_rate_limit (e.g., RateLimitScheduledException)
363 |                     # These should bubble up to the route handler
    |
help: Remove assignment to unused variable `e`

Found 6 errors.
[*] 6 fixable with the `--fix` option.
Python: error backend/apps/news/skills/search_skill.py
All checks passed!
Python: ok backend/apps/nutrition/skills/rewe_online.py
F401 [*] `typing.List` imported but unused
 --> backend/apps/openapi_docs_gen.py:3:31
  |
1 | import json
2 | import argparse
3 | from typing import Dict, Any, List, Set, Union
  |                               ^^^^
4 | import os
  |
help: Remove unused import

F401 [*] `typing.Set` imported but unused
 --> backend/apps/openapi_docs_gen.py:3:37
  |
1 | import json
2 | import argparse
3 | from typing import Dict, Any, List, Set, Union
  |                                     ^^^
4 | import os
  |
help: Remove unused import

F401 [*] `typing.Union` imported but unused
 --> backend/apps/openapi_docs_gen.py:3:42
  |
1 | import json
2 | import argparse
3 | from typing import Dict, Any, List, Set, Union
  |                                          ^^^^^
4 | import os
  |
help: Remove unused import

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/apps/openapi_docs_gen.py
All checks passed!
Python: ok backend/apps/test_skills.py
All checks passed!
Python: ok backend/apps/videos/skills/__init__.py
F401 [*] `json` imported but unused
  --> backend/apps/videos/skills/search_skill.py:11:8
   |
 9 | import logging
10 | import os
11 | import json
   |        ^^^^
12 | import yaml
13 | import asyncio
   |
help: Remove unused import: `json`

F401 [*] `asyncio` imported but unused
  --> backend/apps/videos/skills/search_skill.py:13:8
   |
11 | import json
12 | import yaml
13 | import asyncio
   |        ^^^^^^^
14 | from typing import Dict, Any, List, Optional, Tuple
15 | from pydantic import BaseModel, Field
   |
help: Remove unused import: `asyncio`

F541 [*] f-string without any placeholders
   --> backend/apps/videos/skills/search_skill.py:249:40
    |
247 | …
248 | …
249 | …rning(f"Follow-up suggestions not found or invalid in app.yml for search skill, suggestions_follow_up_requests will be empty")
    |        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
250 | …estions_follow_up_requests = []
251 | …
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/apps/videos/skills/search_skill.py:254:26
    |
253 |             # If search skill not found
254 |             logger.error(f"Search skill not found in app.yml, suggestions_follow_up_requests will be empty")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
255 |             self.suggestions_follow_up_requests = []
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/apps/videos/skills/search_skill.py:293:37
    |
291 |         search_query = req.get("query") or req.get("q")
292 |         if not search_query:
293 |             return (request_id, [], f"Missing 'query' parameter")
    |                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
294 |         
295 |         # Extract request-specific parameters (with defaults from schema)
    |
help: Remove extraneous `f` prefix

F841 [*] Local variable `e` is assigned to but never used
   --> backend/apps/videos/skills/search_skill.py:367:37
    |
365 |                         celery_task_context=celery_task_context
366 |                     )
367 |                 except Exception as e:
    |                                     ^
368 |                     # Re-raise exceptions from wait_for_rate_limit (e.g., RateLimitScheduledException)
369 |                     # These should bubble up to the route handler
    |
help: Remove assignment to unused variable `e`

Found 6 errors.
[*] 6 fixable with the `--fix` option.
Python: error backend/apps/videos/skills/search_skill.py
F401 [*] `pydantic.ValidationError` imported but unused
  --> backend/apps/videos/skills/transcript_skill.py:17:57
   |
15 | from typing import Dict, Any, List, Optional, Tuple
16 | from urllib.parse import urlparse, parse_qs
17 | from pydantic import BaseModel, Field, field_validator, ValidationError
   |                                                         ^^^^^^^^^^^^^^^
18 | from celery import Celery  # For Celery type hinting
19 | from requests import Session
   |
help: Remove unused import: `pydantic.ValidationError`

F541 [*] f-string without any placeholders
   --> backend/apps/videos/skills/transcript_skill.py:583:28
    |
581 |             proxy_configs = [webshare_config] * max_retries
582 |         else:
583 |             logger.warning(f"Webshare proxy not available - attempting direct connection (may fail due to IP blocks)")
    |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
584 |             proxy_configs = [None] * max_retries
    |
help: Remove extraneous `f` prefix

F841 Local variable `plain_text` is assigned to but never used
   --> backend/apps/videos/skills/transcript_skill.py:707:17
    |
705 |             if result.get("success") and "transcript_items" in result:
706 |                 transcript_items = result.pop("transcript_items")
707 |                 plain_text = result.pop("plain_text", "")
    |                 ^^^^^^^^^^
708 |                 
709 |                 # Format transcript as multiline string with timestamps
    |
help: Remove assignment to unused variable `plain_text`

F541 [*] f-string without any placeholders
   --> backend/apps/videos/skills/transcript_skill.py:756:37
    |
754 |         video_url = req.get("url", "")
755 |         if not video_url:
756 |             return (request_id, [], f"Missing 'url' parameter")
    |                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^
757 |         
758 |         # Sanitize URL by removing fragment parameters (#{text}) as a security measure
    |
help: Remove extraneous `f` prefix

Found 4 errors.
[*] 3 fixable with the `--fix` option (1 hidden fix can be enabled with the `--unsafe-fixes` option).
Python: error backend/apps/videos/skills/transcript_skill.py
E722 Do not use bare `except`
   --> backend/apps/videos/test_search_to_json.py:127:9
    |
125 |             error_json = json.loads(error_body)
126 |             print(f"Error details: {json.dumps(error_json, indent=2)}", file=sys.stderr)
127 |         except:
    |         ^^^^^^
128 |             pass
129 |         sys.exit(1)
    |

Found 1 error.
Python: error backend/apps/videos/test_search_to_json.py
All checks passed!
Python: ok backend/apps/web/skills/__init__.py
F401 [*] `json` imported but unused
  --> backend/apps/web/skills/read_skill.py:11:8
   |
 9 | import logging
10 | import os
11 | import json
   |        ^^^^
12 | import yaml
13 | import asyncio
   |
help: Remove unused import: `json`

F541 [*] f-string without any placeholders
   --> backend/apps/web/skills/read_skill.py:257:40
    |
255 | …
256 | …
257 | …arning(f"Follow-up suggestions not found or invalid in app.yml for read skill, suggestions_follow_up_requests will be empty")
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
258 | …gestions_follow_up_requests = []
259 | …
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/apps/web/skills/read_skill.py:262:26
    |
261 |             # If read skill not found
262 |             logger.error(f"Read skill not found in app.yml, suggestions_follow_up_requests will be empty")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
263 |             self.suggestions_follow_up_requests = []
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/apps/web/skills/read_skill.py:301:37
    |
299 |         read_url = req.get("url")
300 |         if not read_url:
301 |             return (request_id, [], f"Missing 'url' parameter")
    |                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^
302 |         
303 |         # Sanitize URL by removing fragment parameters (#{text}) as a security measure
    |
help: Remove extraneous `f` prefix

F841 [*] Local variable `e` is assigned to but never used
   --> backend/apps/web/skills/read_skill.py:368:37
    |
366 |                         celery_task_context=celery_task_context
367 |                     )
368 |                 except Exception as e:
    |                                     ^
369 |                     # Re-raise exceptions from wait_for_rate_limit (e.g., RateLimitScheduledException)
370 |                     # These should bubble up to the route handler
    |
help: Remove assignment to unused variable `e`

Found 5 errors.
[*] 5 fixable with the `--fix` option.
Python: error backend/apps/web/skills/read_skill.py
F401 [*] `asyncio` imported but unused
  --> backend/apps/web/skills/search_skill.py:13:8
   |
11 | import json
12 | import yaml
13 | import asyncio
   |        ^^^^^^^
14 | from typing import Dict, Any, List, Optional, Tuple
15 | from pydantic import BaseModel, Field
   |
help: Remove unused import: `asyncio`

F541 [*] f-string without any placeholders
   --> backend/apps/web/skills/search_skill.py:244:40
    |
242 | …
243 | …
244 | …rning(f"Follow-up suggestions not found or invalid in app.yml for search skill, suggestions_follow_up_requests will be empty")
    |        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
245 | …estions_follow_up_requests = []
246 | …
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/apps/web/skills/search_skill.py:249:26
    |
248 |             # If search skill not found
249 |             logger.error(f"Search skill not found in app.yml, suggestions_follow_up_requests will be empty")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
250 |             self.suggestions_follow_up_requests = []
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/apps/web/skills/search_skill.py:288:37
    |
286 |         search_query = req.get("query") or req.get("q")
287 |         if not search_query:
288 |             return (request_id, [], f"Missing 'query' parameter")
    |                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
289 |         
290 |         # Extract request-specific parameters (with defaults from schema)
    |
help: Remove extraneous `f` prefix

F841 [*] Local variable `e` is assigned to but never used
   --> backend/apps/web/skills/search_skill.py:365:37
    |
363 |                         celery_task_context=celery_task_context
364 |                     )
365 |                 except Exception as e:
    |                                     ^
366 |                     # Re-raise exceptions from wait_for_rate_limit (e.g., RateLimitScheduledException)
367 |                     # These should bubble up to the route handler
    |
help: Remove assignment to unused variable `e`

Found 5 errors.
[*] 5 fixable with the `--fix` option.
Python: error backend/apps/web/skills/search_skill.py
All checks passed!
Python: ok backend/apps/web/tasks/__init__.py
All checks passed!
Python: ok backend/core/api/app/__init__.py
F401 [*] `typing.Optional` imported but unused
  --> backend/core/api/app/middleware/logging_middleware.py:11:20
   |
 9 | import uuid
10 | import json # Added for parsing JSON response bodies
11 | from typing import Optional # Added for type hinting
   |                    ^^^^^^^^
12 | from fastapi import Request, Response
13 | from starlette.middleware.base import BaseHTTPMiddleware
   |
help: Remove unused import: `typing.Optional`

F401 [*] `backend.core.api.app.services.metrics.MetricsService` imported but unused
  --> backend/core/api/app/middleware/logging_middleware.py:16:51
   |
14 | from starlette.types import ASGIApp
15 |
16 | from backend.core.api.app.services.metrics import MetricsService
   |                                                   ^^^^^^^^^^^^^^
17 |
18 | logger = logging.getLogger(__name__)
   |
help: Remove unused import: `backend.core.api.app.services.metrics.MetricsService`

Found 2 errors.
[*] 2 fixable with the `--fix` option.
Python: error backend/core/api/app/middleware/logging_middleware.py
F401 [*] `pydantic.EmailStr` imported but unused
 --> backend/core/api/app/models/user.py:1:33
  |
1 | from pydantic import BaseModel, EmailStr
  |                                 ^^^^^^^^
2 | from typing import Optional, Dict, Any
  |
help: Remove unused import: `pydantic.EmailStr`

F401 [*] `typing.Dict` imported but unused
 --> backend/core/api/app/models/user.py:2:30
  |
1 | from pydantic import BaseModel, EmailStr
2 | from typing import Optional, Dict, Any
  |                              ^^^^
3 |
4 | class User(BaseModel):
  |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
 --> backend/core/api/app/models/user.py:2:36
  |
1 | from pydantic import BaseModel, EmailStr
2 | from typing import Optional, Dict, Any
  |                                    ^^^
3 |
4 | class User(BaseModel):
  |
help: Remove unused import

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/core/api/app/models/user.py
All checks passed!
Python: ok backend/core/api/app/routes/__init__.py
All checks passed!
Python: ok backend/core/api/app/routes/admin.py
F401 [*] `typing.Optional` imported but unused
  --> backend/core/api/app/routes/apps.py:11:37
   |
 9 | import os
10 | import time
11 | from typing import Dict, Any, List, Optional
   |                                     ^^^^^^^^
12 | from fastapi import APIRouter, HTTPException, Request, Depends
13 | from pydantic import BaseModel
   |
help: Remove unused import: `typing.Optional`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/apps.py
F401 [*] `json` imported but unused
  --> backend/core/api/app/routes/apps_api.py:10:8
   |
 8 | import hashlib
 9 | import os
10 | import json
   |        ^^^^
11 | from typing import Dict, Any, Optional, List
12 | from fastapi import APIRouter, HTTPException, Request, Depends, Body, FastAPI
   |
help: Remove unused import: `json`

F401 [*] `backend.shared.python_utils.billing_utils.PricingConfig` imported but unused
  --> backend/core/api/app/routes/apps_api.py:23:80
   |
21 | from backend.core.api.app.utils.secrets_manager import SecretsManager
22 | from backend.shared.python_schemas.app_metadata_schemas import AppYAML, AppSkillDefinition
23 | from backend.shared.python_utils.billing_utils import calculate_total_credits, PricingConfig
   |                                                                                ^^^^^^^^^^^^^
24 |
25 | logger = logging.getLogger(__name__)
   |
help: Remove unused import: `backend.shared.python_utils.billing_utils.PricingConfig`

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/apps_api.py:182:28
    |
181 |         if not translations:
182 |             logger.warning(f"No translations loaded for language 'en'")
    |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
183 |             return fallback or translation_key
    |
help: Remove extraneous `f` prefix

F841 Local variable `app_description` is assigned to but never used
    --> backend/core/api/app/routes/apps_api.py:1004:9
     |
1002 |             fallback=app_id
1003 |         )
1004 |         app_description = resolve_translation(
     |         ^^^^^^^^^^^^^^^
1005 |             translation_service,
1006 |             app_metadata.description_translation_key,
     |
help: Remove assignment to unused variable `app_description`

Found 4 errors.
[*] 3 fixable with the `--fix` option (1 hidden fix can be enabled with the `--unsafe-fixes` option).
Python: error backend/core/api/app/routes/apps_api.py
All checks passed!
Python: ok backend/core/api/app/routes/auth.py
All checks passed!
Python: ok backend/core/api/app/routes/auth_routes/__init__.py
F401 [*] `fastapi.Response` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_2fa_setup.py:1:50
  |
1 | from fastapi import APIRouter, Depends, Request, Response, HTTPException, status
  |                                                  ^^^^^^^^
2 | import logging
3 | import time
  |
help: Remove unused import

F401 [*] `fastapi.HTTPException` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_2fa_setup.py:1:60
  |
1 | from fastapi import APIRouter, Depends, Request, Response, HTTPException, status
  |                                                            ^^^^^^^^^^^^^
2 | import logging
3 | import time
  |
help: Remove unused import

F401 [*] `fastapi.status` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_2fa_setup.py:1:75
  |
1 | from fastapi import APIRouter, Depends, Request, Response, HTTPException, status
  |                                                                           ^^^^^^
2 | import logging
3 | import time
  |
help: Remove unused import

F401 [*] `typing.List` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_2fa_setup.py:4:20
  |
2 | import logging
3 | import time
4 | from typing import List, Optional, Dict, Any
  |                    ^^^^
5 |
6 | # Import schemas
  |
help: Remove unused import

F401 [*] `typing.Optional` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_2fa_setup.py:4:26
  |
2 | import logging
3 | import time
4 | from typing import List, Optional, Dict, Any
  |                          ^^^^^^^^
5 |
6 | # Import schemas
  |
help: Remove unused import

F401 [*] `typing.Dict` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_2fa_setup.py:4:36
  |
2 | import logging
3 | import time
4 | from typing import List, Optional, Dict, Any
  |                                    ^^^^
5 |
6 | # Import schemas
  |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_2fa_setup.py:4:42
  |
2 | import logging
3 | import time
4 | from typing import List, Optional, Dict, Any
  |                                          ^^^
5 |
6 | # Import schemas
  |
help: Remove unused import

Found 7 errors.
[*] 7 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/auth_routes/auth_2fa_setup.py
All checks passed!
Python: ok backend/core/api/app/routes/auth_routes/auth_2fa_utils.py
F401 [*] `fastapi.Response` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_2fa_verify.py:1:50
  |
1 | from fastapi import APIRouter, Depends, Request, Response, HTTPException, status
  |                                                  ^^^^^^^^
2 | import logging
3 | import pyotp
  |
help: Remove unused import

F401 [*] `fastapi.HTTPException` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_2fa_verify.py:1:60
  |
1 | from fastapi import APIRouter, Depends, Request, Response, HTTPException, status
  |                                                            ^^^^^^^^^^^^^
2 | import logging
3 | import pyotp
  |
help: Remove unused import

F401 [*] `fastapi.status` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_2fa_verify.py:1:75
  |
1 | from fastapi import APIRouter, Depends, Request, Response, HTTPException, status
  |                                                                           ^^^^^^
2 | import logging
3 | import pyotp
  |
help: Remove unused import

F401 [*] `time` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_2fa_verify.py:4:8
  |
2 | import logging
3 | import pyotp
4 | import time
  |        ^^^^
5 | import hashlib # Added for temporary hash generation
6 | from typing import Optional, Dict, Any
  |
help: Remove unused import: `time`

F401 [*] `typing.Optional` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_2fa_verify.py:6:20
  |
4 | import time
5 | import hashlib # Added for temporary hash generation
6 | from typing import Optional, Dict, Any
  |                    ^^^^^^^^
7 |
8 | # Import schemas
  |
help: Remove unused import

F401 [*] `typing.Dict` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_2fa_verify.py:6:30
  |
4 | import time
5 | import hashlib # Added for temporary hash generation
6 | from typing import Optional, Dict, Any
  |                              ^^^^
7 |
8 | # Import schemas
  |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_2fa_verify.py:6:36
  |
4 | import time
5 | import hashlib # Added for temporary hash generation
6 | from typing import Optional, Dict, Any
  |                                    ^^^
7 |
8 | # Import schemas
  |
help: Remove unused import

Found 7 errors.
[*] 7 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/auth_routes/auth_2fa_verify.py
F401 [*] `backend.core.api.app.utils.device_fingerprint._extract_client_ip` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_common.py:7:93
  |
5 | from backend.core.api.app.services.directus import DirectusService
6 | from backend.core.api.app.services.cache import CacheService
7 | from backend.core.api.app.utils.device_fingerprint import generate_device_fingerprint_hash, _extract_client_ip, get_geo_data_from_ip, …
  |                                                                                             ^^^^^^^^^^^^^^^^^^
8 |
9 | logger = logging.getLogger(__name__)
  |
help: Remove unused import

F401 [*] `backend.core.api.app.utils.device_fingerprint.get_geo_data_from_ip` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_common.py:7:113
  |
5 | …tusService
6 | …vice
7 | …t generate_device_fingerprint_hash, _extract_client_ip, get_geo_data_from_ip, parse_user_agent # Updated imports
  |                                                          ^^^^^^^^^^^^^^^^^^^^
8 | …
9 | …
  |
help: Remove unused import

F401 [*] `backend.core.api.app.utils.device_fingerprint.parse_user_agent` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_common.py:7:135
  |
5 | …
6 | …
7 | …ngerprint_hash, _extract_client_ip, get_geo_data_from_ip, parse_user_agent # Updated imports
  |                                                            ^^^^^^^^^^^^^^^^
8 | …
9 | …
  |
help: Remove unused import

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/auth_routes/auth_common.py
F541 [*] f-string without any placeholders
  --> backend/core/api/app/routes/auth_routes/auth_dependencies.py:75:26
   |
74 |         if not cached_user_id:
75 |             logger.error(f"CRITICAL: user_id is missing from cached data for token")
   |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
76 |             raise HTTPException(status_code=500, detail="User data incomplete: missing user ID")
   |
help: Remove extraneous `f` prefix

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/auth_routes/auth_dependencies.py
F401 [*] `fastapi.Cookie` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_email.py:1:60
  |
1 | from fastapi import APIRouter, Depends, Request, Response, Cookie
  |                                                            ^^^^^^
2 | import logging
3 | import time
  |
help: Remove unused import: `fastapi.Cookie`

F401 [*] `urllib.parse` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_email.py:5:8
  |
3 | import time
4 | import hashlib
5 | import urllib.parse
  |        ^^^^^^^^^^^^
6 | import os
7 | import base64
  |
help: Remove unused import: `urllib.parse`

F401 [*] `os` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_email.py:6:8
  |
4 | import hashlib
5 | import urllib.parse
6 | import os
  |        ^^
7 | import base64
8 | from typing import Optional, Tuple
  |
help: Remove unused import: `os`

F401 [*] `typing.Optional` imported but unused
  --> backend/core/api/app/routes/auth_routes/auth_email.py:8:20
   |
 6 | import os
 7 | import base64
 8 | from typing import Optional, Tuple
   |                    ^^^^^^^^
 9 | from backend.core.api.app.schemas.auth import RequestEmailCodeRequest, RequestEmailCodeResponse, CheckEmailCodeRequest, CheckEmailCode…
10 | from backend.core.api.app.services.directus import DirectusService
   |
help: Remove unused import

F401 [*] `typing.Tuple` imported but unused
  --> backend/core/api/app/routes/auth_routes/auth_email.py:8:30
   |
 6 | import os
 7 | import base64
 8 | from typing import Optional, Tuple
   |                              ^^^^^
 9 | from backend.core.api.app.schemas.auth import RequestEmailCodeRequest, RequestEmailCodeResponse, CheckEmailCodeRequest, CheckEmailCode…
10 | from backend.core.api.app.services.directus import DirectusService
   |
help: Remove unused import

F401 [*] `backend.core.api.app.utils.device_fingerprint.generate_device_fingerprint_hash` imported but unused
  --> backend/core/api/app/routes/auth_routes/auth_email.py:15:59
   |
13 | from backend.core.api.app.services.compliance import ComplianceService
14 | from backend.core.api.app.services.limiter import limiter
15 | from backend.core.api.app.utils.device_fingerprint import generate_device_fingerprint_hash, _extract_client_ip, get_geo_data_from_ip, …
   |                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
16 | from backend.core.api.app.utils.invite_code import validate_invite_code, get_signup_requirements
17 | from backend.core.api.app.utils.newsletter_utils import hash_email, check_ignored_email
   |
help: Remove unused import

F401 [*] `backend.core.api.app.utils.device_fingerprint._extract_client_ip` imported but unused
  --> backend/core/api/app/routes/auth_routes/auth_email.py:15:93
   |
13 | from backend.core.api.app.services.compliance import ComplianceService
14 | from backend.core.api.app.services.limiter import limiter
15 | from backend.core.api.app.utils.device_fingerprint import generate_device_fingerprint_hash, _extract_client_ip, get_geo_data_from_ip, …
   |                                                                                             ^^^^^^^^^^^^^^^^^^
16 | from backend.core.api.app.utils.invite_code import validate_invite_code, get_signup_requirements
17 | from backend.core.api.app.utils.newsletter_utils import hash_email, check_ignored_email
   |
help: Remove unused import

F401 [*] `backend.core.api.app.utils.device_fingerprint.get_geo_data_from_ip` imported but unused
  --> backend/core/api/app/routes/auth_routes/auth_email.py:15:113
   |
13 | …plianceService
14 | …r
15 | …t generate_device_fingerprint_hash, _extract_client_ip, get_geo_data_from_ip, parse_user_agent # Updated imports
   |                                                          ^^^^^^^^^^^^^^^^^^^^
16 | …ate_invite_code, get_signup_requirements
17 | …hash_email, check_ignored_email
   |
help: Remove unused import

F401 [*] `backend.core.api.app.utils.device_fingerprint.parse_user_agent` imported but unused
  --> backend/core/api/app/routes/auth_routes/auth_email.py:15:135
   |
13 | …
14 | …
15 | …ngerprint_hash, _extract_client_ip, get_geo_data_from_ip, parse_user_agent # Updated imports
   |                                                            ^^^^^^^^^^^^^^^^
16 | …_signup_requirements
17 | …nored_email
   |
help: Remove unused import

F401 [*] `backend.core.api.app.routes.auth_routes.auth_utils.validate_password` imported but unused
  --> backend/core/api/app/routes/auth_routes/auth_email.py:21:106
   |
19 | from backend.core.api.app.utils.encryption import EncryptionService
20 | from backend.core.api.app.routes.auth_routes.auth_dependencies import get_directus_service, get_cache_service, get_metrics_service, ge…
21 | from backend.core.api.app.routes.auth_routes.auth_utils import verify_allowed_origin, validate_username, validate_password
   |                                                                                                          ^^^^^^^^^^^^^^^^^
22 | from backend.core.api.app.tasks.celery_config import app as celery_app
   |
help: Remove unused import: `backend.core.api.app.routes.auth_routes.auth_utils.validate_password`

F541 [*] f-string without any placeholders
  --> backend/core/api/app/routes/auth_routes/auth_email.py:68:32
   |
66 |         if require_invite_code:
67 |             if not invite_code:
68 |                 logger.warning(f"Missing invite code in email verification request when required")
   |                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
69 |                 return RequestEmailCodeResponse(
70 |                     success=False,
   |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
  --> backend/core/api/app/routes/auth_routes/auth_email.py:78:32
   |
76 |             is_valid, message, code_data = await validate_invite_code(invite_code, directus_service, cache_service)
77 |             if not is_valid:
78 |                 logger.warning(f"Invalid invite code used in email verification request")
   |                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
79 |                 return RequestEmailCodeResponse(
80 |                     success=False,
   |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
  --> backend/core/api/app/routes/auth_routes/auth_email.py:85:25
   |
83 |                 )
84 |         else:
85 |             logger.info(f"Invite code not required, skipping validation")
   |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
86 |         
87 |         # Check domain security policies (validates domain compliance)
   |
help: Remove extraneous `f` prefix

F841 Local variable `check_domain` is assigned to but never used
   --> backend/core/api/app/routes/auth_routes/auth_email.py:142:13
    |
140 |         email_parts = email_request.email.split('@')
141 |         if len(email_parts) == 2:
142 |             check_domain = email_parts[1].lower().strip()
    |             ^^^^^^^^^^^^
143 |             # Use validate_email_domain for consistency (not is_domain_restricted directly)
144 |             is_allowed_redundant, error_redundant = domain_security_service.validate_email_domain(email_request.email)
    |
help: Remove assignment to unused variable `check_domain`

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/auth_routes/auth_email.py:166:21
    |
165 |         # Check if email is already registered
166 |         logger.info(f"Checking if email is already registered...")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
167 |         
168 |         exists_result, existing_user, error_msg = await directus_service.get_user_by_hashed_email(hashed_email)
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/auth_routes/auth_email.py:179:28
    |
178 |         if exists_result:
179 |             logger.warning(f"Attempted to register with existing email")
    |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
180 |             return RequestEmailCodeResponse(
181 |                 success=False,
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/auth_routes/auth_email.py:186:21
    |
184 |             )
185 |
186 |         logger.info(f"Email check passed, not already registered")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
187 |
188 |         logger.info(f"Submitting email verification task to Celery")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/auth_routes/auth_email.py:188:21
    |
186 |         logger.info(f"Email check passed, not already registered")
187 |
188 |         logger.info(f"Submitting email verification task to Celery")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
189 |
190 |         # Send the task with explicit task name
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/auth_routes/auth_email.py:252:32
    |
250 |             is_valid, message, code_data = await validate_invite_code(invite_code, directus_service, cache_service)
251 |             if not is_valid:
252 |                 logger.warning(f"Invalid invite code used in email verification check")
    |                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
253 |                 return CheckEmailCodeResponse(
254 |                     success=False,
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/auth_routes/auth_email.py:258:25
    |
256 |                 )
257 |         else:
258 |             logger.info(f"Invite code not required, skipping validation")
    |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
259 |
260 |         # Note: Domain validation should have already happened in request_confirm_email_code
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/auth_routes/auth_email.py:270:28
    |
268 |         # Check if we have a code for this email
269 |         if not stored_code:
270 |             logger.warning(f"Email verification attempted with no code on record")
    |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
271 |             return CheckEmailCodeResponse(
272 |                 success=False,
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/auth_routes/auth_email.py:278:28
    |
276 |         # Check if code matches
277 |         if str(stored_code) != str(code_request.code):
278 |             logger.warning(f"Invalid verification code.")
    |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
279 |             return CheckEmailCodeResponse(
280 |                 success=False,
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/auth_routes/auth_email.py:288:27
    |
287 |         # Log successful verification
288 |         event_logger.info(f"Email verified successfully")
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
289 |         logger.info(f"Email verified successfully")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/auth_routes/auth_email.py:289:21
    |
287 |         # Log successful verification
288 |         event_logger.info(f"Email verified successfully")
289 |         logger.info(f"Email verified successfully")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
290 |
291 |         # Validate username from request body
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/auth_routes/auth_email.py:308:28
    |
306 |         exists_result, existing_user, _ = await directus_service.get_user_by_hashed_email(hashed_email)
307 |         if exists_result and existing_user:
308 |             logger.warning(f"Attempted to register with existing email")
    |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
309 |             return CheckEmailCodeResponse(
310 |                 success=False,
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/auth_routes/auth_email.py:330:21
    |
328 |         await cache_service.set(verification_cache_key, verification_data, ttl=1800)  # 30 minutes
329 |         
330 |         logger.info(f"Email verification successful, stored verification data in cache")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
331 |
332 |         # Return success - user will proceed to secure account step
    |
help: Remove extraneous `f` prefix

Found 26 errors.
[*] 25 fixable with the `--fix` option (1 hidden fix can be enabled with the `--unsafe-fixes` option).
Python: error backend/core/api/app/routes/auth_routes/auth_email.py
All checks passed!
Python: ok backend/core/api/app/routes/auth_routes/auth_gift.py
All checks passed!
Python: ok backend/core/api/app/routes/auth_routes/auth_invite.py
F401 [*] `backend.core.api.app.tasks.email_tasks.recovery_key_email_task.send_recovery_key_used_email` imported but unused
  --> backend/core/api/app/routes/auth_routes/auth_login.py:30:76
   |
28 | from backend.core.api.app.tasks.celery_config import app # General Celery app
29 | # Import recovery key email task
30 | from backend.core.api.app.tasks.email_tasks.recovery_key_email_task import send_recovery_key_used_email
   |                                                                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
31 |
32 | """
   |
help: Remove unused import: `backend.core.api.app.tasks.email_tasks.recovery_key_email_task.send_recovery_key_used_email`

F541 [*] f-string without any placeholders
  --> backend/core/api/app/routes/auth_routes/auth_login.py:66:17
   |
64 |     Accepts optional tfa_code for the second step of 2FA login.
65 |     """
66 |     logger.info(f"Processing POST /login")
   |                 ^^^^^^^^^^^^^^^^^^^^^^^^^
67 |     
68 |     try:
   |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
  --> backend/core/api/app/routes/auth_routes/auth_login.py:83:25
   |
81 |         is_recovery_key_login = login_data.login_method == "recovery_key"
82 |         if is_recovery_key_login:
83 |             logger.info(f"Recovery key login detected from request")
   |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
84 |         
85 |         metrics_service.track_login_attempt(auth_success)
   |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/auth_routes/auth_login.py:437:38
    |
435 |                         await cache_service.set_user_cache_primed_flag(user_id)
436 |                     else: # Should not happen if user_id is present, but defensive
437 |                         logger.error(f"Cannot dispatch warm_user_cache task: user_id is missing, though it was checked.")
    |                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
438 |                 else:
439 |                     logger.info(f"User cache already primed/warming for {user_id[:6]}... ✅")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/auth_routes/auth_login.py:441:30
    |
439 |                     logger.info(f"User cache already primed/warming for {user_id[:6]}... ✅")
440 |             else:
441 |                 logger.error(f"Cannot dispatch warm_user_cache task or check primed status: user_id is missing.")
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/auth_routes/auth_login.py:620:42
    |
618 | …             await cache_service.set_user_cache_primed_flag(user_id)
619 | …         else: # Should not happen
620 | …             logger.error(f"Cannot dispatch warm_user_cache task (OTP login): user_id is missing, though it was checked.")
    |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
621 | …     else:
622 | …         logger.info(f"User cache already primed/warming for {user_id[:6]}... (OTP login) ✅")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/auth_routes/auth_login.py:624:34
    |
622 |                         logger.info(f"User cache already primed/warming for {user_id[:6]}... (OTP login) ✅")
623 |                 else:
624 |                     logger.error(f"Cannot dispatch warm_user_cache task or check primed status (OTP login): user_id is missing.")
    |                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
625 |
626 |                 if refresh_token:
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/auth_routes/auth_login.py:670:29
    |
668 |                 # Step 2: Check cache for recently used backup code SHA hash (user-specific)
669 |                 used_code_cache_key = f"used_backup_code:{user_id}:{provided_code_sha_hash}"
670 |                 logger.info(f"Checking recently used backup code SHA hash...")
    |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
671 |                 recently_used = await cache_service.get(used_code_cache_key)
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/auth_routes/auth_login.py:892:42
    |
890 | …che_service.set_user_cache_primed_flag(user_id)
891 | …ld not happen
892 | …rror(f"Cannot dispatch warm_user_cache task or check primed status (Backup code login): user_id is missing, though it was checked.")
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
893 | …
894 | …f"User cache already primed/warming for {user_id[:6]}... (Backup code login) ✅")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/auth_routes/auth_login.py:896:34
    |
894 | …     logger.info(f"User cache already primed/warming for {user_id[:6]}... (Backup code login) ✅")
895 | …e:
896 | … logger.error(f"Cannot dispatch warm_user_cache task or check primed status (Backup code login): user_id is missing.")
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
897 | …
898 | …refresh_token:
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
    --> backend/core/api/app/routes/auth_routes/auth_login.py:1202:17
     |
1200 |     This is the first step in the new multi-step login flow.
1201 |     """
1202 |     logger.info(f"Processing POST /lookup")
     |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
1203 |     
1204 |     try:
     |
help: Remove extraneous `f` prefix

F821 Undefined name `has_passkey`
    --> backend/core/api/app/routes/auth_routes/auth_login.py:1326:49
     |
1324 |                     available_methods.append("security_key")
1325 |                     # Only set as preferred if password and passkey are not available
1326 |                     if not has_password and not has_passkey:
     |                                                 ^^^^^^^^^^^
1327 |                         preferred_method = "security_key"
     |

Found 12 errors.
[*] 11 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/auth_routes/auth_login.py
F541 [*] f-string without any placeholders
  --> backend/core/api/app/routes/auth_routes/auth_logout.py:33:17
   |
31 |     """
32 |     # Add clear request log at INFO level
33 |     logger.info(f"Processing logout request")
   |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
34 |     
35 |     try:
   |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/auth_routes/auth_logout.py:152:17
    |
150 |     Log out all sessions for the current user
151 |     """
152 |     logger.info(f"Processing logout-all request")
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
153 |     
154 |     try:
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/auth_routes/auth_logout.py:173:28
    |
172 |         if not user_id:
173 |             logger.warning(f"User ID not found in cache for logout-all request")
    |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
174 |             
175 |             # Try to get user information from Directus by refreshing the token
    |
help: Remove extraneous `f` prefix

E722 Do not use bare `except`
   --> backend/core/api/app/routes/auth_routes/auth_logout.py:242:5
    |
240 |         reason = body.get("reason", "unknown")
241 |         details = body.get("details", {})
242 |     except:
    |     ^^^^^^
243 |         reason = "unknown"
244 |         details = {}
    |

Found 4 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/auth_routes/auth_logout.py
All checks passed!
Python: ok backend/core/api/app/routes/auth_routes/auth_passkey.py
F401 [*] `time` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_password.py:3:8
  |
1 | from fastapi import APIRouter, Depends, Request, Response
2 | import logging
3 | import time
  |        ^^^^
4 | import hashlib
5 | import os
  |
help: Remove unused import: `time`

F401 [*] `os` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_password.py:5:8
  |
3 | import time
4 | import hashlib
5 | import os
  |        ^^
6 | import base64
7 | from typing import Optional
  |
help: Remove unused import: `os`

F401 [*] `base64` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_password.py:6:8
  |
4 | import hashlib
5 | import os
6 | import base64
  |        ^^^^^^
7 | from typing import Optional
8 | from backend.core.api.app.schemas.auth import SetupPasswordRequest, SetupPasswordResponse
  |
help: Remove unused import: `base64`

F401 [*] `typing.Optional` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_password.py:7:20
  |
5 | import os
6 | import base64
7 | from typing import Optional
  |                    ^^^^^^^^
8 | from backend.core.api.app.schemas.auth import SetupPasswordRequest, SetupPasswordResponse
9 | from backend.core.api.app.services.directus import DirectusService
  |
help: Remove unused import: `typing.Optional`

F401 [*] `backend.core.api.app.utils.device_fingerprint.get_geo_data_from_ip` imported but unused
  --> backend/core/api/app/routes/auth_routes/auth_password.py:14:113
   |
12 | from backend.core.api.app.services.compliance import ComplianceService
13 | from backend.core.api.app.services.limiter import limiter
14 | from backend.core.api.app.utils.device_fingerprint import generate_device_fingerprint_hash, _extract_client_ip, get_geo_data_from_ip
   |                                                                                                                 ^^^^^^^^^^^^^^^^^^^^
15 | from backend.core.api.app.utils.invite_code import validate_invite_code, get_signup_requirements
16 | from backend.core.api.app.utils.encryption import EncryptionService
   |
help: Remove unused import: `backend.core.api.app.utils.device_fingerprint.get_geo_data_from_ip`

F541 [*] f-string without any placeholders
  --> backend/core/api/app/routes/auth_routes/auth_password.py:58:32
   |
56 |             is_valid, message, code_data = await validate_invite_code(invite_code, directus_service, cache_service)
57 |             if not is_valid:
58 |                 logger.warning(f"Invalid invite code used in password setup")
   |                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
59 |                 return SetupPasswordResponse(
60 |                     success=False,
   |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
  --> backend/core/api/app/routes/auth_routes/auth_password.py:64:25
   |
62 |                 )
63 |         else:
64 |             logger.info(f"Invite code not required, skipping validation")
   |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
65 |
66 |         # Check if email was verified by looking for verification data in cache
   |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
  --> backend/core/api/app/routes/auth_routes/auth_password.py:72:28
   |
71 |         if not verification_data:
72 |             logger.warning(f"Password setup attempted without email verification")
   |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
73 |             return SetupPasswordResponse(
74 |                 success=False,
   |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
  --> backend/core/api/app/routes/auth_routes/auth_password.py:91:28
   |
89 |         exists_result, existing_user, _ = await directus_service.get_user_by_hashed_email(setup_request.hashed_email)
90 |         if exists_result and existing_user:
91 |             logger.warning(f"Attempted to register with existing email")
   |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
92 |             return SetupPasswordResponse(
93 |                 success=False,
   |
help: Remove extraneous `f` prefix

Found 9 errors.
[*] 9 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/auth_routes/auth_password.py
F401 [*] `fastapi.Response` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_recoverykey.py:1:50
  |
1 | from fastapi import APIRouter, Depends, Request, Response, HTTPException, status
  |                                                  ^^^^^^^^
2 | import logging
3 | import time
  |
help: Remove unused import

F401 [*] `fastapi.HTTPException` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_recoverykey.py:1:60
  |
1 | from fastapi import APIRouter, Depends, Request, Response, HTTPException, status
  |                                                            ^^^^^^^^^^^^^
2 | import logging
3 | import time
  |
help: Remove unused import

F401 [*] `fastapi.status` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_recoverykey.py:1:75
  |
1 | from fastapi import APIRouter, Depends, Request, Response, HTTPException, status
  |                                                                           ^^^^^^
2 | import logging
3 | import time
  |
help: Remove unused import

F401 [*] `typing.Optional` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_recoverykey.py:5:20
  |
3 | import time
4 | import hashlib
5 | from typing import Optional
  |                    ^^^^^^^^
6 |
7 | # Import schemas
  |
help: Remove unused import: `typing.Optional`

Found 4 errors.
[*] 4 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/auth_routes/auth_recoverykey.py
F401 [*] `fastapi.HTTPException` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_session.py:1:68
  |
1 | from fastapi import APIRouter, Depends, Request, Response, Cookie, HTTPException, status
  |                                                                    ^^^^^^^^^^^^^
2 | import logging
3 | import time
  |
help: Remove unused import

F401 [*] `fastapi.status` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_session.py:1:83
  |
1 | from fastapi import APIRouter, Depends, Request, Response, Cookie, HTTPException, status
  |                                                                                   ^^^^^^
2 | import logging
3 | import time
  |
help: Remove unused import

F401 [*] `typing.Dict` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_session.py:5:30
  |
3 | import time
4 | import os
5 | from typing import Optional, Dict, Any # Added Dict, Any
  |                              ^^^^
6 | from backend.core.api.app.schemas.auth import SessionResponse
7 | from backend.core.api.app.services.directus import DirectusService
  |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
 --> backend/core/api/app/routes/auth_routes/auth_session.py:5:36
  |
3 | import time
4 | import os
5 | from typing import Optional, Dict, Any # Added Dict, Any
  |                                    ^^^
6 | from backend.core.api.app.schemas.auth import SessionResponse
7 | from backend.core.api.app.services.directus import DirectusService
  |
help: Remove unused import

Found 4 errors.
[*] 4 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/auth_routes/auth_session.py
All checks passed!
Python: ok backend/core/api/app/routes/auth_routes/auth_utils.py
All checks passed!
Python: ok backend/core/api/app/routes/auth_ws.py
F401 [*] `fastapi.WebSocketDisconnect` imported but unused
 --> backend/core/api/app/routes/connection_manager.py:3:32
  |
1 | import asyncio
2 | import logging
3 | from fastapi import WebSocket, WebSocketDisconnect
  |                                ^^^^^^^^^^^^^^^^^^^
4 | from typing import Dict, Tuple, Optional
  |
help: Remove unused import: `fastapi.WebSocketDisconnect`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/connection_manager.py
F401 [*] `typing.Dict` imported but unused
  --> backend/core/api/app/routes/creators.py:9:20
   |
 7 | import time
 8 | import hashlib
 9 | from typing import Dict, Any, Optional
   |                    ^^^^
10 | from fastapi import APIRouter, Depends, HTTPException, Request, Body
11 | from pydantic import BaseModel, Field
   |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
  --> backend/core/api/app/routes/creators.py:9:26
   |
 7 | import time
 8 | import hashlib
 9 | from typing import Dict, Any, Optional
   |                          ^^^
10 | from fastapi import APIRouter, Depends, HTTPException, Request, Body
11 | from pydantic import BaseModel, Field
   |
help: Remove unused import

F401 [*] `fastapi.Body` imported but unused
  --> backend/core/api/app/routes/creators.py:10:65
   |
 8 | import hashlib
 9 | from typing import Dict, Any, Optional
10 | from fastapi import APIRouter, Depends, HTTPException, Request, Body
   |                                                                 ^^^^
11 | from pydantic import BaseModel, Field
   |
help: Remove unused import: `fastapi.Body`

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/creators.py:127:21
    |
126 |     if not payment_enabled:
127 |         logger.info(f"Creator tip request rejected: payment disabled (self-hosted mode)")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
128 |         raise HTTPException(
129 |             status_code=404,
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/creators.py:201:26
    |
199 |             # If income entry creation fails, we should ideally refund the credits
200 |             # But for now, we'll just log the error
201 |             logger.error(f"Failed to create creator income entry for tip. Credits were deducted but income entry not created.")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
202 |             # TODO: Consider refunding credits if income entry creation fails
    |
help: Remove extraneous `f` prefix

Found 5 errors.
[*] 5 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/creators.py
F541 [*] f-string without any placeholders
  --> backend/core/api/app/routes/credit_note.py:79:20
   |
78 |         # Create a preview filename using the sample credit note number
79 |         filename = f"openmates-credit-note-2025-03-15-U475D6855-CN001.pdf"
   |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
80 |         
81 |         return StreamingResponse(
   |
help: Remove extraneous `f` prefix

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/credit_note.py
All checks passed!
Python: ok backend/core/api/app/routes/demo_chat.py
F401 [*] `os` imported but unused
   --> backend/core/api/app/routes/email.py:348:12
    |
346 |     Preview the newsletter confirmed email template.
347 |     """
348 |     import os
    |            ^^
349 |     
350 |     try:
    |
help: Remove unused import: `os`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/email.py
All checks passed!
Python: ok backend/core/api/app/routes/email_block.py
F401 [*] `json` imported but unused
 --> backend/core/api/app/routes/handlers/websocket_handlers/ai_response_completed_handler.py:3:8
  |
1 | # backend/core/api/app/routes/handlers/websocket_handlers/ai_response_completed_handler.py
2 | import logging
3 | import json
  |        ^^^^
4 | from typing import Dict, Any
5 | from datetime import datetime, timezone
  |
help: Remove unused import: `json`

F401 [*] `datetime.datetime` imported but unused
 --> backend/core/api/app/routes/handlers/websocket_handlers/ai_response_completed_handler.py:5:22
  |
3 | import json
4 | from typing import Dict, Any
5 | from datetime import datetime, timezone
  |                      ^^^^^^^^
6 |
7 | from fastapi import WebSocket
  |
help: Remove unused import

F401 [*] `datetime.timezone` imported but unused
 --> backend/core/api/app/routes/handlers/websocket_handlers/ai_response_completed_handler.py:5:32
  |
3 | import json
4 | from typing import Dict, Any
5 | from datetime import datetime, timezone
  |                                ^^^^^^^^
6 |
7 | from fastapi import WebSocket
  |
help: Remove unused import

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/handlers/websocket_handlers/ai_response_completed_handler.py
F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/handlers/websocket_handlers/app_settings_memories_confirmed_handler.py:111:36
    |
110 |                 if not app_id or not item_key or content is None:
111 |                     logger.warning(f"Invalid app settings/memories item: missing required fields")
    |                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
112 |                     continue
    |
help: Remove extraneous `f` prefix

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/handlers/websocket_handlers/app_settings_memories_confirmed_handler.py
All checks passed!
Python: ok backend/core/api/app/routes/handlers/websocket_handlers/cancel_ai_task_handler.py
F401 [*] `backend.core.api.app.services.directus.chat_methods` imported but unused
  --> backend/core/api/app/routes/handlers/websocket_handlers/chat_content_batch_handler.py:8:69
   |
 7 | from backend.core.api.app.services.cache import CacheService
 8 | from backend.core.api.app.services.directus import DirectusService, chat_methods
   |                                                                     ^^^^^^^^^^^^
 9 | from backend.core.api.app.utils.encryption import EncryptionService
10 | from backend.core.api.app.schemas.chat import MessageResponse # Assuming MessageResponse is the schema for client-facing messages
   |
help: Remove unused import: `backend.core.api.app.services.directus.chat_methods`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/handlers/websocket_handlers/chat_content_batch_handler.py
F401 [*] `typing.Optional` imported but unused
 --> backend/core/api/app/routes/handlers/websocket_handlers/delete_chat_handler.py:2:31
  |
1 | import logging
2 | from typing import Dict, Any, Optional
  |                               ^^^^^^^^
3 | import datetime # For compliance log timestamp
  |
help: Remove unused import: `typing.Optional`

F401 [*] `datetime` imported but unused
 --> backend/core/api/app/routes/handlers/websocket_handlers/delete_chat_handler.py:3:8
  |
1 | import logging
2 | from typing import Dict, Any, Optional
3 | import datetime # For compliance log timestamp
  |        ^^^^^^^^
4 |
5 | from fastapi import WebSocket
  |
help: Remove unused import: `datetime`

Found 2 errors.
[*] 2 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/handlers/websocket_handlers/delete_chat_handler.py
All checks passed!
Python: ok backend/core/api/app/routes/handlers/websocket_handlers/delete_draft_handler.py
All checks passed!
Python: ok backend/core/api/app/routes/handlers/websocket_handlers/delete_new_chat_suggestion_handler.py
F401 [*] `json` imported but unused
 --> backend/core/api/app/routes/handlers/websocket_handlers/draft_update_handler.py:2:8
  |
1 | import logging
2 | import json
  |        ^^^^
3 | import time
4 | from typing import Dict, Any, Optional
  |
help: Remove unused import: `json`

F401 [*] `time` imported but unused
 --> backend/core/api/app/routes/handlers/websocket_handlers/draft_update_handler.py:3:8
  |
1 | import logging
2 | import json
3 | import time
  |        ^^^^
4 | from typing import Dict, Any, Optional
  |
help: Remove unused import: `time`

F401 [*] `backend.core.api.app.services.directus.chat_methods` imported but unused
  --> backend/core/api/app/routes/handlers/websocket_handlers/draft_update_handler.py:10:52
   |
 8 | from backend.core.api.app.services.cache import CacheService
 9 | from backend.core.api.app.services.directus.directus import DirectusService # Keep if needed for validation?
10 | from backend.core.api.app.services.directus import chat_methods
   |                                                    ^^^^^^^^^^^^
11 | from backend.core.api.app.utils.encryption import EncryptionService
12 | from backend.core.api.app.routes.connection_manager import ConnectionManager
   |
help: Remove unused import: `backend.core.api.app.services.directus.chat_methods`

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/handlers/websocket_handlers/draft_update_handler.py
All checks passed!
Python: ok backend/core/api/app/routes/handlers/websocket_handlers/encrypted_chat_metadata_handler.py
F401 [*] `backend.core.api.app.services.directus.chat_methods` imported but unused
  --> backend/core/api/app/routes/handlers/websocket_handlers/get_chat_messages_handler.py:8:69
   |
 6 | from fastapi import WebSocket
 7 |
 8 | from backend.core.api.app.services.directus import DirectusService, chat_methods
   |                                                                     ^^^^^^^^^^^^
 9 | from backend.core.api.app.utils.encryption import EncryptionService
10 | from backend.core.api.app.routes.connection_manager import ConnectionManager
   |
help: Remove unused import: `backend.core.api.app.services.directus.chat_methods`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/handlers/websocket_handlers/get_chat_messages_handler.py
All checks passed!
Python: ok backend/core/api/app/routes/handlers/websocket_handlers/initial_sync_handler.py
F401 [*] `typing.Tuple` imported but unused
 --> backend/core/api/app/routes/handlers/websocket_handlers/message_received_handler.py:7:41
  |
5 | import uuid
6 | import time # Import time for performance timing
7 | from typing import Dict, Any, Optional, Tuple, List
  |                                         ^^^^^
8 | from datetime import datetime, timezone
9 | import httpx
  |
help: Remove unused import: `typing.Tuple`

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/handlers/websocket_handlers/message_received_handler.py:396:26
    |
394 | …hat client is NOT sending encrypted content (wrong handler)
395 | …ayload_from_client.get("encrypted_content"):
396 | …rror(f"Client sent encrypted content to chat_message_added handler. This should go to encrypted_chat_metadata handler instead.")
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
397 | …nager.send_personal_message(
398 | …pe": "error", "payload": {"message": "Encrypted content should be sent to encrypted_chat_metadata endpoint"}},
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/handlers/websocket_handlers/message_received_handler.py:436:40
    |
435 |                     if not embed_id or not embed_type or not embed_content:
436 |                         logger.warning(f"Invalid embed data from client: missing required fields")
    |                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
437 |                         continue
    |
help: Remove extraneous `f` prefix

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/handlers/websocket_handlers/message_received_handler.py
F401 [*] `json` imported but unused
 --> backend/core/api/app/routes/handlers/websocket_handlers/offline_sync_handler.py:2:8
  |
1 | import logging
2 | import json
  |        ^^^^
3 | import time
4 | from typing import Dict, Any, List, Optional
  |
help: Remove unused import: `json`

F401 [*] `.draft_update_handler._validate_draft_content` imported but unused
  --> backend/core/api/app/routes/handlers/websocket_handlers/offline_sync_handler.py:14:35
   |
12 | from backend.core.api.app.tasks.celery_config import app as celery_app_instance
13 | # Import validation function from draft handler if needed, or redefine
14 | from .draft_update_handler import _validate_draft_content, MAX_DRAFT_WORDS, MAX_DRAFT_CHARS
   |                                   ^^^^^^^^^^^^^^^^^^^^^^^
15 |
16 | logger = logging.getLogger(__name__)
   |
help: Remove unused import

F401 [*] `.draft_update_handler.MAX_DRAFT_WORDS` imported but unused
  --> backend/core/api/app/routes/handlers/websocket_handlers/offline_sync_handler.py:14:60
   |
12 | from backend.core.api.app.tasks.celery_config import app as celery_app_instance
13 | # Import validation function from draft handler if needed, or redefine
14 | from .draft_update_handler import _validate_draft_content, MAX_DRAFT_WORDS, MAX_DRAFT_CHARS
   |                                                            ^^^^^^^^^^^^^^^
15 |
16 | logger = logging.getLogger(__name__)
   |
help: Remove unused import

F401 [*] `.draft_update_handler.MAX_DRAFT_CHARS` imported but unused
  --> backend/core/api/app/routes/handlers/websocket_handlers/offline_sync_handler.py:14:77
   |
12 | from backend.core.api.app.tasks.celery_config import app as celery_app_instance
13 | # Import validation function from draft handler if needed, or redefine
14 | from .draft_update_handler import _validate_draft_content, MAX_DRAFT_WORDS, MAX_DRAFT_CHARS
   |                                                                             ^^^^^^^^^^^^^^^
15 |
16 | logger = logging.getLogger(__name__)
   |
help: Remove unused import

E722 Do not use bare `except`
   --> backend/core/api/app/routes/handlers/websocket_handlers/offline_sync_handler.py:267:13
    |
265 |                     user_id=user_id, device_fingerprint_hash=device_fingerprint_hash
266 |                  )
267 |             except: pass # Ignore send error
    |             ^^^^^^
268 |
269 |     logger.info(f"Finished processing offline changes for user {user_id}. Processed: {processed_count}, Conflicts: {conflict_count}, …
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/routes/handlers/websocket_handlers/offline_sync_handler.py:267:19
    |
265 |                     user_id=user_id, device_fingerprint_hash=device_fingerprint_hash
266 |                  )
267 |             except: pass # Ignore send error
    |                   ^
268 |
269 |     logger.info(f"Finished processing offline changes for user {user_id}. Processed: {processed_count}, Conflicts: {conflict_count}, …
    |

E722 Do not use bare `except`
   --> backend/core/api/app/routes/handlers/websocket_handlers/offline_sync_handler.py:276:5
    |
274 |             user_id=user_id, device_fingerprint_hash=device_fingerprint_hash
275 |         )
276 |     except: pass
    |     ^^^^^^
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/routes/handlers/websocket_handlers/offline_sync_handler.py:276:11
    |
274 |             user_id=user_id, device_fingerprint_hash=device_fingerprint_hash
275 |         )
276 |     except: pass
    |           ^
    |

Found 8 errors.
[*] 4 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/handlers/websocket_handlers/offline_sync_handler.py
F401 [*] `json` imported but unused
 --> backend/core/api/app/routes/handlers/websocket_handlers/phased_sync_handler.py:2:8
  |
1 | # backend/core/api/app/routes/handlers/websocket_handlers/phased_sync_handler.py
2 | import json
  |        ^^^^
3 | import logging
4 | from typing import Dict, Any, List, Optional
  |
help: Remove unused import: `json`

F401 [*] `typing.Optional` imported but unused
 --> backend/core/api/app/routes/handlers/websocket_handlers/phased_sync_handler.py:4:37
  |
2 | import json
3 | import logging
4 | from typing import Dict, Any, List, Optional
  |                                     ^^^^^^^^
5 | from datetime import datetime, timezone
  |
help: Remove unused import: `typing.Optional`

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/handlers/websocket_handlers/phased_sync_handler.py:209:25
    |
207 |         # Handle "new" chat section - send only suggestions
208 |         if chat_id == "new":
209 |             logger.info(f"Phase 1: Last opened was 'new' chat section, sending suggestions only")
    |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
210 |             await manager.send_personal_message(
211 |                 {
    |
help: Remove extraneous `f` prefix

F401 [*] `backend.core.api.app.schemas.chat.CachedChatVersions` imported but unused
   --> backend/core/api/app/routes/handlers/websocket_handlers/phased_sync_handler.py:233:59
    |
231 |         if not chat_is_missing:
232 |             # Client has the chat - check if it's up-to-date
233 |             from backend.core.api.app.schemas.chat import CachedChatVersions
    |                                                           ^^^^^^^^^^^^^^^^^^
234 |             cached_server_versions = await cache_service.get_chat_versions(user_id, chat_id)
    |
help: Remove unused import: `backend.core.api.app.schemas.chat.CachedChatVersions`

F841 Local variable `server_title_v` is assigned to but never used
   --> backend/core/api/app/routes/handlers/websocket_handlers/phased_sync_handler.py:386:17
    |
384 |             elif server_versions:
385 |                 server_messages_v = server_versions.messages_v
386 |                 server_title_v = server_versions.title_v
    |                 ^^^^^^^^^^^^^^
387 |             else:
388 |                 # No version data available at all - fetch from Directus to be safe
    |
help: Remove assignment to unused variable `server_title_v`

F401 [*] `backend.core.api.app.schemas.chat.CachedChatVersions` imported but unused
   --> backend/core/api/app/routes/handlers/websocket_handlers/phased_sync_handler.py:638:55
    |
636 |             return
637 |         
638 |         from backend.core.api.app.schemas.chat import CachedChatVersions
    |                                                       ^^^^^^^^^^^^^^^^^^
639 |         client_chat_ids_set = set(client_chat_ids)
    |
help: Remove unused import: `backend.core.api.app.schemas.chat.CachedChatVersions`

F841 Local variable `server_title_v` is assigned to but never used
   --> backend/core/api/app/routes/handlers/websocket_handlers/phased_sync_handler.py:725:21
    |
723 |                 else:
724 |                     server_messages_v = server_versions.messages_v
725 |                     server_title_v = server_versions.title_v
    |                     ^^^^^^^^^^^^^^
726 |                 
727 |                 if client_versions:
    |
help: Remove assignment to unused variable `server_title_v`

F401 [*] `backend.core.api.app.schemas.chat.CachedChatVersions` imported but unused
   --> backend/core/api/app/routes/handlers/websocket_handlers/phased_sync_handler.py:976:55
    |
974 |             # Send empty phase 3 completion
975 |         
976 |         from backend.core.api.app.schemas.chat import CachedChatVersions
    |                                                       ^^^^^^^^^^^^^^^^^^
977 |         client_chat_ids_set = set(client_chat_ids)
    |
help: Remove unused import: `backend.core.api.app.schemas.chat.CachedChatVersions`

F841 Local variable `server_title_v` is assigned to but never used
    --> backend/core/api/app/routes/handlers/websocket_handlers/phased_sync_handler.py:1063:25
     |
1061 |                     else:
1062 |                         server_messages_v = server_versions.messages_v
1063 |                         server_title_v = server_versions.title_v
     |                         ^^^^^^^^^^^^^^
1064 |                     
1065 |                     if client_versions:
     |
help: Remove assignment to unused variable `server_title_v`

Found 9 errors.
[*] 6 fixable with the `--fix` option (3 hidden fixes can be enabled with the `--unsafe-fixes` option).
Python: error backend/core/api/app/routes/handlers/websocket_handlers/phased_sync_handler.py
All checks passed!
Python: ok backend/core/api/app/routes/handlers/websocket_handlers/post_processing_metadata_handler.py
All checks passed!
Python: ok backend/core/api/app/routes/handlers/websocket_handlers/request_embed_handler.py
All checks passed!
Python: ok backend/core/api/app/routes/handlers/websocket_handlers/store_embed_handler.py
F401 [*] `typing.List` imported but unused
 --> backend/core/api/app/routes/handlers/websocket_handlers/store_embed_keys_handler.py:2:31
  |
1 | import logging
2 | from typing import Dict, Any, List
  |                               ^^^^
3 | from fastapi import WebSocket
  |
help: Remove unused import: `typing.List`

F541 [*] f-string without any placeholders
  --> backend/core/api/app/routes/handlers/websocket_handlers/store_embed_keys_handler.py:70:36
   |
69 |                 if not hashed_embed_id or not key_type or not encrypted_embed_key or not hashed_user_id:
70 |                     logger.warning(f"Invalid key entry in store_embed_keys payload: missing required fields")
   |                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
71 |                     failed_count += 1
72 |                     continue
   |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
  --> backend/core/api/app/routes/handlers/websocket_handlers/store_embed_keys_handler.py:83:40
   |
81 |                     hashed_chat_id = key_data.get("hashed_chat_id")
82 |                     if not hashed_chat_id:
83 |                         logger.warning(f"Missing hashed_chat_id for key_type='chat' in store_embed_keys payload")
   |                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
84 |                         failed_count += 1
85 |                         continue
   |
help: Remove extraneous `f` prefix

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/handlers/websocket_handlers/store_embed_keys_handler.py
F401 [*] `json` imported but unused
 --> backend/core/api/app/routes/handlers/websocket_handlers/title_update_handler.py:2:8
  |
1 | import logging
2 | import json
  |        ^^^^
3 | from typing import Dict, Any
  |
help: Remove unused import: `json`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/handlers/websocket_handlers/title_update_handler.py
F401 [*] `fastapi.Body` imported but unused
  --> backend/core/api/app/routes/internal_api.py:8:65
   |
 7 | import logging
 8 | from fastapi import APIRouter, HTTPException, Request, Depends, Body
   |                                                                 ^^^^
 9 | from typing import Dict, Any, Optional
10 | from pydantic import BaseModel # Ensure BaseModel is imported for Pydantic models
   |
help: Remove unused import: `fastapi.Body`

F541 [*] f-string without any placeholders
   --> backend/core/api/app/routes/internal_api.py:408:21
    |
406 |             encrypted_pdf_payload = response.content
407 |
408 |         logger.info(f"Successfully downloaded encrypted PDF from S3.")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
409 |
410 |         # 6. Decrypt the PDF file
    |
help: Remove extraneous `f` prefix

Found 2 errors.
[*] 2 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/internal_api.py
F541 [*] f-string without any placeholders
  --> backend/core/api/app/routes/invoice.py:79:20
   |
78 |         # Create a preview filename using the sample invoice number
79 |         filename = f"openmates-invoice-2025-03-15-U475D6855-I001.pdf"
   |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
80 |         
81 |         return StreamingResponse(
   |
help: Remove extraneous `f` prefix

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/invoice.py
All checks passed!
Python: ok backend/core/api/app/routes/newsletter.py
All checks passed!
Python: ok backend/core/api/app/routes/payments.py
F401 [*] `fastapi.Cookie` imported but unused
 --> backend/core/api/app/routes/settings.py:1:74
  |
1 | from fastapi import APIRouter, UploadFile, File, HTTPException, Depends, Cookie, Request, Security
  |                                                                          ^^^^^^
2 | from fastapi.responses import StreamingResponse
3 | import logging
  |
help: Remove unused import: `fastapi.Cookie`

F401 [*] `backend.core.api.app.utils.api_key_auth.api_key_scheme` imported but unused
  --> backend/core/api/app/routes/settings.py:12:53
   |
10 | from backend.core.api.app.models.user import User
11 | from backend.core.api.app.routes.auth_routes.auth_dependencies import get_directus_service, get_cache_service, get_compliance_service,…
12 | from backend.core.api.app.utils.api_key_auth import api_key_scheme
   |                                                     ^^^^^^^^^^^^^^
13 | from fastapi.security import HTTPBearer
   |
help: Remove unused import: `backend.core.api.app.utils.api_key_auth.api_key_scheme`

E402 Module level import not at top of file
  --> backend/core/api/app/routes/settings.py:21:1
   |
19 |     auto_error=False  # Don't raise error if missing - allows session auth to work
20 | ) 
21 | import os
   | ^^^^^^^^^
22 | import random
23 | import string
   |

E402 Module level import not at top of file
  --> backend/core/api/app/routes/settings.py:22:1
   |
20 | ) 
21 | import os
22 | import random
   | ^^^^^^^^^^^^^
23 | import string
24 | from backend.core.api.app.services.image_safety import ImageSafetyService
   |

E402 Module level import not at top of file
  --> backend/core/api/app/routes/settings.py:23:1
   |
21 | import os
22 | import random
23 | import string
   | ^^^^^^^^^^^^^
24 | from backend.core.api.app.services.image_safety import ImageSafetyService
25 | from backend.core.api.app.services.s3 import S3UploadService
   |

E402 Module level import not at top of file
  --> backend/core/api/app/routes/settings.py:24:1
   |
22 | import random
23 | import string
24 | from backend.core.api.app.services.image_safety import ImageSafetyService
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
25 | from backend.core.api.app.services.s3 import S3UploadService
26 | from backend.core.api.app.services.compliance import ComplianceService
   |

E402 Module level import not at top of file
  --> backend/core/api/app/routes/settings.py:25:1
   |
23 | import string
24 | from backend.core.api.app.services.image_safety import ImageSafetyService
25 | from backend.core.api.app.services.s3 import S3UploadService
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
26 | from backend.core.api.app.services.compliance import ComplianceService
27 | from backend.core.api.app.services.limiter import limiter
   |

E402 Module level import not at top of file
  --> backend/core/api/app/routes/settings.py:26:1
   |
24 | from backend.core.api.app.services.image_safety import ImageSafetyService
25 | from backend.core.api.app.services.s3 import S3UploadService
26 | from backend.core.api.app.services.compliance import ComplianceService
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
27 | from backend.core.api.app.services.limiter import limiter
28 | from backend.core.api.app.utils.device_fingerprint import generate_device_fingerprint_hash, _extract_client_ip # Updated imports
   |

E402 Module level import not at top of file
  --> backend/core/api/app/routes/settings.py:27:1
   |
25 | from backend.core.api.app.services.s3 import S3UploadService
26 | from backend.core.api.app.services.compliance import ComplianceService
27 | from backend.core.api.app.services.limiter import limiter
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
28 | from backend.core.api.app.utils.device_fingerprint import generate_device_fingerprint_hash, _extract_client_ip # Updated imports
29 | from backend.core.api.app.schemas.settings import LanguageUpdateRequest, DarkModeUpdateRequest, AutoTopUpLowBalanceRequest, BillingOve…
   |

E402 Module level import not at top of file
  --> backend/core/api/app/routes/settings.py:28:1
   |
26 | from backend.core.api.app.services.compliance import ComplianceService
27 | from backend.core.api.app.services.limiter import limiter
28 | from backend.core.api.app.utils.device_fingerprint import generate_device_fingerprint_hash, _extract_client_ip # Updated imports
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
29 | from backend.core.api.app.schemas.settings import LanguageUpdateRequest, DarkModeUpdateRequest, AutoTopUpLowBalanceRequest, BillingOve…
30 | import hashlib  # For API key hashing and user ID hashing
   |

E402 Module level import not at top of file
  --> backend/core/api/app/routes/settings.py:29:1
   |
27 | from backend.core.api.app.services.limiter import limiter
28 | from backend.core.api.app.utils.device_fingerprint import generate_device_fingerprint_hash, _extract_client_ip # Updated imports
29 | from backend.core.api.app.schemas.settings import LanguageUpdateRequest, DarkModeUpdateRequest, AutoTopUpLowBalanceRequest, BillingOverviewResponse, InvoiceResponse # Im…
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
30 | import hashlib  # For API key hashing and user ID hashing
31 | import secrets  # For secure API key generation
   |

E402 Module level import not at top of file
  --> backend/core/api/app/routes/settings.py:30:1
   |
28 | from backend.core.api.app.utils.device_fingerprint import generate_device_fingerprint_hash, _extract_client_ip # Updated imports
29 | from backend.core.api.app.schemas.settings import LanguageUpdateRequest, DarkModeUpdateRequest, AutoTopUpLowBalanceRequest, BillingOve…
30 | import hashlib  # For API key hashing and user ID hashing
   | ^^^^^^^^^^^^^^
31 | import secrets  # For secure API key generation
32 | from datetime import datetime, timezone
   |

E402 Module level import not at top of file
  --> backend/core/api/app/routes/settings.py:31:1
   |
29 | from backend.core.api.app.schemas.settings import LanguageUpdateRequest, DarkModeUpdateRequest, AutoTopUpLowBalanceRequest, BillingOve…
30 | import hashlib  # For API key hashing and user ID hashing
31 | import secrets  # For secure API key generation
   | ^^^^^^^^^^^^^^
32 | from datetime import datetime, timezone
   |

F401 [*] `secrets` imported but unused
  --> backend/core/api/app/routes/settings.py:31:8
   |
29 | from backend.core.api.app.schemas.settings import LanguageUpdateRequest, DarkModeUpdateRequest, AutoTopUpLowBalanceRequest, BillingOve…
30 | import hashlib  # For API key hashing and user ID hashing
31 | import secrets  # For secure API key generation
   |        ^^^^^^^
32 | from datetime import datetime, timezone
   |
help: Remove unused import: `secrets`

E402 Module level import not at top of file
  --> backend/core/api/app/routes/settings.py:32:1
   |
30 | import hashlib  # For API key hashing and user ID hashing
31 | import secrets  # For secure API key generation
32 | from datetime import datetime, timezone
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
33 |
34 | router = APIRouter(prefix="/v1/settings", tags=["Settings"])
   |

E722 Do not use bare `except`
    --> backend/core/api/app/routes/settings.py:1239:9
     |
1237 |             year, month = map(int, year_month.split("-"))
1238 |             datetime(year, month, 1)  # Validate it's a valid date
1239 |         except:
     |         ^^^^^^
1240 |             raise HTTPException(status_code=400, detail="Invalid year_month format. Must be 'YYYY-MM'")
     |

F401 [*] `backend.core.api.app.utils.server_mode.get_hosting_domain` imported but unused
    --> backend/core/api/app/routes/settings.py:1726:13
     |
1724 |             is_payment_enabled,
1725 |             get_server_edition,
1726 |             get_hosting_domain,
     |             ^^^^^^^^^^^^^^^^^^
1727 |             validate_request_domain
1728 |         )
     |
help: Remove unused import: `backend.core.api.app.utils.server_mode.get_hosting_domain`

Found 17 errors.
[*] 4 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/settings.py
All checks passed!
Python: ok backend/core/api/app/routes/share.py
F401 [*] `fastapi.Body` imported but unused
 --> backend/core/api/app/routes/skills.py:8:65
  |
6 | import httpx
7 | from typing import Dict, Any, Optional, List
8 | from fastapi import APIRouter, HTTPException, Request, Depends, Body
  |                                                                 ^^^^
9 | from pydantic import BaseModel
  |
help: Remove unused import: `fastapi.Body`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/routes/skills.py
All checks passed!
Python: ok backend/core/api/app/routes/usage_api.py
All checks passed!
Python: ok backend/core/api/app/routes/websockets.py
All checks passed!
Python: ok backend/core/api/app/schemas/__init__.py
All checks passed!
Python: ok backend/core/api/app/schemas/ai_skill_schemas.py
All checks passed!
Python: ok backend/core/api/app/schemas/app_metadata_schemas.py
F401 [*] `typing.Union` imported but unused
 --> backend/core/api/app/schemas/auth.py:2:41
  |
1 | from pydantic import BaseModel, EmailStr, Field
2 | from typing import Optional, Dict, Any, Union, List
  |                                         ^^^^^
3 | from backend.core.api.app.schemas.user import UserResponse
  |
help: Remove unused import: `typing.Union`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/schemas/auth.py
F401 [*] `typing.Dict` imported but unused
 --> backend/core/api/app/schemas/auth_2fa.py:2:36
  |
1 | from pydantic import BaseModel, Field
2 | from typing import List, Optional, Dict, Any
  |                                    ^^^^
3 |
4 | class Setup2FAInitiateRequest(BaseModel):
  |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
 --> backend/core/api/app/schemas/auth_2fa.py:2:42
  |
1 | from pydantic import BaseModel, Field
2 | from typing import List, Optional, Dict, Any
  |                                          ^^^
3 |
4 | class Setup2FAInitiateRequest(BaseModel):
  |
help: Remove unused import

Found 2 errors.
[*] 2 fixable with the `--fix` option.
Python: error backend/core/api/app/schemas/auth_2fa.py
F401 [*] `typing.Optional` imported but unused
 --> backend/core/api/app/schemas/auth_recoverykey.py:2:20
  |
1 | from pydantic import BaseModel, Field
2 | from typing import Optional
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Optional`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/schemas/auth_recoverykey.py
All checks passed!
Python: ok backend/core/api/app/schemas/chat.py
F401 [*] `typing.Dict` imported but unused
 --> backend/core/api/app/schemas/payment.py:2:30
  |
1 | from pydantic import BaseModel, Field
2 | from typing import Optional, Dict, Any
  |                              ^^^^
3 |
4 | # --- Request Models ---
  |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
 --> backend/core/api/app/schemas/payment.py:2:36
  |
1 | from pydantic import BaseModel, Field
2 | from typing import Optional, Dict, Any
  |                                    ^^^
3 |
4 | # --- Request Models ---
  |
help: Remove unused import

Found 2 errors.
[*] 2 fixable with the `--fix` option.
Python: error backend/core/api/app/schemas/payment.py
All checks passed!
Python: ok backend/core/api/app/schemas/settings.py
All checks passed!
Python: ok backend/core/api/app/schemas/user.py
F401 `backend.core.api.app.services.directus.DirectusService` imported but unused; consider removing, adding to `__all__`, or using a redundant alias
 --> backend/core/api/app/services/__init__.py:2:52
  |
1 | # Import services for use elsewhere in the application
2 | from backend.core.api.app.services.directus import DirectusService
  |                                                    ^^^^^^^^^^^^^^^
3 | # Import other services as needed
  |
help: Use an explicit re-export: `DirectusService as DirectusService`

Found 1 error.
Python: error backend/core/api/app/services/__init__.py
F401 [*] `decimal.Decimal` imported but unused
 --> backend/core/api/app/services/billing_service.py:2:21
  |
1 | import logging
2 | from decimal import Decimal, InvalidOperation
  |                     ^^^^^^^
3 | from fastapi import HTTPException
4 | import time
  |
help: Remove unused import

F401 [*] `decimal.InvalidOperation` imported but unused
 --> backend/core/api/app/services/billing_service.py:2:30
  |
1 | import logging
2 | from decimal import Decimal, InvalidOperation
  |                              ^^^^^^^^^^^^^^^^
3 | from fastapi import HTTPException
4 | import time
  |
help: Remove unused import

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/billing_service.py:200:38
    |
198 |                         # For incognito chats, use "incognito" as chat_id for aggregation
199 |                         chat_id = "incognito"
200 |                         logger.debug(f"Using 'incognito' as chat_id for incognito chat usage tracking")
    |                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
201 |                     else:
202 |                         chat_id = chat_id_val.strip()
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/billing_service.py:612:34
    |
611 |             if not api_key:
612 |                 raise ValueError(f"Stripe API key not found in vault")
    |                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
613 |
614 |             return api_key
    |
help: Remove extraneous `f` prefix

Found 4 errors.
[*] 4 fixable with the `--fix` option.
Python: error backend/core/api/app/services/billing_service.py
F541 [*] f-string without any placeholders
  --> backend/core/api/app/services/cache.py:76:30
   |
74 | …             logger.info(f"Successfully cached discovered_apps_metadata to Redis with key '{DISCOVERED_APPS_METADATA_CACHE_KEY}' (no …
75 | …         else:
76 | …             logger.error(f"Failed to cache discovered_apps_metadata: Redis client not available.")
   |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
77 | …     except Exception as e:
78 | …         logger.error(f"Failed to set discovered_apps_metadata in cache: {e}", exc_info=True)
   |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/cache.py:192:29
    |
190 |             else:
191 |                 instructions = json.loads(instructions_json)
192 |                 logger.info(f"Successfully retrieved base_instructions from cache.")
    |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
193 |                 return instructions
194 |         except json.JSONDecodeError as jde:
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/cache.py:318:30
    |
316 |             if isinstance(model_id, bytes):
317 |                 model_id = model_id.decode('utf-8')
318 |                 logger.debug(f"Decoded bytes response from cache to string")
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
319 |
320 |             if isinstance(model_id, str):
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/cache.py:372:30
    |
370 |             else:
371 |                 config = json.loads(config_json)
372 |                 logger.debug(f"Successfully retrieved prompt_injection_detection_config from cache.")
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
373 |                 return config
374 |         except json.JSONDecodeError as jde:
    |
help: Remove extraneous `f` prefix

Found 4 errors.
[*] 4 fixable with the `--fix` option.
Python: error backend/core/api/app/services/cache.py
All checks passed!
Python: ok backend/core/api/app/services/cache_base.py
F541 [*] f-string without any placeholders
  --> backend/core/api/app/services/cache_chat_mixin.py:37:26
   |
35 |         client = await self.client
36 |         if not client:
37 |             logger.error(f"Redis client not available for set_new_chat_suggestions")
   |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
38 |             return False
   |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
  --> backend/core/api/app/services/cache_chat_mixin.py:64:26
   |
62 |         client = await self.client
63 |         if not client:
64 |             logger.error(f"Redis client not available for get_new_chat_suggestions")
   |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
65 |             return None
   |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
  --> backend/core/api/app/services/cache_chat_mixin.py:96:26
   |
94 |         client = await self.client
95 |         if not client:
96 |             logger.error(f"Redis client not available for delete_new_chat_suggestions")
   |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
97 |             return False
   |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/cache_chat_mixin.py:120:26
    |
118 |         client = await self.client
119 |         if not client:
120 |             logger.error(f"[REDIS_DEBUG] No Redis client available for add_chat_to_ids_versions")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
121 |             return False
122 |         key = self._get_user_chat_ids_versions_key(user_id)
    |
help: Remove extraneous `f` prefix

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:149:22
    |
147 |         """Removes a chat_id from the sorted set."""
148 |         client = await self.client
149 |         if not client: return False
    |                      ^
150 |         key = self._get_user_chat_ids_versions_key(user_id)
151 |         try:
    |

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/cache_chat_mixin.py:164:26
    |
162 |         client = await self.client
163 |         if not client: 
164 |             logger.error(f"[REDIS_DEBUG] No Redis client available for get_chat_ids_versions")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
165 |             return []
166 |         key = self._get_user_chat_ids_versions_key(user_id)
    |
help: Remove extraneous `f` prefix

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:229:22
    |
227 |         """Sets the component versions for a chat."""
228 |         client = await self.client
229 |         if not client: return False
    |                      ^
230 |         key = self._get_chat_versions_key(user_id, chat_id)
231 |         data_to_set = versions.model_dump()
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:247:22
    |
245 |         """Gets the component versions for a chat."""
246 |         client = await self.client
247 |         if not client: return None
    |                      ^
248 |         key = self._get_chat_versions_key(user_id, chat_id)
249 |         logger.debug(f"CACHE_OP: HGETALL for key '{key}'")
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:295:22
    |
293 |         """
294 |         client = await self.client
295 |         if not client: return None
    |                      ^
296 |         key = self._get_chat_versions_key(user_id, chat_id)
297 |         final_ttl = self.CHAT_VERSIONS_TTL
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:323:22
    |
321 |         """
322 |         client = await self.client
323 |         if not client: return False
    |                      ^
324 |         key = self._get_chat_versions_key(user_id, chat_id)
325 |         final_ttl = self.CHAT_VERSIONS_TTL
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:356:22
    |
354 |         """
355 |         client = await self.client
356 |         if not client: return None
    |                      ^
357 |
358 |         draft_key = self._get_user_chat_draft_key(user_id, chat_id)
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:413:22
    |
411 |         """
412 |         client = await self.client
413 |         if not client: return False
    |                      ^
414 |         key = self._get_user_chat_draft_key(user_id, chat_id)
415 |         try:
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:437:22
    |
435 |         """
436 |         client = await self.client
437 |         if not client: return None
    |                      ^
438 |         key = self._get_user_chat_draft_key(user_id, chat_id)
439 |         try:
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:470:22
    |
468 |         """
469 |         client = await self.client
470 |         if not client: return False
    |                      ^
471 |         key = self._get_user_chat_draft_key(user_id, chat_id)
472 |         try:
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:520:22
    |
518 |         """Sets the list item data for a chat."""
519 |         client = await self.client
520 |         if not client: return False
    |                      ^
521 |         key = self._get_chat_list_item_data_key(user_id, chat_id)
522 |         try:
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:539:22
    |
537 |         """Gets the list item data for a chat. Optionally refreshes TTL on access."""
538 |         client = await self.client
539 |         if not client: return None
    |                      ^
540 |         key = self._get_chat_list_item_data_key(user_id, chat_id)
541 |         try:
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:569:22
    |
567 |         """
568 |         client = await self.client
569 |         if not client: return False
    |                      ^
570 |         key = self._get_chat_list_item_data_key(user_id, chat_id)
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:587:22
    |
585 |         """Increments the unread_count for a chat. Refreshes TTL. Returns new count or None."""
586 |         client = await self.client
587 |         if not client: return None
    |                      ^
588 |         key = self._get_chat_list_item_data_key(user_id, chat_id)
589 |         try:
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:600:22
    |
598 |         """Refreshes the TTL for the chat's list_item_data key."""
599 |         client = await self.client
600 |         if not client: return False
    |                      ^
601 |         key = self._get_chat_list_item_data_key(user_id, chat_id)
602 |         try:
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:636:22
    |
634 |         """Updates the scroll position for a chat by storing the last visible message ID."""
635 |         client = await self.client
636 |         if not client: return False
    |                      ^
637 |         key = self._get_chat_list_item_data_key(user_id, chat_id)
638 |         try:
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:650:22
    |
648 |         """Updates the read status (unread count) for a chat."""
649 |         client = await self.client
650 |         if not client: return False
    |                      ^
651 |         key = self._get_chat_list_item_data_key(user_id, chat_id)
652 |         try:
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:679:22
    |
677 |         """Adds an encrypted message (JSON string) to the chat's history (prepends). Optionally trims list."""
678 |         client = await self.client
679 |         if not client: return False
    |                      ^
680 |         key = self._get_chat_messages_key(user_id, chat_id)
681 |         try:
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:694:22
    |
692 |         """Gets encrypted messages (JSON strings) from chat history. Returns newest first if LPUSHed."""
693 |         client = await self.client
694 |         if not client: return []
    |                      ^
695 |         key = self._get_chat_messages_key(user_id, chat_id)
696 |         try:
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:706:22
    |
704 |         """Sets the entire message history for a chat. Overwrites existing history."""
705 |         client = await self.client
706 |         if not client: return False
    |                      ^
707 |         key = self._get_chat_messages_key(user_id, chat_id)
708 |         try:
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:721:22
    |
719 |         """Deletes the message history for a specific chat."""
720 |         client = await self.client
721 |         if not client: return False
    |                      ^
722 |         key = self._get_chat_messages_key(user_id, chat_id)
723 |         try:
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:739:22
    |
737 |         """
738 |         client = await self.client
739 |         if not client: return False
    |                      ^
740 |         key = self._get_sync_messages_key(user_id, chat_id)
741 |         try:
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:758:22
    |
756 |         """
757 |         client = await self.client
758 |         if not client: return []
    |                      ^
759 |         key = self._get_sync_messages_key(user_id, chat_id)
760 |         try:
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:772:22
    |
770 |         """Deletes the sync message history for a specific chat."""
771 |         client = await self.client
772 |         if not client: return False
    |                      ^
773 |         key = self._get_sync_messages_key(user_id, chat_id)
774 |         try:
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:788:22
    |
786 |         """
787 |         client = await self.client
788 |         if not client: return 0
    |                      ^
789 |         try:
790 |             pattern = f"user:{user_id}:chat:*:messages:sync"
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:817:22
    |
815 |         """
816 |         client = await self.client
817 |         if not client: return False
    |                      ^
818 |         key = self._get_ai_messages_key(user_id, chat_id)
819 |         try:
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:836:22
    |
834 |         """
835 |         client = await self.client
836 |         if not client: return []
    |                      ^
837 |         key = self._get_ai_messages_key(user_id, chat_id)
838 |         try:
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/services/cache_chat_mixin.py:853:22
    |
851 |         """
852 |         client = await self.client
853 |         if not client: return False
    |                      ^
854 |         key = self._get_ai_messages_key(user_id, chat_id)
855 |         try:
    |

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/cache_chat_mixin.py:971:26
    |
969 |         client = await self.client
970 |         if not client:
971 |             logger.error(f"Redis client not available for set_active_ai_task")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
972 |             return False
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
    --> backend/core/api/app/services/cache_chat_mixin.py:1043:26
     |
1041 |         client = await self.client
1042 |         if not client:
1043 |             logger.error(f"Redis client not available for queue_message")
     |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
1044 |             return False
     |
help: Remove extraneous `f` prefix

Found 34 errors.
[*] 7 fixable with the `--fix` option.
Python: error backend/core/api/app/services/cache_chat_mixin.py
All checks passed!
Python: ok backend/core/api/app/services/cache_config.py
F401 [*] `typing.Optional` imported but unused
 --> backend/core/api/app/services/cache_legacy_mixin.py:3:20
  |
1 | import logging
2 | import time
3 | from typing import Optional
  |                    ^^^^^^^^
4 |
5 | logger = logging.getLogger(__name__)
  |
help: Remove unused import: `typing.Optional`

E701 Multiple statements on one line (colon)
  --> backend/core/api/app/services/cache_legacy_mixin.py:59:26
   |
57 |         try:
58 |             client = await self.client
59 |             if not client: return False
   |                          ^
60 |             set_key = f"{self.USER_CHATS_SET_PREFIX}{hashed_user_id}"
61 |             logger.debug(f"Removing chat '{chat_id}' from user set '{set_key}'")
   |

Found 2 errors.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/services/cache_legacy_mixin.py
All checks passed!
Python: ok backend/core/api/app/services/cache_order_mixin.py
F401 [*] `typing.Any` imported but unused
 --> backend/core/api/app/services/cache_user_mixin.py:3:36
  |
1 | import logging
2 | import hashlib
3 | from typing import Optional, Dict, Any, List
  |                                    ^^^
4 |
5 | logger = logging.getLogger(__name__)
  |
help: Remove unused import

F401 [*] `typing.List` imported but unused
 --> backend/core/api/app/services/cache_user_mixin.py:3:41
  |
1 | import logging
2 | import hashlib
3 | from typing import Optional, Dict, Any, List
  |                                         ^^^^
4 |
5 | logger = logging.getLogger(__name__)
  |
help: Remove unused import

Found 2 errors.
[*] 2 fixable with the `--fix` option.
Python: error backend/core/api/app/services/cache_user_mixin.py
F401 [*] `json` imported but unused
 --> backend/core/api/app/services/compliance.py:2:8
  |
1 | import logging
2 | import json
  |        ^^^^
3 | from datetime import datetime
4 | from typing import Optional, Dict, Any, Union
  |
help: Remove unused import: `json`

F811 [*] Redefinition of unused `datetime` from line 3
 --> backend/core/api/app/services/compliance.py:3:22
  |
1 | import logging
2 | import json
3 | from datetime import datetime
  |                      -------- previous definition of `datetime` here
4 | from typing import Optional, Dict, Any, Union
5 | import ipaddress
6 | from datetime import datetime # Ensure datetime is imported
  |                      ^^^^^^^^ `datetime` redefined here
7 | from backend.core.api.app.utils.device_fingerprint import hash_ip_address, _extract_client_ip
  |
help: Remove definition: `datetime`

F401 [*] `backend.core.api.app.utils.device_fingerprint._extract_client_ip` imported but unused
 --> backend/core/api/app/services/compliance.py:7:76
  |
5 | import ipaddress
6 | from datetime import datetime # Ensure datetime is imported
7 | from backend.core.api.app.utils.device_fingerprint import hash_ip_address, _extract_client_ip
  |                                                                            ^^^^^^^^^^^^^^^^^^
8 |
9 | # Configure a special logger for compliance events
  |
help: Remove unused import: `backend.core.api.app.utils.device_fingerprint._extract_client_ip`

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/core/api/app/services/compliance.py
All checks passed!
Python: ok backend/core/api/app/services/creators/__init__.py
F401 [*] `typing.Dict` imported but unused
  --> backend/core/api/app/services/creators/revenue_service.py:9:30
   |
 7 | import time
 8 | import asyncio
 9 | from typing import Optional, Dict, Any
   |                              ^^^^
10 | from backend.core.api.app.services.directus import DirectusService
11 | from backend.core.api.app.utils.encryption import (
   |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
  --> backend/core/api/app/services/creators/revenue_service.py:9:36
   |
 7 | import time
 8 | import asyncio
 9 | from typing import Optional, Dict, Any
   |                                    ^^^
10 | from backend.core.api.app.services.directus import DirectusService
11 | from backend.core.api.app.utils.encryption import (
   |
help: Remove unused import

F541 [*] f-string without any placeholders
  --> backend/core/api/app/services/creators/revenue_service.py:83:28
   |
82 |         if not owner_id or not content_id:
83 |             logger.warning(f"Cannot create creator income entry: missing owner_id or content_id")
   |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
84 |             return False
   |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
  --> backend/core/api/app/services/creators/revenue_service.py:94:30
   |
93 |             if not all([hashed_owner_id, hashed_content_id, hashed_app_id, hashed_skill_id]):
94 |                 logger.error(f"Failed to hash identifiers for creator income entry")
   |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
95 |                 return False
   |
help: Remove extraneous `f` prefix

Found 4 errors.
[*] 4 fixable with the `--fix` option.
Python: error backend/core/api/app/services/creators/revenue_service.py
All checks passed!
Python: ok backend/core/api/app/services/directus/__init__.py
All checks passed!
Python: ok backend/core/api/app/services/directus/admin_methods.py
F821 Undefined name `DirectusService`
  --> backend/core/api/app/services/directus/analytics_methods.py:23:52
   |
21 |     and does not contain any user-specific or encrypted data.
22 |     """
23 |     def __init__(self, directus_service_instance: 'DirectusService'):
   |                                                    ^^^^^^^^^^^^^^^
24 |         self.directus_service = directus_service_instance
25 |         self.collection = "app_analytics"
   |

Found 1 error.
Python: error backend/core/api/app/services/directus/analytics_methods.py
F401 [*] `backend.core.api.app.utils.device_fingerprint._extract_client_ip` imported but unused
  --> backend/core/api/app/services/directus/api_key_device_methods.py:80:89
   |
78 |     """
79 |     try:
80 |         from backend.core.api.app.utils.device_fingerprint import get_geo_data_from_ip, _extract_client_ip
   |                                                                                         ^^^^^^^^^^^^^^^^^^
81 |         
82 |         # Get user's vault_key_id for encryption
   |
help: Remove unused import: `backend.core.api.app.utils.device_fingerprint._extract_client_ip`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/services/directus/api_key_device_methods.py
F401 [*] `httpx` imported but unused
 --> backend/core/api/app/services/directus/api_methods.py:1:8
  |
1 | import httpx
  |        ^^^^^
2 | import logging
3 | import asyncio
  |
help: Remove unused import: `httpx`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/services/directus/api_methods.py
All checks passed!
Python: ok backend/core/api/app/services/directus/app_settings_and_memories_methods.py
F401 [*] `os` imported but unused
 --> backend/core/api/app/services/directus/auth_methods.py:1:8
  |
1 | import os
  |        ^^
2 | import httpx
3 | import logging
  |
help: Remove unused import: `os`

F841 Local variable `admin_required` is assigned to but never used
  --> backend/core/api/app/services/directus/auth_methods.py:90:5
   |
88 |     """Get a valid authentication token, refreshing if necessary"""
89 |     # Always use admin token regardless of admin_required parameter
90 |     admin_required = True
   |     ^^^^^^^^^^^^^^
91 |     
92 |     # If we have an admin token and not forcing refresh, assume it's valid
   |
help: Remove assignment to unused variable `admin_required`

Found 2 errors.
[*] 1 fixable with the `--fix` option (1 hidden fix can be enabled with the `--unsafe-fixes` option).
Python: error backend/core/api/app/services/directus/auth_methods.py
All checks passed!
Python: ok backend/core/api/app/services/directus/chat_methods.py
All checks passed!
Python: ok backend/core/api/app/services/directus/demo_chat_methods.py
All checks passed!
Python: ok backend/core/api/app/services/directus/directus.py
F821 Undefined name `DirectusService`
  --> backend/core/api/app/services/directus/embed_methods.py:61:52
   |
59 |     """Methods for interacting with embeds collection in Directus."""
60 |     
61 |     def __init__(self, directus_service_instance: 'DirectusService'):
   |                                                    ^^^^^^^^^^^^^^^
62 |         self.directus_service = directus_service_instance
   |

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/directus/embed_methods.py:270:30
    |
268 |             response = await self.directus_service.get_items('embeds', params=params, no_cache=True)
269 |             if response and isinstance(response, list) and len(response) > 0:
270 |                 logger.debug(f"Found duplicate embed with content_hash")
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
271 |                 return response[0]
272 |             else:
    |
help: Remove extraneous `f` prefix

Found 2 errors.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/services/directus/embed_methods.py
All checks passed!
Python: ok backend/core/api/app/services/directus/gift_card_methods.py
All checks passed!
Python: ok backend/core/api/app/services/directus/invite_methods.py
F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/directus/usage.py:230:22
    |
228 |             api_key_hash: Optional API key hash (for API key summaries)
229 |         """
230 |         log_prefix = f"DirectusService (usage summaries):"
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
231 |         
232 |         try:
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/directus/usage.py:559:22
    |
557 |             List of summary records grouped by month
558 |         """
559 |         log_prefix = f"DirectusService (usage summaries):"
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
560 |         logger.info(f"{log_prefix} Fetching {summary_type} summaries for user '{user_id_hash}', last {months} months")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/directus/usage.py:630:22
    |
628 |             List of decrypted usage entries
629 |         """
630 |         log_prefix = f"DirectusService (usage details):"
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
631 |         logger.info(f"{log_prefix} Fetching {summary_type} usage entries for '{identifier}', month '{year_month}'")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/directus/usage.py:721:22
    |
719 |         Similar to get_user_usage_entries but for already-fetched entries.
720 |         """
721 |         log_prefix = f"DirectusService (usage):"
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^
722 |         
723 |         async def process_entry(entry: Dict[str, Any]) -> Optional[Dict[str, Any]]:
    |
help: Remove extraneous `f` prefix

Found 4 errors.
[*] 4 fixable with the `--fix` option.
Python: error backend/core/api/app/services/directus/usage.py
All checks passed!
Python: ok backend/core/api/app/services/directus/usage_methods.py
All checks passed!
Python: ok backend/core/api/app/services/directus/user/__init__.py
All checks passed!
Python: ok backend/core/api/app/services/directus/user/delete_user.py
F401 [*] `time` imported but unused
 --> backend/core/api/app/services/directus/user/device_management.py:3:8
  |
1 | import logging
2 | import json
3 | import time
  |        ^^^^
4 | from typing import List, Dict, Any, Optional, Tuple
  |
help: Remove unused import: `time`

F401 [*] `typing.Dict` imported but unused
 --> backend/core/api/app/services/directus/user/device_management.py:4:26
  |
2 | import json
3 | import time
4 | from typing import List, Dict, Any, Optional, Tuple
  |                          ^^^^
5 |
6 | logger = logging.getLogger(__name__)
  |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
 --> backend/core/api/app/services/directus/user/device_management.py:4:32
  |
2 | import json
3 | import time
4 | from typing import List, Dict, Any, Optional, Tuple
  |                                ^^^
5 |
6 | logger = logging.getLogger(__name__)
  |
help: Remove unused import

F401 [*] `typing.Optional` imported but unused
 --> backend/core/api/app/services/directus/user/device_management.py:4:37
  |
2 | import json
3 | import time
4 | from typing import List, Dict, Any, Optional, Tuple
  |                                     ^^^^^^^^
5 |
6 | logger = logging.getLogger(__name__)
  |
help: Remove unused import

F841 Local variable `initial_connected_devices_count` is assigned to but never used
  --> backend/core/api/app/services/directus/user/device_management.py:86:9
   |
84 |                 logger.debug(f"No connected_devices found in Directus for user {user_id[:6]}. Starting with empty list.")
85 |
86 |         initial_connected_devices_count = len(connected_devices)
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
87 |         needs_update = False
   |
help: Remove assignment to unused variable `initial_connected_devices_count`

Found 5 errors.
[*] 4 fixable with the `--fix` option (1 hidden fix can be enabled with the `--unsafe-fixes` option).
Python: error backend/core/api/app/services/directus/user/device_management.py
All checks passed!
Python: ok backend/core/api/app/services/directus/user/update_user.py
F821 Undefined name `e`
   --> backend/core/api/app/services/directus/user/user_authentication.py:135:94
    |
133 |                             except json.JSONDecodeError:
134 |                                 # Log error, but don't set default. Let it propagate.
135 |                                 logger.error(f"Failed to decode decrypted devices JSON: {str(e)}")
    |                                                                                              ^
136 |                                 # If devices were present but failed decryption, remove? Or leave encrypted? Leave for now.
137 |                         else:
    |

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/directus/user/user_authentication.py:311:25
    |
310 |         if not users or len(users) == 0:
311 |             logger.info(f"No user found with matching hashed email")
    |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
312 |             return False, None, "login.email_or_password_wrong.text"
    |
help: Remove extraneous `f` prefix

F821 Undefined name `e`
   --> backend/core/api/app/services/directus/user/user_authentication.py:432:98
    |
430 | …                             user_data["devices"] = json.loads(decrypted_devices)
431 | …                         except json.JSONDecodeError:
432 | …                             logger.error(f"Failed to decode decrypted devices JSON: {str(e)}")
    |                                                                                            ^
433 | …                     else:
434 | …                         logger.error("Devices decryption failed!")
    |

Found 3 errors.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/services/directus/user/user_authentication.py
F401 [*] `uuid` imported but unused
 --> backend/core/api/app/services/directus/user/user_creation.py:3:8
  |
1 | import logging
2 | import json
3 | import uuid
  |        ^^^^
4 | import time
5 | import os
  |
help: Remove unused import: `uuid`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/services/directus/user/user_creation.py
F401 [*] `base64` imported but unused
 --> backend/core/api/app/services/directus/user/user_lookup.py:3:8
  |
1 | import logging
2 | import json
3 | import base64
  |        ^^^^^^
4 | import hashlib
5 | from datetime import datetime
  |
help: Remove unused import: `base64`

F401 [*] `hashlib` imported but unused
 --> backend/core/api/app/services/directus/user/user_lookup.py:4:8
  |
2 | import json
3 | import base64
4 | import hashlib
  |        ^^^^^^^
5 | from datetime import datetime
6 | from typing import Dict, Any, Optional, Tuple, List # Add List import
  |
help: Remove unused import: `hashlib`

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/directus/user/user_lookup.py:108:29
    |
107 |             if users and len(users) > 0:
108 |                 logger.info(f"Found user with matching hashed email")
    |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
109 |                 user = users[0]
110 |                 return True, user, "User found"
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/directus/user/user_lookup.py:112:29
    |
110 |                 return True, user, "User found"
111 |             else:
112 |                 logger.info(f"No user found with matching hashed email")
    |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
113 |                 return False, None, "User not found"
114 |         else:
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/directus/user/user_lookup.py:143:29
    |
142 |             if not users or len(users) == 0:
143 |                 logger.info(f"No user found with matching hashed email")
    |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
144 |                 return False, None, "login.email_or_password_wrong.text"
    |
help: Remove extraneous `f` prefix

Found 5 errors.
[*] 5 fixable with the `--fix` option.
Python: error backend/core/api/app/services/directus/user/user_lookup.py
F541 [*] f-string without any placeholders
  --> backend/core/api/app/services/directus/user/user_profile.py:38:21
   |
37 |         vault_key_id = user_data.get("vault_key_id")
38 |         logger.info(f"Found vault_key_id")
   |                     ^^^^^^^^^^^^^^^^^^^^^
39 |         
40 |         if not vault_key_id:
   |
help: Remove extraneous `f` prefix

F821 Undefined name `httpx`
   --> backend/core/api/app/services/directus/user/user_profile.py:316:20
    |
314 |         headers = {"Authorization": f"Bearer {access_token}"}
315 |         
316 |         async with httpx.AsyncClient() as client:
    |                    ^^^^^
317 |             response = await client.get(url, headers=headers)
    |

Found 2 errors.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/services/directus/user/user_profile.py
All checks passed!
Python: ok backend/core/api/app/services/domain_security.py
All checks passed!
Python: ok backend/core/api/app/services/email/__init__.py
F541 [*] f-string without any placeholders
  --> backend/core/api/app/services/email/config_loader.py:42:25
   |
40 |                 return {}
41 |                 
42 |             logger.info(f"Successfully loaded shared URL configuration")
   |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
43 |             return config
   |
help: Remove extraneous `f` prefix

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/services/email/config_loader.py
All checks passed!
Python: ok backend/core/api/app/services/email/html_processor.py
F401 [*] `typing.Dict` imported but unused
 --> backend/core/api/app/services/email/mjml_processor.py:5:20
  |
3 | import base64
4 | import logging
5 | from typing import Dict
  |                    ^^^^
6 |
7 | logger = logging.getLogger(__name__)
  |
help: Remove unused import: `typing.Dict`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/services/email/mjml_processor.py
F401 [*] `typing.Tuple` imported but unused
 --> backend/core/api/app/services/email/renderer.py:4:31
  |
2 | import logging
3 | import re
4 | from typing import Dict, Any, Tuple
  |                               ^^^^^
5 | from mjml import mjml2html
6 | from jinja2 import Template
  |
help: Remove unused import: `typing.Tuple`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/services/email/renderer.py
F541 [*] f-string without any placeholders
  --> backend/core/api/app/services/email/variable_processor.py:38:26
   |
36 |             processed_context['header_text'] = "OpenMates - Self-Hosted Edition"
37 |             processed_context['header_link_url'] = "https://github.com/glowingkitty/OpenMates"
38 |             logger.debug(f"Set header_text and header_link_url for self-hosted instance")
   |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
39 |         else:
40 |             # Regular header - use "#" as placeholder to avoid empty href
   |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
  --> backend/core/api/app/services/email/variable_processor.py:43:26
   |
41 |             processed_context['header_text'] = "OpenMates"
42 |             processed_context['header_link_url'] = "#"
43 |             logger.debug(f"Set header_text and header_link_url for regular instance")
   |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
44 |     except Exception as e:
45 |         # If we can't determine server edition, default to False (not self-hosted)
   |
help: Remove extraneous `f` prefix

Found 2 errors.
[*] 2 fixable with the `--fix` option.
Python: error backend/core/api/app/services/email/variable_processor.py
F401 [*] `base64` imported but unused
 --> backend/core/api/app/services/email_template.py:4:8
  |
2 | import logging
3 | import re
4 | import base64
  |        ^^^^^^
5 | import yaml
6 | from typing import Dict, Any, Optional, Tuple, Union
  |
help: Remove unused import: `base64`

F401 [*] `yaml` imported but unused
 --> backend/core/api/app/services/email_template.py:5:8
  |
3 | import re
4 | import base64
5 | import yaml
  |        ^^^^
6 | from typing import Dict, Any, Optional, Tuple, Union
7 | import aiohttp
  |
help: Remove unused import: `yaml`

F401 [*] `pathlib.Path` imported but unused
  --> backend/core/api/app/services/email_template.py:9:21
   |
 7 | import aiohttp
 8 | import json
 9 | from pathlib import Path
   |                     ^^^^
10 | from mjml import mjml2html
11 | from jinja2 import Template, Environment, FileSystemLoader, select_autoescape
   |
help: Remove unused import: `pathlib.Path`

F401 [*] `mjml.mjml2html` imported but unused
  --> backend/core/api/app/services/email_template.py:10:18
   |
 8 | import json
 9 | from pathlib import Path
10 | from mjml import mjml2html
   |                  ^^^^^^^^^
11 | from jinja2 import Template, Environment, FileSystemLoader, select_autoescape
12 | from premailer import transform  # Add this import for CSS inlining
   |
help: Remove unused import: `mjml.mjml2html`

F401 [*] `jinja2.Template` imported but unused
  --> backend/core/api/app/services/email_template.py:11:20
   |
 9 | from pathlib import Path
10 | from mjml import mjml2html
11 | from jinja2 import Template, Environment, FileSystemLoader, select_autoescape
   |                    ^^^^^^^^
12 | from premailer import transform  # Add this import for CSS inlining
13 | import cssutils  # Add this import to configure cssutils logger
   |
help: Remove unused import

F401 [*] `jinja2.Environment` imported but unused
  --> backend/core/api/app/services/email_template.py:11:30
   |
 9 | from pathlib import Path
10 | from mjml import mjml2html
11 | from jinja2 import Template, Environment, FileSystemLoader, select_autoescape
   |                              ^^^^^^^^^^^
12 | from premailer import transform  # Add this import for CSS inlining
13 | import cssutils  # Add this import to configure cssutils logger
   |
help: Remove unused import

F401 [*] `jinja2.FileSystemLoader` imported but unused
  --> backend/core/api/app/services/email_template.py:11:43
   |
 9 | from pathlib import Path
10 | from mjml import mjml2html
11 | from jinja2 import Template, Environment, FileSystemLoader, select_autoescape
   |                                           ^^^^^^^^^^^^^^^^
12 | from premailer import transform  # Add this import for CSS inlining
13 | import cssutils  # Add this import to configure cssutils logger
   |
help: Remove unused import

F401 [*] `jinja2.select_autoescape` imported but unused
  --> backend/core/api/app/services/email_template.py:11:61
   |
 9 | from pathlib import Path
10 | from mjml import mjml2html
11 | from jinja2 import Template, Environment, FileSystemLoader, select_autoescape
   |                                                             ^^^^^^^^^^^^^^^^^
12 | from premailer import transform  # Add this import for CSS inlining
13 | import cssutils  # Add this import to configure cssutils logger
   |
help: Remove unused import

F401 [*] `premailer.transform` imported but unused
  --> backend/core/api/app/services/email_template.py:12:23
   |
10 | from mjml import mjml2html
11 | from jinja2 import Template, Environment, FileSystemLoader, select_autoescape
12 | from premailer import transform  # Add this import for CSS inlining
   |                       ^^^^^^^^^
13 | import cssutils  # Add this import to configure cssutils logger
14 | import string
   |
help: Remove unused import: `premailer.transform`

F401 [*] `string` imported but unused
  --> backend/core/api/app/services/email_template.py:14:8
   |
12 | from premailer import transform  # Add this import for CSS inlining
13 | import cssutils  # Add this import to configure cssutils logger
14 | import string
   |        ^^^^^^
15 | from email.mime.text import MIMEText
16 | from email.mime.multipart import MIMEMultipart
   |
help: Remove unused import: `string`

F401 [*] `email.mime.text.MIMEText` imported but unused
  --> backend/core/api/app/services/email_template.py:15:29
   |
13 | import cssutils  # Add this import to configure cssutils logger
14 | import string
15 | from email.mime.text import MIMEText
   |                             ^^^^^^^^
16 | from email.mime.multipart import MIMEMultipart
17 | import sys
   |
help: Remove unused import: `email.mime.text.MIMEText`

F401 [*] `email.mime.multipart.MIMEMultipart` imported but unused
  --> backend/core/api/app/services/email_template.py:16:34
   |
14 | import string
15 | from email.mime.text import MIMEText
16 | from email.mime.multipart import MIMEMultipart
   |                                  ^^^^^^^^^^^^^
17 | import sys
18 | from html.parser import HTMLParser
   |
help: Remove unused import: `email.mime.multipart.MIMEMultipart`

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/email_template.py:519:45
    |
517 | …         logger.warning(f"Mailjet response structure unexpected. Response: {response_data}")
518 | …         # Still return True if status is 200 and no errors, as Mailjet might have accepted it
519 | …         logger.info(f"Email sent successfully (Message ID not found in expected format, but status 200 and no errors)")
    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
520 | …     else:
521 | …         logger.info(f"Email sent successfully. Message ID: {message_id}")
    |
help: Remove extraneous `f` prefix

E722 Do not use bare `except`
   --> backend/core/api/app/services/email_template.py:538:25
    |
536 | …                 for error in msg.get('Errors', []):
537 | …                     logger.error(f"Mailjet API error: {error.get('ErrorMessage', 'Unknown error')} (ErrorCode: {error.get('ErrorCod…
538 | …     except:
    |       ^^^^^^
539 | …         pass
540 | …     return False
    |

Found 14 errors.
[*] 13 fixable with the `--fix` option.
Python: error backend/core/api/app/services/email_template.py
E722 Do not use bare `except`
   --> backend/core/api/app/services/embed_service.py:518:17
    |
516 |                         logger.debug(f"{log_prefix} Skipping existing embed reference JSON block")
517 |                         return full_match  # Keep as-is
518 |                 except:
    |                 ^^^^^^
519 |                     pass  # Not valid JSON, treat as code block
    |

F841 Local variable `hashed_chat_id` is assigned to but never used
   --> backend/core/api/app/services/embed_service.py:538:13
    |
537 |             # Hash IDs for privacy
538 |             hashed_chat_id = hashlib.sha256(chat_id.encode()).hexdigest()
    |             ^^^^^^^^^^^^^^
539 |             hashed_message_id = hashlib.sha256(message_id.encode()).hexdigest()
    |
help: Remove assignment to unused variable `hashed_chat_id`

F841 Local variable `hashed_message_id` is assigned to but never used
   --> backend/core/api/app/services/embed_service.py:539:13
    |
537 |             # Hash IDs for privacy
538 |             hashed_chat_id = hashlib.sha256(chat_id.encode()).hexdigest()
539 |             hashed_message_id = hashlib.sha256(message_id.encode()).hexdigest()
    |             ^^^^^^^^^^^^^^^^^
540 |             
541 |             # Create embed data for client storage
    |
help: Remove assignment to unused variable `hashed_message_id`

Found 3 errors.
No fixes available (2 hidden fixes can be enabled with the `--unsafe-fixes` option).
Python: error backend/core/api/app/services/embed_service.py
F401 [*] `os` imported but unused
 --> backend/core/api/app/services/image_safety.py:4:8
  |
2 | import logging
3 | from fastapi import HTTPException
4 | import os
  |        ^^
5 | from backend.core.api.app.utils.secrets_manager import SecretsManager # Import SecretsManager
  |
help: Remove unused import: `os`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/services/image_safety.py
All checks passed!
Python: ok backend/core/api/app/services/invoiceninja/bank_accounts.py
F541 [*] f-string without any placeholders
  --> backend/core/api/app/services/invoiceninja/clients.py:24:17
   |
22 |         The client ID if found, otherwise None.
23 |     """
24 |     logger.info(f"Searching for client...")
   |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^
25 |     params = {
26 |         'filter': user_hash,  # Use the broad filter for searching by hash
   |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
  --> backend/core/api/app/services/invoiceninja/clients.py:35:25
   |
33 |         if len(clients) > 0:
34 |             client_id = clients[0]['id']
35 |             logger.info(f"Found existing client'")
   |                         ^^^^^^^^^^^^^^^^^^^^^^^^^
36 |             return client_id
37 |         else:
   |
help: Remove extraneous `f` prefix

Found 2 errors.
[*] 2 fixable with the `--fix` option.
Python: error backend/core/api/app/services/invoiceninja/clients.py
All checks passed!
Python: ok backend/core/api/app/services/invoiceninja/countries.py
F401 [*] `dataclasses.dataclass` imported but unused
 --> backend/core/api/app/services/invoiceninja/invoiceninja.py:6:25
  |
4 | import logging
5 | import os # Added for environment variable check
6 | from dataclasses import dataclass, field
  |                         ^^^^^^^^^
7 | from typing import Optional, Dict, Any, List, Tuple
8 | from datetime import date # Added for payment date
  |
help: Remove unused import

F401 [*] `dataclasses.field` imported but unused
 --> backend/core/api/app/services/invoiceninja/invoiceninja.py:6:36
  |
4 | import logging
5 | import os # Added for environment variable check
6 | from dataclasses import dataclass, field
  |                                    ^^^^^
7 | from typing import Optional, Dict, Any, List, Tuple
8 | from datetime import date # Added for payment date
  |
help: Remove unused import

F401 [*] `datetime.date` imported but unused
  --> backend/core/api/app/services/invoiceninja/invoiceninja.py:8:22
   |
 6 | from dataclasses import dataclass, field
 7 | from typing import Optional, Dict, Any, List, Tuple
 8 | from datetime import date # Added for payment date
   |                      ^^^^
 9 |
10 | # Assuming SecretsManager is accessible via this relative path
   |
help: Remove unused import: `datetime.date`

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/core/api/app/services/invoiceninja/invoiceninja.py
F401 [*] `os` imported but unused
 --> backend/core/api/app/services/invoiceninja/invoices.py:3:8
  |
1 | # backend/core/api/app/services/invoiceninja/invoices.py
2 | import logging
3 | import os
  |        ^^
4 | import json
5 | import requests # Keep requests import for exception handling
  |
help: Remove unused import: `os`

F401 [*] `json` imported but unused
 --> backend/core/api/app/services/invoiceninja/invoices.py:4:8
  |
2 | import logging
3 | import os
4 | import json
  |        ^^^^
5 | import requests # Keep requests import for exception handling
6 | from typing import Optional, List, Dict, Any, Tuple
  |
help: Remove unused import: `json`

F401 [*] `requests` imported but unused
 --> backend/core/api/app/services/invoiceninja/invoices.py:5:8
  |
3 | import os
4 | import json
5 | import requests # Keep requests import for exception handling
  |        ^^^^^^^^
6 | from typing import Optional, List, Dict, Any, Tuple
  |
help: Remove unused import: `requests`

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/core/api/app/services/invoiceninja/invoices.py
F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/invoiceninja/payments.py:282:24
    |
280 |         logger.info(f"Using payment_invoice_id: {payment_invoice_id} for refund.")
281 |     else:
282 |         logger.warning(f"No payment_invoice_id provided for refund. Using empty string for 'id' field in invoices array (may fail).")
    |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
283 |     
284 |     # Invoice Ninja refund endpoint: POST /api/v1/payments/refund
    |
help: Remove extraneous `f` prefix

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/services/invoiceninja/payments.py
All checks passed!
Python: ok backend/core/api/app/services/invoiceninja/transactions.py
All checks passed!
Python: ok backend/core/api/app/services/limiter.py
F401 [*] `asyncio` imported but unused
  --> backend/core/api/app/services/loki_log_collector.py:10:8
   |
 8 | import logging
 9 | import aiohttp
10 | import asyncio
   |        ^^^^^^^
11 | import json
12 | import tempfile
   |
help: Remove unused import: `asyncio`

F401 [*] `json` imported but unused
  --> backend/core/api/app/services/loki_log_collector.py:11:8
   |
 9 | import aiohttp
10 | import asyncio
11 | import json
   |        ^^^^
12 | import tempfile
13 | import base64
   |
help: Remove unused import: `json`

F401 [*] `base64` imported but unused
  --> backend/core/api/app/services/loki_log_collector.py:13:8
   |
11 | import json
12 | import tempfile
13 | import base64
   |        ^^^^^^
14 | import os
15 | import re
   |
help: Remove unused import: `base64`

F401 [*] `urllib.parse` imported but unused
  --> backend/core/api/app/services/loki_log_collector.py:18:8
   |
16 | from typing import Optional, List, Dict, Any
17 | from datetime import datetime, timedelta, timezone
18 | import urllib.parse
   |        ^^^^^^^^^^^^
19 |
20 | logger = logging.getLogger(__name__)
   |
help: Remove unused import: `urllib.parse`

Found 4 errors.
[*] 4 fixable with the `--fix` option.
Python: error backend/core/api/app/services/loki_log_collector.py
F401 [*] `time` imported but unused
 --> backend/core/api/app/services/metrics.py:1:8
  |
1 | import time
  |        ^^^^
2 | from prometheus_client import Counter, Histogram, Gauge, Summary
3 | from typing import Optional, Dict, Any
  |
help: Remove unused import: `time`

F401 [*] `prometheus_client.Summary` imported but unused
 --> backend/core/api/app/services/metrics.py:2:58
  |
1 | import time
2 | from prometheus_client import Counter, Histogram, Gauge, Summary
  |                                                          ^^^^^^^
3 | from typing import Optional, Dict, Any
4 | import logging
  |
help: Remove unused import: `prometheus_client.Summary`

F401 [*] `typing.Optional` imported but unused
 --> backend/core/api/app/services/metrics.py:3:20
  |
1 | import time
2 | from prometheus_client import Counter, Histogram, Gauge, Summary
3 | from typing import Optional, Dict, Any
  |                    ^^^^^^^^
4 | import logging
  |
help: Remove unused import

F401 [*] `typing.Dict` imported but unused
 --> backend/core/api/app/services/metrics.py:3:30
  |
1 | import time
2 | from prometheus_client import Counter, Histogram, Gauge, Summary
3 | from typing import Optional, Dict, Any
  |                              ^^^^
4 | import logging
  |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
 --> backend/core/api/app/services/metrics.py:3:36
  |
1 | import time
2 | from prometheus_client import Counter, Histogram, Gauge, Summary
3 | from typing import Optional, Dict, Any
  |                                    ^^^
4 | import logging
  |
help: Remove unused import

Found 5 errors.
[*] 5 fixable with the `--fix` option.
Python: error backend/core/api/app/services/metrics.py
All checks passed!
Python: ok backend/core/api/app/services/payment/payment_service.py
E402 Module level import not at top of file
  --> backend/core/api/app/services/payment/revolut_service.py:15:1
   |
14 | # --- Load pricing config and build CURRENCY_DECIMALS mapping ---
15 | import yaml
   | ^^^^^^^^^^^
16 | from pathlib import Path
   |

E402 Module level import not at top of file
  --> backend/core/api/app/services/payment/revolut_service.py:16:1
   |
14 | # --- Load pricing config and build CURRENCY_DECIMALS mapping ---
15 | import yaml
16 | from pathlib import Path
   | ^^^^^^^^^^^^^^^^^^^^^^^^
17 |
18 | PRICING_CONFIG_PATH = Path("/shared/config/pricing.yml")
   |

Found 2 errors.
Python: error backend/core/api/app/services/payment/revolut_service.py
All checks passed!
Python: ok backend/core/api/app/services/payment/stripe_service.py
F401 [*] `decimal.Decimal` imported but unused
  --> backend/core/api/app/services/payment_tier_service.py:25:21
   |
23 | from datetime import datetime, timezone
24 | from typing import Dict, Any, Optional, Tuple
25 | from decimal import Decimal
   |                     ^^^^^^^
26 |
27 | from backend.core.api.app.services.cache import CacheService
   |
help: Remove unused import: `decimal.Decimal`

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/payment_tier_service.py:260:17
    |
258 |         if not self.is_card_payment_allowed(current_tier):
259 |             error_msg = (
260 |                 f"Card payments are not allowed for your account due to previous chargebacks. "
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
261 |                 f"Please use SEPA bank transfer for purchases. Contact support if you believe this is an error."
262 |             )
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/payment_tier_service.py:261:17
    |
259 |             error_msg = (
260 |                 f"Card payments are not allowed for your account due to previous chargebacks. "
261 |                 f"Please use SEPA bank transfer for purchases. Contact support if you believe this is an error."
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
262 |             )
263 |             logger.warning(
    |
help: Remove extraneous `f` prefix

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/core/api/app/services/payment_tier_service.py
F401 `.base.BasePDFTemplateService` imported but unused; consider removing, adding to `__all__`, or using a redundant alias
 --> backend/core/api/app/services/pdf/__init__.py:2:19
  |
1 | # Import key components to make them easily accessible from the pdf package
2 | from .base import BasePDFTemplateService
  |                   ^^^^^^^^^^^^^^^^^^^^^^
3 | from .invoice import InvoiceTemplateService
4 | from .credit_note import CreditNoteTemplateService
  |
help: Use an explicit re-export: `BasePDFTemplateService as BasePDFTemplateService`

F401 `.invoice.InvoiceTemplateService` imported but unused; consider removing, adding to `__all__`, or using a redundant alias
 --> backend/core/api/app/services/pdf/__init__.py:3:22
  |
1 | # Import key components to make them easily accessible from the pdf package
2 | from .base import BasePDFTemplateService
3 | from .invoice import InvoiceTemplateService
  |                      ^^^^^^^^^^^^^^^^^^^^^^
4 | from .credit_note import CreditNoteTemplateService
5 | from .flowables import ColoredLine
  |
help: Use an explicit re-export: `InvoiceTemplateService as InvoiceTemplateService`

F401 `.credit_note.CreditNoteTemplateService` imported but unused; consider removing, adding to `__all__`, or using a redundant alias
 --> backend/core/api/app/services/pdf/__init__.py:4:26
  |
2 | from .base import BasePDFTemplateService
3 | from .invoice import InvoiceTemplateService
4 | from .credit_note import CreditNoteTemplateService
  |                          ^^^^^^^^^^^^^^^^^^^^^^^^^
5 | from .flowables import ColoredLine
  |
help: Use an explicit re-export: `CreditNoteTemplateService as CreditNoteTemplateService`

F401 `.flowables.ColoredLine` imported but unused; consider removing, adding to `__all__`, or using a redundant alias
 --> backend/core/api/app/services/pdf/__init__.py:5:24
  |
3 | from .invoice import InvoiceTemplateService
4 | from .credit_note import CreditNoteTemplateService
5 | from .flowables import ColoredLine
  |                        ^^^^^^^^^^^
  |
help: Use an explicit re-export: `ColoredLine as ColoredLine`

Found 4 errors.
Python: error backend/core/api/app/services/pdf/__init__.py
F401 [*] `asyncio` imported but unused
 --> backend/core/api/app/services/pdf/base.py:4:8
  |
2 | import yaml
3 | import logging
4 | import asyncio # Added for async operations
  |        ^^^^^^^
5 | from dotenv import load_dotenv
6 | from reportlab.lib.pagesizes import A4
  |
help: Remove unused import: `asyncio`

F401 [*] `dotenv.load_dotenv` imported but unused
 --> backend/core/api/app/services/pdf/base.py:5:20
  |
3 | import logging
4 | import asyncio # Added for async operations
5 | from dotenv import load_dotenv
  |                    ^^^^^^^^^^^
6 | from reportlab.lib.pagesizes import A4
7 | from reportlab.lib import colors
  |
help: Remove unused import: `dotenv.load_dotenv`

F401 [*] `reportlab.lib.units.mm` imported but unused
  --> backend/core/api/app/services/pdf/base.py:9:33
   |
 7 | from reportlab.lib import colors
 8 | from reportlab.lib.styles import getSampleStyleSheet, ParagraphStyle
 9 | from reportlab.lib.units import mm, inch
   |                                 ^^
10 | from reportlab.pdfgen import canvas
11 | from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Table, TableStyle, Flowable
   |
help: Remove unused import

F401 [*] `reportlab.lib.units.inch` imported but unused
  --> backend/core/api/app/services/pdf/base.py:9:37
   |
 7 | from reportlab.lib import colors
 8 | from reportlab.lib.styles import getSampleStyleSheet, ParagraphStyle
 9 | from reportlab.lib.units import mm, inch
   |                                     ^^^^
10 | from reportlab.pdfgen import canvas
11 | from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Table, TableStyle, Flowable
   |
help: Remove unused import

F401 [*] `reportlab.pdfgen.canvas` imported but unused
  --> backend/core/api/app/services/pdf/base.py:10:30
   |
 8 | from reportlab.lib.styles import getSampleStyleSheet, ParagraphStyle
 9 | from reportlab.lib.units import mm, inch
10 | from reportlab.pdfgen import canvas
   |                              ^^^^^^
11 | from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Table, TableStyle, Flowable
12 | from reportlab.graphics.shapes import Drawing
   |
help: Remove unused import: `reportlab.pdfgen.canvas`

F401 [*] `reportlab.platypus.SimpleDocTemplate` imported but unused
  --> backend/core/api/app/services/pdf/base.py:11:32
   |
 9 | from reportlab.lib.units import mm, inch
10 | from reportlab.pdfgen import canvas
11 | from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Table, TableStyle, Flowable
   |                                ^^^^^^^^^^^^^^^^^
12 | from reportlab.graphics.shapes import Drawing
13 | from reportlab.graphics.barcode.qr import QrCodeWidget
   |
help: Remove unused import

F401 [*] `reportlab.platypus.Flowable` imported but unused
  --> backend/core/api/app/services/pdf/base.py:11:89
   |
 9 | from reportlab.lib.units import mm, inch
10 | from reportlab.pdfgen import canvas
11 | from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Table, TableStyle, Flowable
   |                                                                                         ^^^^^^^^
12 | from reportlab.graphics.shapes import Drawing
13 | from reportlab.graphics.barcode.qr import QrCodeWidget
   |
help: Remove unused import

F401 [*] `reportlab.graphics.shapes.Drawing` imported but unused
  --> backend/core/api/app/services/pdf/base.py:12:39
   |
10 | from reportlab.pdfgen import canvas
11 | from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Table, TableStyle, Flowable
12 | from reportlab.graphics.shapes import Drawing
   |                                       ^^^^^^^
13 | from reportlab.graphics.barcode.qr import QrCodeWidget
14 | from reportlab.pdfbase.ttfonts import TTFont
   |
help: Remove unused import: `reportlab.graphics.shapes.Drawing`

F401 [*] `reportlab.graphics.barcode.qr.QrCodeWidget` imported but unused
  --> backend/core/api/app/services/pdf/base.py:13:43
   |
11 | from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Table, TableStyle, Flowable
12 | from reportlab.graphics.shapes import Drawing
13 | from reportlab.graphics.barcode.qr import QrCodeWidget
   |                                           ^^^^^^^^^^^^
14 | from reportlab.pdfbase.ttfonts import TTFont
15 | from reportlab.pdfbase import pdfmetrics
   |
help: Remove unused import: `reportlab.graphics.barcode.qr.QrCodeWidget`

F401 [*] `backend.core.api.app.services.pdf.flowables.ColoredLine` imported but unused
  --> backend/core/api/app/services/pdf/base.py:20:57
   |
18 | from backend.core.api.app.services.translations import TranslationService
19 | from backend.core.api.app.services.email.config_loader import load_shared_urls
20 | from backend.core.api.app.services.pdf.flowables import ColoredLine
   |                                                         ^^^^^^^^^^^
21 | from backend.core.api.app.services.pdf.utils import (sanitize_html_for_reportlab, replace_placeholders_safely)
22 | from backend.core.api.app.utils.secrets_manager import SecretsManager # Import SecretsManager
   |
help: Remove unused import: `backend.core.api.app.services.pdf.flowables.ColoredLine`

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/pdf/base.py:118:21
    |
116 |         # Load pricing config
117 |         self.pricing_tiers = self._load_pricing_config()
118 |         logger.info(f"Loaded pricing tiers.")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^
119 |         
120 |         # Set current language to default of English
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/pdf/base.py:129:31
    |
127 |         """Performs asynchronous initialization steps."""
128 |         logger.info("Performing async initialization for BasePDFTemplateService...")
129 |         invoice_sender_path = f"kv/data/providers/invoice_sender"
    |                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
130 |         self.sender_addressline1 = await self.secrets_manager.get_secret(secret_path=invoice_sender_path, secret_key="addressline1")
131 |         self.sender_addressline2 = await self.secrets_manager.get_secret(secret_path=invoice_sender_path, secret_key="addressline2")
    |
help: Remove extraneous `f` prefix

F811 Redefinition of unused `canvas` from line 10
   --> backend/core/api/app/services/pdf/base.py:146:35
    |
144 |         return instance
145 |
146 |     def _draw_header_footer(self, canvas, doc):
    |                                   ^^^^^^ `canvas` redefined here
147 |         """Draw the colored bars at the top and bottom of the page"""
148 |         width, height = A4
    |
   ::: backend/core/api/app/services/pdf/base.py:10:30
    |
  8 | from reportlab.lib.styles import getSampleStyleSheet, ParagraphStyle
  9 | from reportlab.lib.units import mm, inch
 10 | from reportlab.pdfgen import canvas
    |                              ------ previous definition of `canvas` here
 11 | from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Table, TableStyle, Flowable
 12 | from reportlab.graphics.shapes import Drawing
    |
help: Remove definition: `canvas`

Found 13 errors.
[*] 12 fixable with the `--fix` option.
Python: error backend/core/api/app/services/pdf/base.py
F401 [*] `reportlab.lib.colors` imported but unused
 --> backend/core/api/app/services/pdf/credit_note.py:3:27
  |
1 | import io
2 | from reportlab.lib.pagesizes import A4
3 | from reportlab.lib import colors
  |                           ^^^^^^
4 | from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Table, TableStyle
5 | from reportlab.graphics.shapes import Drawing
  |
help: Remove unused import: `reportlab.lib.colors`

F401 [*] `backend.core.api.app.services.pdf.utils.replace_placeholders_safely` imported but unused
  --> backend/core/api/app/services/pdf/credit_note.py:10:83
   |
 9 | from backend.core.api.app.services.pdf.base import BasePDFTemplateService
10 | from backend.core.api.app.services.pdf.utils import (sanitize_html_for_reportlab, replace_placeholders_safely,
   |                                                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^
11 |                                    format_date_for_locale, format_credits)
   |
help: Remove unused import: `backend.core.api.app.services.pdf.utils.replace_placeholders_safely`

F841 [*] Local variable `e` is assigned to but never used
   --> backend/core/api/app/services/pdf/credit_note.py:387:29
    |
385 |             payment_table = Table([[Spacer(self.left_indent, 0), refunded_to_paragraph]], 
386 |                                  colWidths=[self.left_indent, doc.width-self.left_indent])
387 |         except Exception as e:
    |                             ^
388 |             # Fallback to plain text if HTML parsing fails
389 |             fallback_text = f"Refunded to: {credit_note_data['card_name']} card ending in {credit_note_data['card_last4']}"
    |
help: Remove assignment to unused variable `e`

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/core/api/app/services/pdf/credit_note.py
All checks passed!
Python: ok backend/core/api/app/services/pdf/flowables.py
F401 [*] `reportlab.lib.colors` imported but unused
 --> backend/core/api/app/services/pdf/invoice.py:4:27
  |
2 | import logging
3 | from reportlab.lib.pagesizes import A4
4 | from reportlab.lib import colors
  |                           ^^^^^^
5 | from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Table, TableStyle
6 | from reportlab.graphics.shapes import Drawing
  |
help: Remove unused import: `reportlab.lib.colors`

F401 [*] `backend.core.api.app.services.pdf.utils.replace_placeholders_safely` imported but unused
  --> backend/core/api/app/services/pdf/invoice.py:11:83
   |
10 | from backend.core.api.app.services.pdf.base import BasePDFTemplateService
11 | from backend.core.api.app.services.pdf.utils import (sanitize_html_for_reportlab, replace_placeholders_safely,
   |                                                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^
12 |                                    format_date_for_locale, format_credits)
13 | from backend.core.api.app.utils.secrets_manager import SecretsManager
   |
help: Remove unused import: `backend.core.api.app.services.pdf.utils.replace_placeholders_safely`

F841 [*] Local variable `e` is assigned to but never used
   --> backend/core/api/app/services/pdf/invoice.py:416:29
    |
414 |             payment_table = Table([[Spacer(self.left_indent, 0), paid_with_paragraph]], 
415 |                                  colWidths=[self.left_indent, doc.width-self.left_indent])
416 |         except Exception as e:
    |                             ^
417 |             # Fallback to plain text if HTML parsing fails
418 |             fallback_text = f"Paid with: {invoice_data['card_name']} card ending in {invoice_data['card_last4']}"
    |
help: Remove assignment to unused variable `e`

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/core/api/app/services/pdf/invoice.py
All checks passed!
Python: ok backend/core/api/app/services/pdf/support_contribution_receipt.py
All checks passed!
Python: ok backend/core/api/app/services/pdf/utils.py
All checks passed!
Python: ok backend/core/api/app/services/s3.py
All checks passed!
Python: ok backend/core/api/app/services/s3/__init__.py
F401 [*] `typing.Dict` imported but unused
  --> backend/core/api/app/services/s3/config.py:8:20
   |
 6 | import yaml
 7 | from pathlib import Path
 8 | from typing import Dict, List
   |                    ^^^^
 9 |
10 | logger = logging.getLogger(__name__)
   |
help: Remove unused import: `typing.Dict`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/services/s3/config.py
All checks passed!
Python: ok backend/core/api/app/services/s3/cors.py
F401 [*] `typing.List` imported but unused
 --> backend/core/api/app/services/s3/lifecycle.py:6:26
  |
4 | import logging
5 | from botocore.exceptions import ClientError
6 | from typing import Dict, List
  |                          ^^^^
7 |
8 | logger = logging.getLogger(__name__)
  |
help: Remove unused import: `typing.List`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/services/s3/lifecycle.py
F811 [*] Redefinition of unused `os` from line 6
  --> backend/core/api/app/services/s3/service.py:6:8
   |
 4 | import boto3
 5 | import logging
 6 | import os
   |        -- previous definition of `os` here
 7 | import time
 8 | from io import BytesIO
 9 | from fastapi import HTTPException
10 | # os import might still be needed for SERVER_ENVIRONMENT
11 | import os
   |        ^^ `os` redefined here
12 | from backend.core.api.app.utils.secrets_manager import SecretsManager # Import SecretsManager (though not used directly here, good for…
13 | from botocore.config import Config
   |
help: Remove definition: `os`

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/s3/service.py:366:25
    |
364 |                     file_obj.seek(0)
365 |             
366 |             logger.info(f"Upload successful")
    |                         ^^^^^^^^^^^^^^^^^^^^
367 |             
368 |             # Generate S3 URL
    |
help: Remove extraneous `f` prefix

F841 Local variable `bucket_config` is assigned to but never used
   --> backend/core/api/app/services/s3/service.py:402:17
    |
400 |             # Get bucket configuration
401 |             try:
402 |                 bucket_config = self.get_bucket_config(bucket_key)
    |                 ^^^^^^^^^^^^^
403 |             except ValueError:
404 |                 logger.error(f"Unknown bucket: {bucket_key}")
    |
help: Remove assignment to unused variable `bucket_config`

Found 3 errors.
[*] 2 fixable with the `--fix` option (1 hidden fix can be enabled with the `--unsafe-fixes` option).
Python: error backend/core/api/app/services/s3/service.py
All checks passed!
Python: ok backend/core/api/app/services/storage_management.py
F401 [*] `os` imported but unused
  --> backend/core/api/app/services/stripe_product_sync.py:21:8
   |
19 | from pathlib import Path
20 | import yaml
21 | import os
   |        ^^
22 |
23 | logger = logging.getLogger(__name__)
   |
help: Remove unused import: `os`

F841 Local variable `price` is assigned to but never used
   --> backend/core/api/app/services/stripe_product_sync.py:936:13
    |
935 |             # Create the price for this product
936 |             price = self.stripe_api.Price.create(
    |             ^^^^^
937 |                 product=product.id,
938 |                 unit_amount=price_cents,
    |
help: Remove assignment to unused variable `price`

F841 Local variable `price` is assigned to but never used
   --> backend/core/api/app/services/stripe_product_sync.py:988:13
    |
987 |             # Create the recurring price for this product
988 |             price = self.stripe_api.Price.create(
    |             ^^^^^
989 |                 product=product.id,
990 |                 unit_amount=price_cents,
    |
help: Remove assignment to unused variable `price`

F541 [*] f-string without any placeholders
    --> backend/core/api/app/services/stripe_product_sync.py:1483:28
     |
1482 |             # Create product name
1483 |             product_name = f"Supporter Contribution"
     |                            ^^^^^^^^^^^^^^^^^^^^^^^^^
1484 |
1485 |             # Check if product already exists
     |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
    --> backend/core/api/app/services/stripe_product_sync.py:1530:28
     |
1529 |             # Create product name
1530 |             product_name = f"Monthly Supporter Contribution"
     |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
1531 |
1532 |             # Check if product already exists
     |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
    --> backend/core/api/app/services/stripe_product_sync.py:1715:31
     |
1713 |             # Create description based on type
1714 |             if is_recurring:
1715 |                 description = f"Monthly recurring supporter contribution to help fund OpenMates development"
     |                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
1716 |             else:
1717 |                 description = f"One-time supporter contribution to help fund OpenMates development"
     |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
    --> backend/core/api/app/services/stripe_product_sync.py:1717:31
     |
1715 |                 description = f"Monthly recurring supporter contribution to help fund OpenMates development"
1716 |             else:
1717 |                 description = f"One-time supporter contribution to help fund OpenMates development"
     |                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
1718 |
1719 |             # Create the product
     |
help: Remove extraneous `f` prefix

Found 7 errors.
[*] 5 fixable with the `--fix` option (2 hidden fixes can be enabled with the `--unsafe-fixes` option).
Python: error backend/core/api/app/services/stripe_product_sync.py
F811 [*] Redefinition of unused `importlib.util` from line 23
  --> backend/core/api/app/services/test_domain_security.py:31:8
   |
29 | # Import directly from the module file to avoid triggering __init__.py imports
30 | # This prevents importing other services that may have dependency issues
31 | import importlib.util
   |        ^^^^^^^^^^^^^^ `importlib.util` redefined here
32 | domain_security_path = Path(__file__).parent / 'domain_security.py'
33 | spec = importlib.util.spec_from_file_location("domain_security", domain_security_path)
   |
  ::: backend/core/api/app/services/test_domain_security.py:23:8
   |
21 | import sys
22 | import os
23 | import importlib.util
   |        -------------- previous definition of `importlib.util` here
24 | from pathlib import Path
   |
help: Remove definition: `importlib.util`

F541 [*] f-string without any placeholders
  --> backend/core/api/app/services/test_domain_security.py:91:15
   |
90 |         # Print file paths for verification
91 |         print(f"\nFile paths:")
   |               ^^^^^^^^^^^^^^^^
92 |         print(f"  Restricted: {service.restricted_domains_path}")
93 |         print(f"  Allowed: {service.allowed_domain_path}")
   |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/test_domain_security.py:283:11
    |
282 |     # Print environment info
283 |     print(f"\nEnvironment:")
    |           ^^^^^^^^^^^^^^^^^
284 |     print(f"  Python: {sys.version}")
285 |     print(f"  Working directory: {os.getcwd()}")
    |
help: Remove extraneous `f` prefix

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/core/api/app/services/test_domain_security.py
F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/translations.py:287:29
    |
285 |             # If language file is not found or error occurs, fall back to English
286 |             if lang != "en":
287 |                 logger.info(f"Falling back to English translations")
    |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
288 |                 return self._load_raw_translations("en")
289 |             else:
    |
help: Remove extraneous `f` prefix

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/services/translations.py
F401 [*] `typing.Tuple` imported but unused
  --> backend/core/api/app/services/usage_archive_service.py:12:47
   |
10 | import gzip
11 | from datetime import datetime, timedelta
12 | from typing import Dict, Any, Optional, List, Tuple
   |                                               ^^^^^
13 | from io import BytesIO
   |
help: Remove unused import: `typing.Tuple`

F401 [*] `io.BytesIO` imported but unused
  --> backend/core/api/app/services/usage_archive_service.py:13:16
   |
11 | from datetime import datetime, timedelta
12 | from typing import Dict, Any, Optional, List, Tuple
13 | from io import BytesIO
   |                ^^^^^^^
14 |
15 | from backend.core.api.app.services.s3.service import S3UploadService
   |
help: Remove unused import: `io.BytesIO`

F541 [*] f-string without any placeholders
  --> backend/core/api/app/services/usage_archive_service.py:94:22
   |
92 |             S3 key path if successful, None otherwise
93 |         """
94 |         log_prefix = f"UsageArchiveService:"
   |                      ^^^^^^^^^^^^^^^^^^^^^^^
95 |         logger.info(f"{log_prefix} Archiving usage entries for user '{user_id_hash}', month '{year_month}'")
   |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/usage_archive_service.py:235:22
    |
233 |             summary_type: Type of summary ("chat", "app", or "api_key")
234 |         """
235 |         log_prefix = f"UsageArchiveService:"
    |                      ^^^^^^^^^^^^^^^^^^^^^^^
236 |         collection_name = f"usage_monthly_{summary_type}_summaries"
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/services/usage_archive_service.py:293:22
    |
291 |             List of decrypted usage entries (filtered if filters provided)
292 |         """
293 |         log_prefix = f"UsageArchiveService:"
    |                      ^^^^^^^^^^^^^^^^^^^^^^^
294 |         logger.info(f"{log_prefix} Retrieving archived usage for user '{user_id_hash}', month '{year_month}'")
    |
help: Remove extraneous `f` prefix

Found 5 errors.
[*] 5 fixable with the `--fix` option.
Python: error backend/core/api/app/services/usage_archive_service.py
F401 `.email_tasks.verification_email_task` imported but unused; consider removing, adding to `__all__`, or using a redundant alias
 --> backend/core/api/app/tasks/__init__.py:4:26
  |
3 | # Import tasks to ensure they are discovered by Celery
4 | from .email_tasks import verification_email_task
  |                          ^^^^^^^^^^^^^^^^^^^^^^^
5 | from .email_tasks import new_device_email_task
6 | from .email_tasks import backup_code_email_task
  |
help: Use an explicit re-export: `verification_email_task as verification_email_task`

F401 `.email_tasks.new_device_email_task` imported but unused; consider removing, adding to `__all__`, or using a redundant alias
 --> backend/core/api/app/tasks/__init__.py:5:26
  |
3 | # Import tasks to ensure they are discovered by Celery
4 | from .email_tasks import verification_email_task
5 | from .email_tasks import new_device_email_task
  |                          ^^^^^^^^^^^^^^^^^^^^^
6 | from .email_tasks import backup_code_email_task
7 | from .email_tasks import purchase_confirmation_email_task
  |
help: Use an explicit re-export: `new_device_email_task as new_device_email_task`

F401 `.email_tasks.backup_code_email_task` imported but unused; consider removing, adding to `__all__`, or using a redundant alias
 --> backend/core/api/app/tasks/__init__.py:6:26
  |
4 | from .email_tasks import verification_email_task
5 | from .email_tasks import new_device_email_task
6 | from .email_tasks import backup_code_email_task
  |                          ^^^^^^^^^^^^^^^^^^^^^^
7 | from .email_tasks import purchase_confirmation_email_task
8 | from .email_tasks import credit_note_email_task  # Import credit note email task
  |
help: Use an explicit re-export: `backup_code_email_task as backup_code_email_task`

F401 `.email_tasks.purchase_confirmation_email_task` imported but unused; consider removing, adding to `__all__`, or using a redundant alias
 --> backend/core/api/app/tasks/__init__.py:7:26
  |
5 | from .email_tasks import new_device_email_task
6 | from .email_tasks import backup_code_email_task
7 | from .email_tasks import purchase_confirmation_email_task
  |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
8 | from .email_tasks import credit_note_email_task  # Import credit note email task
9 | from .email_tasks import milestone_checker_task
  |
help: Use an explicit re-export: `purchase_confirmation_email_task as purchase_confirmation_email_task`

F401 `.email_tasks.credit_note_email_task` imported but unused; consider removing, adding to `__all__`, or using a redundant alias
  --> backend/core/api/app/tasks/__init__.py:8:26
   |
 6 | from .email_tasks import backup_code_email_task
 7 | from .email_tasks import purchase_confirmation_email_task
 8 | from .email_tasks import credit_note_email_task  # Import credit note email task
   |                          ^^^^^^^^^^^^^^^^^^^^^^
 9 | from .email_tasks import milestone_checker_task
10 | from .email_tasks import signup_milestone_email_task
   |
help: Use an explicit re-export: `credit_note_email_task as credit_note_email_task`

F401 `.email_tasks.milestone_checker_task` imported but unused; consider removing, adding to `__all__`, or using a redundant alias
  --> backend/core/api/app/tasks/__init__.py:9:26
   |
 7 | from .email_tasks import purchase_confirmation_email_task
 8 | from .email_tasks import credit_note_email_task  # Import credit note email task
 9 | from .email_tasks import milestone_checker_task
   |                          ^^^^^^^^^^^^^^^^^^^^^^
10 | from .email_tasks import signup_milestone_email_task
11 | from .email_tasks import recovery_key_email_task  # Import the new recovery key email task
   |
help: Use an explicit re-export: `milestone_checker_task as milestone_checker_task`

F401 `.email_tasks.signup_milestone_email_task` imported but unused; consider removing, adding to `__all__`, or using a redundant alias
  --> backend/core/api/app/tasks/__init__.py:10:26
   |
 8 | from .email_tasks import credit_note_email_task  # Import credit note email task
 9 | from .email_tasks import milestone_checker_task
10 | from .email_tasks import signup_milestone_email_task
   |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
11 | from .email_tasks import recovery_key_email_task  # Import the new recovery key email task
12 | from .email_tasks import newsletter_email_task  # Import newsletter email task
   |
help: Use an explicit re-export: `signup_milestone_email_task as signup_milestone_email_task`

F401 `.email_tasks.recovery_key_email_task` imported but unused; consider removing, adding to `__all__`, or using a redundant alias
  --> backend/core/api/app/tasks/__init__.py:11:26
   |
 9 | from .email_tasks import milestone_checker_task
10 | from .email_tasks import signup_milestone_email_task
11 | from .email_tasks import recovery_key_email_task  # Import the new recovery key email task
   |                          ^^^^^^^^^^^^^^^^^^^^^^^
12 | from .email_tasks import newsletter_email_task  # Import newsletter email task
13 | from .email_tasks import community_share_email_task  # Import community share notification task
   |
help: Use an explicit re-export: `recovery_key_email_task as recovery_key_email_task`

F401 `.email_tasks.newsletter_email_task` imported but unused; consider removing, adding to `__all__`, or using a redundant alias
  --> backend/core/api/app/tasks/__init__.py:12:26
   |
10 | from .email_tasks import signup_milestone_email_task
11 | from .email_tasks import recovery_key_email_task  # Import the new recovery key email task
12 | from .email_tasks import newsletter_email_task  # Import newsletter email task
   |                          ^^^^^^^^^^^^^^^^^^^^^
13 | from .email_tasks import community_share_email_task  # Import community share notification task
14 | # Keep import for any other existing task files if necessary
   |
help: Use an explicit re-export: `newsletter_email_task as newsletter_email_task`

F401 `.email_tasks.community_share_email_task` imported but unused; consider removing, adding to `__all__`, or using a redundant alias
  --> backend/core/api/app/tasks/__init__.py:13:26
   |
11 | from .email_tasks import recovery_key_email_task  # Import the new recovery key email task
12 | from .email_tasks import newsletter_email_task  # Import newsletter email task
13 | from .email_tasks import community_share_email_task  # Import community share notification task
   |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^
14 | # Keep import for any other existing task files if necessary
15 | from . import user_metrics # This one stays as it wasn't moved
   |
help: Use an explicit re-export: `community_share_email_task as community_share_email_task`

F401 `.user_metrics` imported but unused; consider removing, adding to `__all__`, or using a redundant alias
  --> backend/core/api/app/tasks/__init__.py:15:15
   |
13 | from .email_tasks import community_share_email_task  # Import community share notification task
14 | # Keep import for any other existing task files if necessary
15 | from . import user_metrics # This one stays as it wasn't moved
   |               ^^^^^^^^^^^^
16 | from . import user_cache_tasks # Ensure user_cache_tasks are discoverable
   |
help: Use an explicit re-export: `user_metrics as user_metrics`

F401 `.user_cache_tasks` imported but unused; consider removing, adding to `__all__`, or using a redundant alias
  --> backend/core/api/app/tasks/__init__.py:16:15
   |
14 | # Keep import for any other existing task files if necessary
15 | from . import user_metrics # This one stays as it wasn't moved
16 | from . import user_cache_tasks # Ensure user_cache_tasks are discoverable
   |               ^^^^^^^^^^^^^^^^
17 |
18 | # You might not need to explicitly import the tasks themselves,
   |
help: Use an explicit re-export: `user_cache_tasks as user_cache_tasks`

Found 12 errors.
Python: error backend/core/api/app/tasks/__init__.py
All checks passed!
Python: ok backend/core/api/app/tasks/base_task.py
F401 [*] `json` imported but unused
 --> backend/core/api/app/tasks/cache_eviction.py:4:8
  |
2 | import os
3 | import redis # Sync redis client for scan_iter and ttl
4 | import json
  |        ^^^^
5 | from celery import shared_task, Celery # Import Celery for beat_schedule
6 | from backend.core.api.app.tasks.celery_config import app
  |
help: Remove unused import: `json`

F401 [*] `celery.shared_task` imported but unused
 --> backend/core/api/app/tasks/cache_eviction.py:5:20
  |
3 | import redis # Sync redis client for scan_iter and ttl
4 | import json
5 | from celery import shared_task, Celery # Import Celery for beat_schedule
  |                    ^^^^^^^^^^^
6 | from backend.core.api.app.tasks.celery_config import app
7 | from backend.core.api.app.services.directus import chat_methods
  |
help: Remove unused import

F401 [*] `celery.Celery` imported but unused
 --> backend/core/api/app/tasks/cache_eviction.py:5:33
  |
3 | import redis # Sync redis client for scan_iter and ttl
4 | import json
5 | from celery import shared_task, Celery # Import Celery for beat_schedule
  |                                 ^^^^^^
6 | from backend.core.api.app.tasks.celery_config import app
7 | from backend.core.api.app.services.directus import chat_methods
  |
help: Remove unused import

F401 [*] `backend.core.api.app.services.directus.chat_methods` imported but unused
 --> backend/core/api/app/tasks/cache_eviction.py:7:52
  |
5 | from celery import shared_task, Celery # Import Celery for beat_schedule
6 | from backend.core.api.app.tasks.celery_config import app
7 | from backend.core.api.app.services.directus import chat_methods
  |                                                    ^^^^^^^^^^^^
8 | from backend.core.api.app.services.directus.directus import DirectusService # Import DirectusService class directly
9 | from backend.core.api.app.services.cache import CacheService
  |
help: Remove unused import: `backend.core.api.app.services.directus.chat_methods`

F401 [*] `backend.core.api.app.schemas.chat.ChatInDB` imported but unused
  --> backend/core/api/app/tasks/cache_eviction.py:10:47
   |
 8 | from backend.core.api.app.services.directus.directus import DirectusService # Import DirectusService class directly
 9 | from backend.core.api.app.services.cache import CacheService
10 | from backend.core.api.app.schemas.chat import ChatInDB, CachedChatVersions, CachedChatListItemData
   |                                               ^^^^^^^^
11 | import asyncio
12 | from datetime import datetime, timezone
   |
help: Remove unused import: `backend.core.api.app.schemas.chat.ChatInDB`

Found 5 errors.
[*] 5 fixable with the `--fix` option.
Python: error backend/core/api/app/tasks/cache_eviction.py
F841 [*] Local variable `e` is assigned to but never used
   --> backend/core/api/app/tasks/celery_config.py:264:29
    |
262 |             invoice_ninja_service = await InvoiceNinjaService.create(secrets_manager)
263 |             logger.info("InvoiceNinjaService initialized successfully.")
264 |         except Exception as e:
    |                             ^
265 |             logger.exception("Failed to initialize InvoiceNinjaService.")
266 |     else:
    |
help: Remove assignment to unused variable `e`

F841 [*] Local variable `e` is assigned to but never used
   --> backend/core/api/app/tasks/celery_config.py:274:29
    |
272 |             invoice_template_service = await InvoiceTemplateService.create(secrets_manager)
273 |             logger.info("InvoiceTemplateService initialized successfully.")
274 |         except Exception as e:
    |                             ^
275 |             logger.exception("Failed to initialize InvoiceTemplateService.")
276 |     else:
    |
help: Remove assignment to unused variable `e`

E402 Module level import not at top of file
   --> backend/core/api/app/tasks/celery_config.py:326:1
    |
325 | # Configure Celery Beat schedule for periodic tasks
326 | from celery.schedules import crontab
    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
327 | from datetime import timedelta
    |

E402 Module level import not at top of file
   --> backend/core/api/app/tasks/celery_config.py:327:1
    |
325 | # Configure Celery Beat schedule for periodic tasks
326 | from celery.schedules import crontab
327 | from datetime import timedelta
    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
328 |
329 | # Health check runs every 5 minutes (for providers without health endpoints)
    |

Found 4 errors.
[*] 2 fixable with the `--fix` option.
Python: error backend/core/api/app/tasks/celery_config.py
All checks passed!
Python: ok backend/core/api/app/tasks/email_tasks/__init__.py
F401 [*] `typing.Dict` imported but unused
 --> backend/core/api/app/tasks/email_tasks/backup_code_email_task.py:3:20
  |
1 | import logging
2 | import asyncio
3 | from typing import Dict, Any, Optional
  |                    ^^^^
4 | from datetime import datetime, timezone # Needed for mailto link generation
  |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
 --> backend/core/api/app/tasks/email_tasks/backup_code_email_task.py:3:26
  |
1 | import logging
2 | import asyncio
3 | from typing import Dict, Any, Optional
  |                          ^^^
4 | from datetime import datetime, timezone # Needed for mailto link generation
  |
help: Remove unused import

F401 [*] `typing.Optional` imported but unused
 --> backend/core/api/app/tasks/email_tasks/backup_code_email_task.py:3:31
  |
1 | import logging
2 | import asyncio
3 | from typing import Dict, Any, Optional
  |                               ^^^^^^^^
4 | from datetime import datetime, timezone # Needed for mailto link generation
  |
help: Remove unused import

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/core/api/app/tasks/email_tasks/backup_code_email_task.py
All checks passed!
Python: ok backend/core/api/app/tasks/email_tasks/community_share_email_task.py
F401 [*] `typing.Dict` imported but unused
 --> backend/core/api/app/tasks/email_tasks/credit_note_email_task.py:7:20
  |
5 | import asyncio
6 | from datetime import datetime, timezone
7 | from typing import Dict, Any, Optional
  |                    ^^^^
8 | import json
9 | import hashlib
  |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
 --> backend/core/api/app/tasks/email_tasks/credit_note_email_task.py:7:26
  |
5 | import asyncio
6 | from datetime import datetime, timezone
7 | from typing import Dict, Any, Optional
  |                          ^^^
8 | import json
9 | import hashlib
  |
help: Remove unused import

F401 [*] `json` imported but unused
  --> backend/core/api/app/tasks/email_tasks/credit_note_email_task.py:8:8
   |
 6 | from datetime import datetime, timezone
 7 | from typing import Dict, Any, Optional
 8 | import json
   |        ^^^^
 9 | import hashlib
10 | import uuid
   |
help: Remove unused import: `json`

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/credit_note_email_task.py:209:21
    |
207 |         }
208 |
209 |         logger.info(f"Prepared credit note data dictionary")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
210 |
211 |         # 7. Generate Credit Note PDF(s)
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/credit_note_email_task.py:213:21
    |
211 |         # 7. Generate Credit Note PDF(s)
212 |         # Always generate English version first
213 |         logger.info(f"Generating English credit note PDF")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
214 |         pdf_buffer_en = task.credit_note_template_service.generate_credit_note(
215 |             credit_note_data, lang='en', currency=currency.lower()
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/credit_note_email_task.py:222:21
    |
220 |         # Example: openmates_credit_note_2025_12_16_CN-MRRUNHO-1.pdf
221 |         credit_note_filename_en = f"openmates_credit_note_{date_str_filename}_{credit_note_number}.pdf"
222 |         logger.info(f"Generated English PDF for credit note")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
223 |
224 |         pdf_bytes_lang = None
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/credit_note_email_task.py:250:21
    |
248 |         # 8. Encrypt English PDF and Upload to S3 with unique filename
249 |         # --- Hybrid Encryption Start ---
250 |         logger.info(f"Starting hybrid encryption for credit note PDF")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
251 |
252 |         # 8a. Generate local symmetric key and nonce
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/credit_note_email_task.py:255:22
    |
253 |         aes_key = os.urandom(32)  # AES-256 key
254 |         nonce = os.urandom(12)     # AES-GCM standard nonce size
255 |         logger.debug(f"Generated local AES key and nonce")
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
256 |
257 |         # 8b. Encrypt PDF locally using AES-GCM
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/credit_note_email_task.py:260:22
    |
258 |         aesgcm = AESGCM(aes_key)
259 |         encrypted_pdf_payload = aesgcm.encrypt(nonce, pdf_bytes_en, None)  # No associated data
260 |         logger.debug(f"Locally encrypted PDF payload using AES-GCM")
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
261 |
262 |         # 8c. Encrypt (wrap) the local AES key using Vault user key
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/credit_note_email_task.py:268:26
    |
266 |         )
267 |         if not encrypted_aes_key_vault:
268 |             logger.error(f"Failed to encrypt (wrap) local AES key using Vault for user")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
269 |             raise Exception("Failed to wrap symmetric encryption key")
270 |         logger.debug(f"Wrapped local AES key using Vault user key {vault_key_id}")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/credit_note_email_task.py:355:21
    |
353 |             "currency": currency.lower()
354 |         }
355 |         logger.info(f"Prepared Directus payload for credit note")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
356 |
357 |         # 10. Create Credit Note Record in Directus
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/credit_note_email_task.py:378:21
    |
376 |             "currency": currency.upper()
377 |         }
378 |         logger.info(f"Prepared email context for credit note")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
379 |
380 |         # 12. Send Refund Confirmation Email with Attachment(s)
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/credit_note_email_task.py:411:21
    |
409 |             return False
410 |
411 |         logger.info(f"Successfully sent refund confirmation email with credit note attached.")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
412 |
413 |         # 13. Process Refund Transaction in Invoice Ninja
    |
help: Remove extraneous `f` prefix

Found 13 errors.
[*] 13 fixable with the `--fix` option.
Python: error backend/core/api/app/tasks/email_tasks/credit_note_email_task.py
F401 [*] `os` imported but unused
  --> backend/core/api/app/tasks/email_tasks/issue_report_email_task.py:11:8
   |
 9 | import logging
10 | import asyncio
11 | import os
   |        ^^
12 | from typing import Optional
   |
help: Remove unused import: `os`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/tasks/email_tasks/issue_report_email_task.py
All checks passed!
Python: ok backend/core/api/app/tasks/email_tasks/mailjet_contact_cleanup_task.py
All checks passed!
Python: ok backend/core/api/app/tasks/email_tasks/milestone_checker_task.py
F401 [*] `typing.Dict` imported but unused
 --> backend/core/api/app/tasks/email_tasks/new_device_email_task.py:3:20
  |
1 | import logging
2 | import asyncio
3 | from typing import Dict, Any, Optional
  |                    ^^^^
4 | from datetime import datetime, timezone
5 | from timezonefinder import TimezoneFinder
  |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
 --> backend/core/api/app/tasks/email_tasks/new_device_email_task.py:3:26
  |
1 | import logging
2 | import asyncio
3 | from typing import Dict, Any, Optional
  |                          ^^^
4 | from datetime import datetime, timezone
5 | from timezonefinder import TimezoneFinder
  |
help: Remove unused import

Found 2 errors.
[*] 2 fixable with the `--fix` option.
Python: error backend/core/api/app/tasks/email_tasks/new_device_email_task.py
F401 [*] `typing.Dict` imported but unused
  --> backend/core/api/app/tasks/email_tasks/newsletter_email_task.py:12:20
   |
10 | import asyncio
11 | import os
12 | from typing import Dict, Any
   |                    ^^^^
13 |
14 | # Import the Celery app
   |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
  --> backend/core/api/app/tasks/email_tasks/newsletter_email_task.py:12:26
   |
10 | import asyncio
11 | import os
12 | from typing import Dict, Any
   |                          ^^^
13 |
14 | # Import the Celery app
   |
help: Remove unused import

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/newsletter_email_task.py:217:34
    |
216 |                     unsubscribe_url = f"{base_url}/#settings/newsletter/unsubscribe/{unsubscribe_token}"
217 |                     logger.debug(f"Generated unsubscribe URL for newsletter confirmed email")
    |                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
218 |                 else:
219 |                     logger.warning(f"No unsubscribe_token found for subscriber: {hashed_email[:16]}...")
    |
help: Remove extraneous `f` prefix

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/core/api/app/tasks/email_tasks/newsletter_email_task.py
F401 [*] `typing.Dict` imported but unused
 --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:7:20
  |
5 | import asyncio
6 | from datetime import datetime, timezone
7 | from typing import Dict, Any, Optional
  |                    ^^^^
8 | import json
9 | import hashlib
  |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
 --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:7:26
  |
5 | import asyncio
6 | from datetime import datetime, timezone
7 | from typing import Dict, Any, Optional
  |                          ^^^
8 | import json
9 | import hashlib
  |
help: Remove unused import

F401 [*] `json` imported but unused
  --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:8:8
   |
 6 | from datetime import datetime, timezone
 7 | from typing import Dict, Any, Optional
 8 | import json
   |        ^^^^
 9 | import hashlib
10 | import uuid
   |
help: Remove unused import: `json`

F841 Local variable `billing_address_dict` is assigned to but never used
   --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:136:18
    |
134 |             billing_address_data = payment_method_details.get('billing_address')
135 |             if billing_address_data:
136 |                  billing_address_dict = {
    |                  ^^^^^^^^^^^^^^^^^^^^
137 |                      "street_line_1": billing_address_data.get("street_line_1"),
138 |                      "street_line_2": billing_address_data.get("street_line_2"),
    |
help: Remove assignment to unused variable `billing_address_dict`

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:187:21
    |
185 |         # Generate user_id_hash (deterministic)
186 |         user_id_hash = hashlib.sha256(user_id.encode('utf-8')).hexdigest()
187 |         logger.info(f"Generated user_id_hash for user")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
188 |
189 |         # Increment the counter for the new invoice, defaulting to 0 if None
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:330:21
    |
328 |         #     invoice_data.update({k: v for k, v in address_parts.items() if v})
329 |
330 |         logger.info(f"Prepared invoice data dictionary")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
331 |
332 |         # 7. Generate Invoice PDF(s)
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:334:21
    |
332 |         # 7. Generate Invoice PDF(s)
333 |         # Always generate English version first
334 |         logger.info(f"Generating English invoice PDF")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
335 |         pdf_buffer_en = task.invoice_template_service.generate_invoice(
336 |             invoice_data, lang='en', currency=currency_paid.lower()
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:341:21
    |
339 |         pdf_buffer_en.close()
340 |         invoice_filename_en = f"openmates_invoice_{date_str_filename}_{invoice_number}.pdf"
341 |         logger.info(f"Generated English PDF for invoice")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
342 |
343 |         pdf_bytes_lang = None
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:368:21
    |
366 |         # 8. Encrypt English PDF and Upload to S3 with unique filename
367 |         # --- Hybrid Encryption Start ---
368 |         logger.info(f"Starting hybrid encryption for PDF")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
369 |
370 |         # 8a. Generate local symmetric key and nonce
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:373:22
    |
371 |         aes_key = os.urandom(32) # AES-256 key
372 |         nonce = os.urandom(12)   # AES-GCM standard nonce size
373 |         logger.debug(f"Generated local AES key and nonce")
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
374 |
375 |         # 8b. Encrypt PDF locally using AES-GCM
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:378:22
    |
376 |         aesgcm = AESGCM(aes_key)
377 |         encrypted_pdf_payload = aesgcm.encrypt(nonce, pdf_bytes_en, None) # No associated data
378 |         logger.debug(f"Locally encrypted PDF payload using AES-GCM")
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
379 |
380 |         # 8c. Encrypt (wrap) the local AES key using Vault user key
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:387:26
    |
385 |         )
386 |         if not encrypted_aes_key_vault:
387 |             logger.error(f"Failed to encrypt (wrap) local AES key using Vault for user")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
388 |             raise Exception("Failed to wrap symmetric encryption key")
389 |         logger.debug(f"Wrapped local AES key using Vault user key {vault_key_id}")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:453:21
    |
451 |             "is_gift_card": is_gift_card  # Store gift card flag for invoice display
452 |         }
453 |         logger.info(f"Prepared Directus payload for invoice")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
454 |
455 |         # 10. Create Invoice Record in Directus (using service from BaseTask)
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:484:29
    |
482 |             )
483 |             if encrypted_new_counter:
484 |                 logger.info(f"Successfully encrypted new invoice counter for user.")
    |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
485 |                 # Update Directus
486 |                 update_payload = {"encrypted_invoice_counter": encrypted_new_counter}
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:487:29
    |
485 |                 # Update Directus
486 |                 update_payload = {"encrypted_invoice_counter": encrypted_new_counter}
487 |                 logger.info(f"Attempting to update encrypted_invoice_counter in Directus for user with new encrypted value.")
    |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
488 |                 directus_update_success = await task.directus_service.update_user(user_id, update_payload)
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:500:48
    |
498 | …             logger.info(f"Successfully updated cache for invoice_counter for user with value {new_invoice_counter}.")
499 | …         else:
500 | …             logger.warning(f"Failed to update cache for invoice_counter for user after Directus update.")
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
501 | …     except Exception as cache_err:
502 | …         logger.error(f"Error updating cache for invoice_counter for user after Directus update: {cache_err}", exc_info=True)
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:504:41
    |
502 | … logger.error(f"Error updating cache for invoice_counter for user after Directus update: {cache_err}", exc_info=True)
503 | …
504 | …gger.warning(f"Cache service not available, skipping cache update for invoice_counter for user after Directus update.")
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
505 | …
506 | …error(f"Failed to update encrypted_invoice_counter in Directus for user. Directus update call returned failure. Cache will not be up…
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:506:34
    |
504 | …ger.warning(f"Cache service not available, skipping cache update for invoice_counter for user after Directus update.")
505 | …
506 | …rror(f"Failed to update encrypted_invoice_counter in Directus for user. Directus update call returned failure. Cache will not be updated.")
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
507 | …
508 | …r(f"Failed to encrypt new invoice counter {new_invoice_counter} for user. Encryption returned None. Directus and cache will not be updated.")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:551:29
    |
549 |                 pdf_bytes_en = pdf_buffer_en.getvalue()
550 |                 pdf_buffer_en.close()
551 |                 logger.info(f"Regenerated English PDF with refund link for invoice")
    |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
552 |
553 |                 # Regenerate translated version if language is not English
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:568:29
    |
566 |                 # CRITICAL: Re-encrypt and re-upload the regenerated PDF to S3 to ensure consistency
567 |                 # The PDF sent via email must be the same as the one stored in S3 and downloaded by users
568 |                 logger.info(f"Re-encrypting and re-uploading regenerated PDF to S3 to ensure consistency")
    |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
569 |                 try:
570 |                     # Re-encrypt the regenerated PDF using the same AES key and nonce
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:574:34
    |
572 |                     aesgcm = AESGCM(aes_key)
573 |                     encrypted_pdf_payload_updated = aesgcm.encrypt(nonce, pdf_bytes_en, None)  # No associated data
574 |                     logger.debug(f"Re-encrypted regenerated PDF payload using AES-GCM")
    |                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
575 |
576 |                     # Re-upload to S3 using the same s3_object_key (overwrites the old file)
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:589:40
    |
587 | …         logger.error(f"Failed to re-upload regenerated invoice PDF to S3 for invoice {invoice_number}. Upload result: {upload_resul…
588 | …         # Don't fail the whole task, but log the error - email will still be sent with correct PDF
589 | …         logger.warning(f"Email will contain PDF with refund link, but S3 may have outdated version without refund link")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
590 | …     else:
591 | …         logger.info(f"Successfully re-uploaded encrypted invoice {s3_object_key} to S3 with updated PDF (with refund link). URL (fo…
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:595:36
    |
593 | …   logger.error(f"Error re-encrypting/re-uploading regenerated PDF to S3 for invoice {invoice_number}: {reupload_err}", exc_info=Tru…
594 | …   # Don't fail the whole task, but log the error - email will still be sent with correct PDF
595 | …   logger.warning(f"Email will contain PDF with refund link, but S3 may have outdated version without refund link")
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
596 | …
597 | …t Exception as url_err:
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:608:21
    |
606 |             "customer_portal_url": customer_portal_url  # Pass management link to email
607 |         }
608 |         logger.info(f"Prepared email context for invoice")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
609 |
610 |         # 12. Send Purchase Confirmation Email with Attachment(s)
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py:641:21
    |
639 |             return False # Indicate email sending failed
640 |
641 |         logger.info(f"Successfully sent purchase confirmation email with invoice attached.")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
642 |
643 |         # 13. Notify user via WebSocket that payment is completed (credits updated and invoice sent)
    |
help: Remove extraneous `f` prefix

Found 25 errors.
[*] 24 fixable with the `--fix` option (1 hidden fix can be enabled with the `--unsafe-fixes` option).
Python: error backend/core/api/app/tasks/email_tasks/purchase_confirmation_email_task.py
F401 [*] `typing.Dict` imported but unused
  --> backend/core/api/app/tasks/email_tasks/recovery_key_email_task.py:11:20
   |
 9 | import logging
10 | import asyncio
11 | from typing import Dict, Any, Optional
   |                    ^^^^
12 | from datetime import datetime, timezone
   |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
  --> backend/core/api/app/tasks/email_tasks/recovery_key_email_task.py:11:26
   |
 9 | import logging
10 | import asyncio
11 | from typing import Dict, Any, Optional
   |                          ^^^
12 | from datetime import datetime, timezone
   |
help: Remove unused import

F401 [*] `typing.Optional` imported but unused
  --> backend/core/api/app/tasks/email_tasks/recovery_key_email_task.py:11:31
   |
 9 | import logging
10 | import asyncio
11 | from typing import Dict, Any, Optional
   |                               ^^^^^^^^
12 | from datetime import datetime, timezone
   |
help: Remove unused import

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/core/api/app/tasks/email_tasks/recovery_key_email_task.py
All checks passed!
Python: ok backend/core/api/app/tasks/email_tasks/signup_milestone_email_task.py
F401 [*] `typing.Any` imported but unused
 --> backend/core/api/app/tasks/email_tasks/support_contribution_email_task.py:7:30
  |
5 | import asyncio
6 | from datetime import datetime, timezone
7 | from typing import Optional, Any
  |                              ^^^
8 | import hashlib
9 | import uuid
  |
help: Remove unused import: `typing.Any`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/tasks/email_tasks/support_contribution_email_task.py
F401 [*] `typing.Dict` imported but unused
 --> backend/core/api/app/tasks/email_tasks/verification_email_task.py:4:20
  |
2 | import random
3 | import asyncio
4 | from typing import Dict, Any, Optional
  |                    ^^^^
5 |
6 | # Import the Celery app
  |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
 --> backend/core/api/app/tasks/email_tasks/verification_email_task.py:4:26
  |
2 | import random
3 | import asyncio
4 | from typing import Dict, Any, Optional
  |                          ^^^
5 |
6 | # Import the Celery app
  |
help: Remove unused import

F401 [*] `typing.Optional` imported but unused
 --> backend/core/api/app/tasks/email_tasks/verification_email_task.py:4:31
  |
2 | import random
3 | import asyncio
4 | from typing import Dict, Any, Optional
  |                               ^^^^^^^^
5 |
6 | # Import the Celery app
  |
help: Remove unused import

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/core/api/app/tasks/email_tasks/verification_email_task.py
F401 [*] `typing.List` imported but unused
  --> backend/core/api/app/tasks/health_check_tasks.py:10:41
   |
 8 | import time
 9 | import os
10 | from typing import Dict, Any, Optional, List
   |                                         ^^^^
11 | import httpx
   |
help: Remove unused import: `typing.List`

F401 [*] `celery.shared_task` imported but unused
  --> backend/core/api/app/tasks/health_check_tasks.py:13:20
   |
11 | import httpx
12 |
13 | from celery import shared_task
   |                    ^^^^^^^^^^^
14 | from backend.core.api.app.tasks.celery_config import app
15 | from backend.core.api.app.services.cache import CacheService
   |
help: Remove unused import: `celery.shared_task`

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/health_check_tasks.py:204:26
    |
202 |             # But actually, for Groq API, we can use the model ID directly without provider prefix
203 |             # The health check will resolve it correctly via the server
204 |             logger.debug(f"Using 'llama-3.1-8b-instant' for Groq health check (testing model)")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
205 |             # Find a provider that uses groq server to construct the model ID
206 |             groq_provider = None
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/health_check_tasks.py:216:30
    |
214 |             else:
215 |                 # Fallback: use openai provider since Groq is typically used with OpenAI models
216 |                 logger.debug(f"Using 'openai/llama-3.1-8b-instant' for Groq health check (fallback)")
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
217 |                 return "openai/llama-3.1-8b-instant"
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/tasks/health_check_tasks.py:349:26
    |
347 |         # This model is not in provider configs, so we bypass the normal resolution
348 |         if provider_id == "groq" and "llama-3.1-8b-instant" in model_id:
349 |             logger.debug(f"Using direct Groq API call for health check with model 'llama-3.1-8b-instant'")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
350 |             # Get Groq client directly
351 |             provider_client = _get_provider_client("groq")
    |
help: Remove extraneous `f` prefix

Found 5 errors.
[*] 5 fixable with the `--fix` option.
Python: error backend/core/api/app/tasks/health_check_tasks.py
All checks passed!
Python: ok backend/core/api/app/tasks/persistence_tasks.py
F401 [*] `typing.List` imported but unused
  --> backend/core/api/app/tasks/usage_archive_tasks.py:10:20
   |
 8 | import logging
 9 | from datetime import datetime, timedelta
10 | from typing import List, Dict, Any
   |                    ^^^^
11 |
12 | from backend.core.api.app.tasks.celery_config import app
   |
help: Remove unused import

F401 [*] `typing.Dict` imported but unused
  --> backend/core/api/app/tasks/usage_archive_tasks.py:10:26
   |
 8 | import logging
 9 | from datetime import datetime, timedelta
10 | from typing import List, Dict, Any
   |                          ^^^^
11 |
12 | from backend.core.api.app.tasks.celery_config import app
   |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
  --> backend/core/api/app/tasks/usage_archive_tasks.py:10:32
   |
 8 | import logging
 9 | from datetime import datetime, timedelta
10 | from typing import List, Dict, Any
   |                                ^^^
11 |
12 | from backend.core.api.app.tasks.celery_config import app
   |
help: Remove unused import

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/core/api/app/tasks/usage_archive_tasks.py
All checks passed!
Python: ok backend/core/api/app/tasks/user_cache_tasks.py
F401 [*] `time` imported but unused
 --> backend/core/api/app/tasks/user_metrics.py:2:8
  |
1 | import logging
2 | import time
  |        ^^^^
3 | import asyncio
4 | from datetime import datetime, timedelta
  |
help: Remove unused import: `time`

F401 [*] `datetime.timedelta` imported but unused
 --> backend/core/api/app/tasks/user_metrics.py:4:32
  |
2 | import time
3 | import asyncio
4 | from datetime import datetime, timedelta
  |                                ^^^^^^^^^
5 | from backend.core.api.app.services.directus import DirectusService
6 | from backend.core.api.app.services.metrics import MetricsService
  |
help: Remove unused import: `datetime.timedelta`

F401 [*] `backend.core.api.app.services.cache.CacheService` imported but unused
 --> backend/core/api/app/tasks/user_metrics.py:7:49
  |
5 | from backend.core.api.app.services.directus import DirectusService
6 | from backend.core.api.app.services.metrics import MetricsService
7 | from backend.core.api.app.services.cache import CacheService
  |                                                 ^^^^^^^^^^^^
8 |
9 | logger = logging.getLogger(__name__)
  |
help: Remove unused import: `backend.core.api.app.services.cache.CacheService`

F841 Local variable `total_users` is assigned to but never used
  --> backend/core/api/app/tasks/user_metrics.py:19:9
   |
17 |     try:
18 |         # 1. Get count of all users (total registered)
19 |         total_users = await get_total_users(directus_service)
   |         ^^^^^^^^^^^
20 |         
21 |         # 2. Calculate daily active users (users who logged in today)
   |
help: Remove assignment to unused variable `total_users`

Found 4 errors.
[*] 3 fixable with the `--fix` option (1 hidden fix can be enabled with the `--unsafe-fixes` option).
Python: error backend/core/api/app/tasks/user_metrics.py
F541 [*] f-string without any placeholders
   --> backend/core/api/app/utils/api_key_auth.py:201:25
    |
199 | …     logger.warning(f"API key access denied (cached): Device {device_hash[:8]}... not approved for API key {api_key_id}")
200 | …     raise DeviceNotApprovedError(
201 | …         f"Device not approved. Please confirm this device in Settings > Developers > Devices before using the API key."
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
202 | …     )
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/utils/api_key_auth.py:241:25
    |
239 | …     logger.warning(f"API key access denied: Device {device_hash[:8]}... not approved for API key {api_key_id}")
240 | …     raise DeviceNotApprovedError(
241 | …         f"Device not approved. Please confirm this device in Settings > Developers > Devices before using the API key."
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
242 | …     )
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/utils/api_key_auth.py:282:25
    |
280 | …         # BLOCK API access until device is approved in web UI
281 | …         raise DeviceNotApprovedError(
282 | …             f"New device detected. Please confirm this device in Settings > Developers > Devices before using the API key."
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
283 | …         )
284 | …     else:
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/utils/api_key_auth.py:288:25
    |
286 |                     # If device record creation fails, we still block access for security
287 |                     raise DeviceNotApprovedError(
288 |                         f"Device registration failed. Please try again or contact support."
    |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
289 |                     )
290 |         except DeviceNotApprovedError:
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/utils/api_key_auth.py:297:17
    |
295 |             logger.error(f"Error checking/registering device: {e}", exc_info=True)
296 |             raise DeviceNotApprovedError(
297 |                 f"Device verification failed. Please try again or contact support."
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
298 |             )
    |
help: Remove extraneous `f` prefix

Found 5 errors.
[*] 5 fixable with the `--fix` option.
Python: error backend/core/api/app/utils/api_key_auth.py
F401 [*] `backend.core.api.app.services.directus.DirectusService` imported but unused
  --> backend/core/api/app/utils/app_settings_memories_request.py:25:52
   |
23 | from datetime import datetime
24 |
25 | from backend.core.api.app.services.directus import DirectusService
   |                                                    ^^^^^^^^^^^^^^^
26 | from backend.core.api.app.services.cache import CacheService
27 | from backend.core.api.app.routes.connection_manager import ConnectionManager
   |
help: Remove unused import: `backend.core.api.app.services.directus.DirectusService`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/utils/app_settings_memories_request.py
All checks passed!
Python: ok backend/core/api/app/utils/config_manager.py
F401 [*] `base64` imported but unused
  --> backend/core/api/app/utils/debug_encryption.py:17:8
   |
15 | import logging
16 | import json
17 | import base64
   |        ^^^^^^
18 | from typing import Optional, Dict, Any
19 | from datetime import datetime, timezone
   |
help: Remove unused import: `base64`

E722 Do not use bare `except`
   --> backend/core/api/app/utils/debug_encryption.py:178:13
    |
176 |                 sample_encrypted = encrypted_content[:30] + "..." if encrypted_content else "NONE"
177 |                 sample_format = "vault" if encrypted_content and encrypted_content.startswith("vault:v") else "other"
178 |             except:
    |             ^^^^^^
179 |                 sample_format = "invalid_json"
    |

E722 Do not use bare `except`
   --> backend/core/api/app/utils/debug_encryption.py:237:13
    |
235 |                 sample_encrypted = encrypted_content[:30] + "..." if encrypted_content else "NONE"
236 |                 sample_format = "vault" if encrypted_content and encrypted_content.startswith("vault:v") else "client_encrypted"
237 |             except:
    |             ^^^^^^
238 |                 sample_format = "invalid_json"
    |

E722 Do not use bare `except`
   --> backend/core/api/app/utils/debug_encryption.py:269:13
    |
267 |                 sample_encrypted = encrypted_content[:30] + "..." if encrypted_content else "NONE"
268 |                 sample_format = "vault" if encrypted_content and encrypted_content.startswith("vault:v") else "client_encrypted"
269 |             except:
    |             ^^^^^^
270 |                 sample_format = "invalid_json"
    |

F541 [*] f-string without any placeholders
   --> backend/core/api/app/utils/debug_encryption.py:354:15
    |
352 |         report = self.get_report()
353 |         print(f"\n{'='*80}")
354 |         print(f"ENCRYPTION DEBUG SUMMARY")
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^
355 |         print(f"{'='*80}")
356 |         print(f"User: {report['user_id']}")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/utils/debug_encryption.py:366:19
    |
364 |                 print(f"   Solution: {issue['solution']}")
365 |         else:
366 |             print(f"\n✅ No obvious issues detected")
    |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
367 |
368 |         print(f"\n{'='*80}\n")
    |
help: Remove extraneous `f` prefix

Found 6 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/core/api/app/utils/debug_encryption.py
F401 [*] `json` imported but unused
 --> backend/core/api/app/utils/device_fingerprint.py:3:8
  |
1 | # backend/core/api/app/utils/device_fingerprint.py
2 | import hashlib
3 | import json
  |        ^^^^
4 | import logging
5 | import httpx
  |
help: Remove unused import: `json`

F401 [*] `typing.List` imported but unused
 --> backend/core/api/app/utils/device_fingerprint.py:7:57
  |
5 | import httpx
6 | import ipaddress
7 | from typing import Dict, Any, Optional, Mapping, Tuple, List
  |                                                         ^^^^
8 | from fastapi import Request
9 | from functools import lru_cache
  |
help: Remove unused import: `typing.List`

F401 [*] `time` imported but unused
  --> backend/core/api/app/utils/device_fingerprint.py:10:8
   |
 8 | from fastapi import Request
 9 | from functools import lru_cache
10 | import time
   |        ^^^^
11 | import secrets # Not used anymore, but keeping for now if other parts of the codebase use it
   |
help: Remove unused import: `time`

F401 [*] `secrets` imported but unused
  --> backend/core/api/app/utils/device_fingerprint.py:11:8
   |
 9 | from functools import lru_cache
10 | import time
11 | import secrets # Not used anymore, but keeping for now if other parts of the codebase use it
   |        ^^^^^^^
12 |
13 | logger = logging.getLogger(__name__)
   |
help: Remove unused import: `secrets`

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/utils/device_fingerprint.py:149:81
    |
147 |         browser_name, browser_version, os_name, os_version, device_type = "Unknown", "Unknown", "Unknown", "Unknown", "desktop"
148 |         ua_lower = user_agent.lower()
149 |         if "mobile" in ua_lower or "iphone" in ua_lower or "android" in ua_lower: device_type = "mobile"
    |                                                                                 ^
150 |         elif "tablet" in ua_lower or "ipad" in ua_lower: device_type = "tablet"
151 |         if "firefox" in ua_lower: browser_name = "Firefox"
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/utils/device_fingerprint.py:150:56
    |
148 |         ua_lower = user_agent.lower()
149 |         if "mobile" in ua_lower or "iphone" in ua_lower or "android" in ua_lower: device_type = "mobile"
150 |         elif "tablet" in ua_lower or "ipad" in ua_lower: device_type = "tablet"
    |                                                        ^
151 |         if "firefox" in ua_lower: browser_name = "Firefox"
152 |         elif "chrome" in ua_lower: browser_name = "Chrome"
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/utils/device_fingerprint.py:151:33
    |
149 |         if "mobile" in ua_lower or "iphone" in ua_lower or "android" in ua_lower: device_type = "mobile"
150 |         elif "tablet" in ua_lower or "ipad" in ua_lower: device_type = "tablet"
151 |         if "firefox" in ua_lower: browser_name = "Firefox"
    |                                 ^
152 |         elif "chrome" in ua_lower: browser_name = "Chrome"
153 |         elif "safari" in ua_lower: browser_name = "Safari"
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/utils/device_fingerprint.py:152:34
    |
150 |         elif "tablet" in ua_lower or "ipad" in ua_lower: device_type = "tablet"
151 |         if "firefox" in ua_lower: browser_name = "Firefox"
152 |         elif "chrome" in ua_lower: browser_name = "Chrome"
    |                                  ^
153 |         elif "safari" in ua_lower: browser_name = "Safari"
154 |         if "windows" in ua_lower: os_name = "Windows"
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/utils/device_fingerprint.py:153:34
    |
151 |         if "firefox" in ua_lower: browser_name = "Firefox"
152 |         elif "chrome" in ua_lower: browser_name = "Chrome"
153 |         elif "safari" in ua_lower: browser_name = "Safari"
    |                                  ^
154 |         if "windows" in ua_lower: os_name = "Windows"
155 |         elif "mac os" in ua_lower: os_name = "MacOS"
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/utils/device_fingerprint.py:154:33
    |
152 |         elif "chrome" in ua_lower: browser_name = "Chrome"
153 |         elif "safari" in ua_lower: browser_name = "Safari"
154 |         if "windows" in ua_lower: os_name = "Windows"
    |                                 ^
155 |         elif "mac os" in ua_lower: os_name = "MacOS"
156 |         elif "linux" in ua_lower: os_name = "Linux"
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/utils/device_fingerprint.py:155:34
    |
153 |         elif "safari" in ua_lower: browser_name = "Safari"
154 |         if "windows" in ua_lower: os_name = "Windows"
155 |         elif "mac os" in ua_lower: os_name = "MacOS"
    |                                  ^
156 |         elif "linux" in ua_lower: os_name = "Linux"
157 |         elif "android" in ua_lower: os_name = "Android"
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/utils/device_fingerprint.py:156:33
    |
154 |         if "windows" in ua_lower: os_name = "Windows"
155 |         elif "mac os" in ua_lower: os_name = "MacOS"
156 |         elif "linux" in ua_lower: os_name = "Linux"
    |                                 ^
157 |         elif "android" in ua_lower: os_name = "Android"
158 |         elif "iphone" in ua_lower or "ipad" in ua_lower: os_name = "iOS"
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/utils/device_fingerprint.py:157:35
    |
155 |         elif "mac os" in ua_lower: os_name = "MacOS"
156 |         elif "linux" in ua_lower: os_name = "Linux"
157 |         elif "android" in ua_lower: os_name = "Android"
    |                                   ^
158 |         elif "iphone" in ua_lower or "ipad" in ua_lower: os_name = "iOS"
159 |         return browser_name, browser_version, os_name, os_version, device_type
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/utils/device_fingerprint.py:158:56
    |
156 |         elif "linux" in ua_lower: os_name = "Linux"
157 |         elif "android" in ua_lower: os_name = "Android"
158 |         elif "iphone" in ua_lower or "ipad" in ua_lower: os_name = "iOS"
    |                                                        ^
159 |         return browser_name, browser_version, os_name, os_version, device_type
160 |     except Exception as e:
    |

Found 14 errors.
[*] 4 fixable with the `--fix` option.
Python: error backend/core/api/app/utils/device_fingerprint.py
E701 Multiple statements on one line (colon)
   --> backend/core/api/app/utils/email_context_helpers.py:141:24
    |
139 |             os_name_raw = ua.os.family or os_name_raw
140 |
141 |             if ua.is_pc: device_type_key = "email.computer.text"
    |                        ^
142 |             elif ua.is_tablet: device_type_key = "email.tablet.text"
143 |             elif ua.is_mobile: device_type_key = "email.phone.text"
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/utils/email_context_helpers.py:142:30
    |
141 |             if ua.is_pc: device_type_key = "email.computer.text"
142 |             elif ua.is_tablet: device_type_key = "email.tablet.text"
    |                              ^
143 |             elif ua.is_mobile: device_type_key = "email.phone.text"
144 |             # Add VR/VisionOS checks if needed based on library capabilities
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/utils/email_context_helpers.py:143:30
    |
141 |             if ua.is_pc: device_type_key = "email.computer.text"
142 |             elif ua.is_tablet: device_type_key = "email.tablet.text"
143 |             elif ua.is_mobile: device_type_key = "email.phone.text"
    |                              ^
144 |             # Add VR/VisionOS checks if needed based on library capabilities
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/utils/email_context_helpers.py:147:39
    |
146 |             os_family = ua.os.family
147 |             if os_family == "Mac OS X": os_name_key, os_name_raw = "macOS", "macOS"
    |                                       ^
148 |             elif os_family == "Windows": os_name_key, os_name_raw = "Windows", "Windows"
149 |             elif os_family == "Linux": os_name_key, os_name_raw = "Linux", "Linux"
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/utils/email_context_helpers.py:148:40
    |
146 |             os_family = ua.os.family
147 |             if os_family == "Mac OS X": os_name_key, os_name_raw = "macOS", "macOS"
148 |             elif os_family == "Windows": os_name_key, os_name_raw = "Windows", "Windows"
    |                                        ^
149 |             elif os_family == "Linux": os_name_key, os_name_raw = "Linux", "Linux"
150 |             elif os_family == "Android": os_name_key, os_name_raw = "Android", "Android"
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/utils/email_context_helpers.py:149:38
    |
147 |             if os_family == "Mac OS X": os_name_key, os_name_raw = "macOS", "macOS"
148 |             elif os_family == "Windows": os_name_key, os_name_raw = "Windows", "Windows"
149 |             elif os_family == "Linux": os_name_key, os_name_raw = "Linux", "Linux"
    |                                      ^
150 |             elif os_family == "Android": os_name_key, os_name_raw = "Android", "Android"
151 |             elif os_family == "iOS": os_name_key, os_name_raw = "iOS", "iOS"
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/utils/email_context_helpers.py:150:40
    |
148 |             elif os_family == "Windows": os_name_key, os_name_raw = "Windows", "Windows"
149 |             elif os_family == "Linux": os_name_key, os_name_raw = "Linux", "Linux"
150 |             elif os_family == "Android": os_name_key, os_name_raw = "Android", "Android"
    |                                        ^
151 |             elif os_family == "iOS": os_name_key, os_name_raw = "iOS", "iOS"
152 |             elif os_family == "iPadOS": os_name_key, os_name_raw = "iPadOS", "iPadOS"
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/utils/email_context_helpers.py:151:36
    |
149 |             elif os_family == "Linux": os_name_key, os_name_raw = "Linux", "Linux"
150 |             elif os_family == "Android": os_name_key, os_name_raw = "Android", "Android"
151 |             elif os_family == "iOS": os_name_key, os_name_raw = "iOS", "iOS"
    |                                    ^
152 |             elif os_family == "iPadOS": os_name_key, os_name_raw = "iPadOS", "iPadOS"
153 |             # Add VisionOS check if needed
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/utils/email_context_helpers.py:152:39
    |
150 |             elif os_family == "Android": os_name_key, os_name_raw = "Android", "Android"
151 |             elif os_family == "iOS": os_name_key, os_name_raw = "iOS", "iOS"
152 |             elif os_family == "iPadOS": os_name_key, os_name_raw = "iPadOS", "iPadOS"
    |                                       ^
153 |             # Add VisionOS check if needed
154 |             else: os_name_key = "email.unknown_os.text"
    |

E701 Multiple statements on one line (colon)
   --> backend/core/api/app/utils/email_context_helpers.py:154:17
    |
152 |             elif os_family == "iPadOS": os_name_key, os_name_raw = "iPadOS", "iPadOS"
153 |             # Add VisionOS check if needed
154 |             else: os_name_key = "email.unknown_os.text"
    |                 ^
155 |
156 |             logger.info(f"{log_prefix}Parsed UA: OS={os_name_raw}, TypeKey={device_type_key}")
    |

F841 Local variable `mailto_subject_template` is assigned to but never used
   --> backend/core/api/app/utils/email_context_helpers.py:171:5
    |
169 |     # --- Mailto Link Generation ---
170 |     login_time = datetime.now().strftime("%Y-%m-%d %H:%M:%S UTC")
171 |     mailto_subject_template = translation_service.get_nested_translation("email.email_subject_someone_accessed_my_account.text", lang…
    |     ^^^^^^^^^^^^^^^^^^^^^^^
172 |     mailto_body_template = translation_service.get_nested_translation("email.email_body_someone_accessed_my_account_from_new_device.t…
    |
help: Remove assignment to unused variable `mailto_subject_template`

F841 Local variable `mailto_body_formatted` is assigned to but never used
   --> backend/core/api/app/utils/email_context_helpers.py:174:5
    |
172 |     mailto_body_template = translation_service.get_nested_translation("email.email_body_someone_accessed_my_account_from_new_device.t…
173 |
174 |     mailto_body_formatted = mailto_body_template.format(
    |     ^^^^^^^^^^^^^^^^^^^^^
175 |         login_time=login_time,
176 |         device_type=device_type_translated,
    |
help: Remove assignment to unused variable `mailto_body_formatted`

Found 12 errors.
No fixes available (2 hidden fixes can be enabled with the `--unsafe-fixes` option).
Python: error backend/core/api/app/utils/email_context_helpers.py
F401 [*] `typing.Union` imported but unused
  --> backend/core/api/app/utils/encryption.py:8:48
   |
 6 | import time
 7 | import hmac
 8 | from typing import Tuple, Optional, Dict, Any, Union
   |                                                ^^^^^
 9 |
10 | from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
   |
help: Remove unused import: `typing.Union`

F401 [*] `cryptography.hazmat.primitives.ciphers.Cipher` imported but unused
  --> backend/core/api/app/utils/encryption.py:10:52
   |
 8 | from typing import Tuple, Optional, Dict, Any, Union
 9 |
10 | from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
   |                                                    ^^^^^^
11 | from cryptography.hazmat.backends import default_backend
12 | from cryptography.exceptions import InvalidTag
   |
help: Remove unused import

F401 [*] `cryptography.hazmat.primitives.ciphers.algorithms` imported but unused
  --> backend/core/api/app/utils/encryption.py:10:60
   |
 8 | from typing import Tuple, Optional, Dict, Any, Union
 9 |
10 | from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
   |                                                            ^^^^^^^^^^
11 | from cryptography.hazmat.backends import default_backend
12 | from cryptography.exceptions import InvalidTag
   |
help: Remove unused import

F401 [*] `cryptography.hazmat.primitives.ciphers.modes` imported but unused
  --> backend/core/api/app/utils/encryption.py:10:72
   |
 8 | from typing import Tuple, Optional, Dict, Any, Union
 9 |
10 | from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
   |                                                                        ^^^^^
11 | from cryptography.hazmat.backends import default_backend
12 | from cryptography.exceptions import InvalidTag
   |
help: Remove unused import

F401 [*] `cryptography.hazmat.backends.default_backend` imported but unused
  --> backend/core/api/app/utils/encryption.py:11:42
   |
10 | from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
11 | from cryptography.hazmat.backends import default_backend
   |                                          ^^^^^^^^^^^^^^^
12 | from cryptography.exceptions import InvalidTag
   |
help: Remove unused import: `cryptography.hazmat.backends.default_backend`

F401 [*] `cryptography.exceptions.InvalidTag` imported but unused
  --> backend/core/api/app/utils/encryption.py:12:37
   |
10 | from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
11 | from cryptography.hazmat.backends import default_backend
12 | from cryptography.exceptions import InvalidTag
   |                                     ^^^^^^^^^^
13 |
14 | logger = logging.getLogger(__name__)
   |
help: Remove unused import: `cryptography.exceptions.InvalidTag`

F541 [*] f-string without any placeholders
   --> backend/core/api/app/utils/encryption.py:234:32
    |
232 |                 return {"data": {}}
233 |             elif response.status_code == 401:
234 |                 logger.warning(f"Vault token expired or invalid")
    |                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
235 |                 # Reset token validation cache
236 |                 self._token_valid_until = 0
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/utils/encryption.py:237:33
    |
235 |                 # Reset token validation cache
236 |                 self._token_valid_until = 0
237 |                 raise Exception(f"Vault token is expired or invalid")
    |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
238 |             elif response.status_code != 200:
239 |                 logger.error(
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/utils/encryption.py:288:34
    |
286 |                         "description": "Encryption as a service for OpenMates"
287 |                     })
288 |                     logger.debug(f"Successfully enabled transit engine")
    |                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
289 |                 except Exception as mount_error:
290 |                     # Check if it's already mounted (race condition)
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/utils/encryption.py:292:38
    |
290 |                     # Check if it's already mounted (race condition)
291 |                     if "already in use" in str(mount_error).lower():
292 |                         logger.debug(f"Transit engine was already mounted by another process")
    |                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
293 |                     else:
294 |                         raise
    |
help: Remove extraneous `f` prefix

Found 10 errors.
[*] 10 fixable with the `--fix` option.
Python: error backend/core/api/app/utils/encryption.py
F401 [*] `math` imported but unused
 --> backend/core/api/app/utils/image_generation.py:5:8
  |
3 | import base64
4 | import io
5 | import math
  |        ^^^^
6 | # import json # No longer needed
7 | from typing import Optional, Tuple
  |
help: Remove unused import: `math`

F541 [*] f-string without any placeholders
   --> backend/core/api/app/utils/image_generation.py:293:21
    |
291 |         encoded_string = base64.b64encode(image_bytes).decode('utf-8')
292 |         data_uri = f"data:image/png;base64,{encoded_string}"
293 |         logger.info(f"Successfully generated and encoded combined map preview image.")
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
294 |         return data_uri
    |
help: Remove extraneous `f` prefix

Found 2 errors.
[*] 2 fixable with the `--fix` option.
Python: error backend/core/api/app/utils/image_generation.py
All checks passed!
Python: ok backend/core/api/app/utils/internal_auth.py
All checks passed!
Python: ok backend/core/api/app/utils/invite_code.py
F401 [*] `typing.Optional` imported but unused
 --> backend/core/api/app/utils/log_filters.py:4:35
  |
2 | import logging
3 | import os
4 | from typing import Dict, Pattern, Optional
  |                                   ^^^^^^^^
5 |
6 | class SensitiveDataFilter(logging.Filter):
  |
help: Remove unused import: `typing.Optional`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/utils/log_filters.py
F401 [*] `typing.List` imported but unused
 --> backend/core/api/app/utils/log_sanitization.py:6:31
  |
4 | # chat tags, summaries, or other sensitive user data.
5 |
6 | from typing import Dict, Any, List, Optional
  |                               ^^^^
  |
help: Remove unused import

F401 [*] `typing.Optional` imported but unused
 --> backend/core/api/app/utils/log_sanitization.py:6:37
  |
4 | # chat tags, summaries, or other sensitive user data.
5 |
6 | from typing import Dict, Any, List, Optional
  |                                     ^^^^^^^^
  |
help: Remove unused import

Found 2 errors.
[*] 2 fixable with the `--fix` option.
Python: error backend/core/api/app/utils/log_sanitization.py
F401 [*] `typing.Optional` imported but unused
  --> backend/core/api/app/utils/newsletter_utils.py:11:20
   |
 9 | import base64
10 | import logging
11 | from typing import Optional
   |                    ^^^^^^^^
12 | from backend.core.api.app.services.directus import DirectusService
   |
help: Remove unused import: `typing.Optional`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/utils/newsletter_utils.py
All checks passed!
Python: ok backend/core/api/app/utils/secrets_manager.py
All checks passed!
Python: ok backend/core/api/app/utils/server_mode.py
F401 [*] `json` imported but unused
 --> backend/core/api/app/utils/setup_compliance_logging.py:5:8
  |
3 | import os
4 | from pythonjsonlogger import jsonlogger
5 | import json
  |        ^^^^
6 |
7 | def setup_compliance_logging():
  |
help: Remove unused import: `json`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/api/app/utils/setup_compliance_logging.py
F401 [*] `pythonjsonlogger.jsonlogger` imported but unused
 --> backend/core/api/app/utils/setup_logging.py:5:30
  |
3 | import os
4 | import sys
5 | from pythonjsonlogger import jsonlogger
  |                              ^^^^^^^^^^
6 | from backend.core.api.app.utils.log_filters import SensitiveDataFilter
  |
help: Remove unused import: `pythonjsonlogger.jsonlogger`

F841 [*] Local variable `e` is assigned to but never used
  --> backend/core/api/app/utils/setup_logging.py:54:38
   |
52 | try:
53 |     os.makedirs(LOGS_DIR, mode=0o777, exist_ok=True)
54 | except (OSError, PermissionError) as e:
   |                                      ^
55 |     # If we can't create the directory, we'll fall back to console-only logging
56 |     # This prevents import failures when services don't have write permissions
   |
help: Remove assignment to unused variable `e`

Found 2 errors.
[*] 2 fixable with the `--fix` option.
Python: error backend/core/api/app/utils/setup_logging.py
F401 [*] `base64` imported but unused
  --> backend/core/api/app/utils/vault_decryption_tester.py:36:8
   |
34 | import logging
35 | import json
36 | import base64
   |        ^^^^^^
37 | from typing import Optional, Dict, Any
38 | from datetime import datetime, timezone
   |
help: Remove unused import: `base64`

F541 [*] f-string without any placeholders
   --> backend/core/api/app/utils/vault_decryption_tester.py:171:25
    |
169 | …     result["decryption_success"] = False
170 | …     result["⚠️_interpretation"] = (
171 | …         f"Vault decryption returned None. "
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
172 | …         f"This means the message is likely NOT vault-encrypted (probably client-encrypted, which is expected for sync cache)"
173 | …     )
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/utils/vault_decryption_tester.py:172:25
    |
170 | …     result["⚠️_interpretation"] = (
171 | …         f"Vault decryption returned None. "
172 | …         f"This means the message is likely NOT vault-encrypted (probably client-encrypted, which is expected for sync cache)"
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
173 | …     )
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/api/app/utils/vault_decryption_tester.py:329:15
    |
327 |         """Pretty-print test results"""
328 |         print(f"\n{'='*80}")
329 |         print(f"VAULT DECRYPTION TEST RESULTS")
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
330 |         print(f"{'='*80}\n")
    |
help: Remove extraneous `f` prefix

Found 4 errors.
[*] 4 fixable with the `--fix` option.
Python: error backend/core/api/app/utils/vault_decryption_tester.py
All checks passed!
Python: ok backend/core/api/main.py
F401 [*] `datetime.datetime` imported but unused
 --> backend/core/directus/setup/setup_schemas.py:8:22
  |
6 | import requests
7 | import glob
8 | from datetime import datetime, timedelta
  |                      ^^^^^^^^
9 | from dotenv import load_dotenv
  |
help: Remove unused import

F401 [*] `datetime.timedelta` imported but unused
 --> backend/core/directus/setup/setup_schemas.py:8:32
  |
6 | import requests
7 | import glob
8 | from datetime import datetime, timedelta
  |                                ^^^^^^^^^
9 | from dotenv import load_dotenv
  |
help: Remove unused import

F541 [*] f-string without any placeholders
  --> backend/core/directus/setup/setup_schemas.py:21:7
   |
20 | # Print environment variables for debugging
21 | print(f"Environment variables loaded.")
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
22 | print(f"ADMIN_EMAIL: {'*****' if ADMIN_EMAIL else 'Not set'}")
23 | print(f"ADMIN_PASSWORD: {'*****' if ADMIN_PASSWORD else 'Not set'}")
   |
help: Remove extraneous `f` prefix

F841 [*] Local variable `e` is assigned to but never used
  --> backend/core/directus/setup/setup_schemas.py:70:29
   |
68 |                 return
69 |                 
70 |         except Exception as e:
   |                             ^
71 |             pass
   |
help: Remove assignment to unused variable `e`

F541 [*] f-string without any placeholders
   --> backend/core/directus/setup/setup_schemas.py:221:23
    |
219 |             # Ensure types are compatible (both should be uuid)
220 |             if local_data_type != related_data_type:
221 |                 print(f"Warning: Field type mismatch. Relation may fail.")
    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
222 |                 
223 |                 # Try to update field type if needed
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/directus/setup/setup_schemas.py:226:27
    |
224 |                 if (local_data_type == 'uuid' and related_data_type != 'uuid') or \
225 |                    (local_data_type != 'uuid' and related_data_type == 'uuid'):
226 |                     print(f"Attempting to fix incompatible data types...")
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
227 |         
228 |         # Prepare relation data with proper structure
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/directus/setup/setup_schemas.py:688:23
    |
686 |             # Store as admin invite code
687 |             if store_invite_code(token, invite_code, is_admin=True):
688 |                 print(f"\n==================================")
    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
689 |                 print(f"IMPORTANT: Use this invite code to create your first admin user:")
690 |                 print(f"Admin Invite Code: {invite_code}")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/directus/setup/setup_schemas.py:689:23
    |
687 |             if store_invite_code(token, invite_code, is_admin=True):
688 |                 print(f"\n==================================")
689 |                 print(f"IMPORTANT: Use this invite code to create your first admin user:")
    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
690 |                 print(f"Admin Invite Code: {invite_code}")
691 |                 print(f"This user will be granted full server admin privileges.")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/directus/setup/setup_schemas.py:691:23
    |
689 |                 print(f"IMPORTANT: Use this invite code to create your first admin user:")
690 |                 print(f"Admin Invite Code: {invite_code}")
691 |                 print(f"This user will be granted full server admin privileges.")
    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
692 |                 print(f"==================================\n")
693 |             else:
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/core/directus/setup/setup_schemas.py:692:23
    |
690 |                 print(f"Admin Invite Code: {invite_code}")
691 |                 print(f"This user will be granted full server admin privileges.")
692 |                 print(f"==================================\n")
    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
693 |             else:
694 |                 print("Failed to store admin invite code")
    |
help: Remove extraneous `f` prefix

Found 10 errors.
[*] 10 fixable with the `--fix` option.
Python: error backend/core/directus/setup/setup_schemas.py
F401 [*] `os` imported but unused
  --> backend/core/vault/setup/setup_vault.py:14:8
   |
12 | """
13 |
14 | import os
   |        ^^
15 | import asyncio
16 | import sys
   |
help: Remove unused import: `os`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/vault/setup/setup_vault.py
All checks passed!
Python: ok backend/core/vault/setup/vault_setup/__init__.py
F401 [*] `typing.Union` imported but unused
  --> backend/core/vault/setup/vault_setup/client.py:9:41
   |
 7 | import logging
 8 | import asyncio
 9 | from typing import Dict, Any, Optional, Union, Tuple
   |                                         ^^^^^
10 |
11 | logger = logging.getLogger("vault-setup.client")
   |
help: Remove unused import: `typing.Union`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/core/vault/setup/vault_setup/client.py
F401 [*] `typing.Dict` imported but unused
 --> backend/core/vault/setup/vault_setup/engines.py:6:20
  |
5 | import logging
6 | from typing import Dict, Any, Optional, List
  |                    ^^^^
7 |
8 | logger = logging.getLogger("vault-setup.engines")
  |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
 --> backend/core/vault/setup/vault_setup/engines.py:6:26
  |
5 | import logging
6 | from typing import Dict, Any, Optional, List
  |                          ^^^
7 |
8 | logger = logging.getLogger("vault-setup.engines")
  |
help: Remove unused import

F401 [*] `typing.Optional` imported but unused
 --> backend/core/vault/setup/vault_setup/engines.py:6:31
  |
5 | import logging
6 | from typing import Dict, Any, Optional, List
  |                               ^^^^^^^^
7 |
8 | logger = logging.getLogger("vault-setup.engines")
  |
help: Remove unused import

F401 [*] `typing.List` imported but unused
 --> backend/core/vault/setup/vault_setup/engines.py:6:41
  |
5 | import logging
6 | from typing import Dict, Any, Optional, List
  |                                         ^^^^
7 |
8 | logger = logging.getLogger("vault-setup.engines")
  |
help: Remove unused import

Found 4 errors.
[*] 4 fixable with the `--fix` option.
Python: error backend/core/vault/setup/vault_setup/engines.py
F401 [*] `typing.Dict` imported but unused
  --> backend/core/vault/setup/vault_setup/initialization.py:8:20
   |
 6 | import logging
 7 | import stat
 8 | from typing import Dict, Any, Optional, Tuple
   |                    ^^^^
 9 |
10 | logger = logging.getLogger("vault-setup.initialization")
   |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
  --> backend/core/vault/setup/vault_setup/initialization.py:8:26
   |
 6 | import logging
 7 | import stat
 8 | from typing import Dict, Any, Optional, Tuple
   |                          ^^^
 9 |
10 | logger = logging.getLogger("vault-setup.initialization")
   |
help: Remove unused import

Found 2 errors.
[*] 2 fixable with the `--fix` option.
Python: error backend/core/vault/setup/vault_setup/initialization.py
F401 [*] `typing.Dict` imported but unused
 --> backend/core/vault/setup/vault_setup/policies.py:6:20
  |
5 | import logging
6 | from typing import Dict, Any, Optional
  |                    ^^^^
7 |
8 | logger = logging.getLogger("vault-setup.policies")
  |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
 --> backend/core/vault/setup/vault_setup/policies.py:6:26
  |
5 | import logging
6 | from typing import Dict, Any, Optional
  |                          ^^^
7 |
8 | logger = logging.getLogger("vault-setup.policies")
  |
help: Remove unused import

F401 [*] `typing.Optional` imported but unused
 --> backend/core/vault/setup/vault_setup/policies.py:6:31
  |
5 | import logging
6 | from typing import Dict, Any, Optional
  |                               ^^^^^^^^
7 |
8 | logger = logging.getLogger("vault-setup.policies")
  |
help: Remove unused import

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/core/vault/setup/vault_setup/policies.py
F401 [*] `re` imported but unused
 --> backend/core/vault/setup/vault_setup/secrets.py:6:8
  |
5 | import os
6 | import re
  |        ^^
7 | import logging
8 | from typing import Dict, Any, List, Optional
  |
help: Remove unused import: `re`

F401 [*] `typing.Any` imported but unused
  --> backend/core/vault/setup/vault_setup/secrets.py:8:26
   |
 6 | import re
 7 | import logging
 8 | from typing import Dict, Any, List, Optional
   |                          ^^^
 9 |
10 | logger = logging.getLogger("vault-setup.secrets")
   |
help: Remove unused import

F401 [*] `typing.List` imported but unused
  --> backend/core/vault/setup/vault_setup/secrets.py:8:31
   |
 6 | import re
 7 | import logging
 8 | from typing import Dict, Any, List, Optional
   |                               ^^^^
 9 |
10 | logger = logging.getLogger("vault-setup.secrets")
   |
help: Remove unused import

E712 Avoid equality comparisons to `True`; use `...:` for truth checks
  --> backend/core/vault/setup/vault_setup/secrets.py:87:29
   |
85 | …     try:
86 | …         response = await self.client.vault_request("get", self.secrets_imported_flag_path)
87 | …         if response and response.get("data", {}).get("data", {}).get(self.secrets_imported_flag_key) == True:
   |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
88 | …             logger.info(f"Secrets migration flag '{self.secrets_imported_flag_key}' is set. Assuming migration to provider paths alr…
89 | …             return True
   |
help: Replace comparison

Found 4 errors.
[*] 3 fixable with the `--fix` option (1 hidden fix can be enabled with the `--unsafe-fixes` option).
Python: error backend/core/vault/setup/vault_setup/secrets.py
F401 [*] `typing.Dict` imported but unused
 --> backend/core/vault/setup/vault_setup/tokens.py:7:20
  |
5 | import logging
6 | import os
7 | from typing import Dict, Any, Optional
  |                    ^^^^
8 |
9 | logger = logging.getLogger("vault-setup.tokens")
  |
help: Remove unused import

F401 [*] `typing.Any` imported but unused
 --> backend/core/vault/setup/vault_setup/tokens.py:7:26
  |
5 | import logging
6 | import os
7 | from typing import Dict, Any, Optional
  |                          ^^^
8 |
9 | logger = logging.getLogger("vault-setup.tokens")
  |
help: Remove unused import

Found 2 errors.
[*] 2 fixable with the `--fix` option.
Python: error backend/core/vault/setup/vault_setup/tokens.py
All checks passed!
Python: ok backend/core/vault/setup/vault_setup/utils.py
All checks passed!
Python: ok backend/scripts/create_admin_token.py
F401 [*] `os` imported but unused
  --> backend/scripts/delete_users_without_chats.py:22:8
   |
20 | import hashlib
21 | import logging
22 | import os
   |        ^^
23 | import sys
24 | from typing import Dict, Any, List
   |
help: Remove unused import: `os`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/scripts/delete_users_without_chats.py
All checks passed!
Python: ok backend/scripts/generate_gift_card_codes.py
All checks passed!
Python: ok backend/scripts/revolut_business_register_apple_pay.py
F541 [*] f-string without any placeholders
  --> backend/scripts/revolut_business_webhook_api.py:83:26
   |
81 |         # Specific handling for 404 on GET/PUT/DELETE
82 |         if http_err.response.status_code == 404 and method.upper() in ['GET', 'PUT', 'DELETE']:
83 |              print_error(f"Webhook with the specified ID not found.")
   |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
84 |         return None
85 |     except requests.exceptions.RequestException as req_err:
   |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/scripts/revolut_business_webhook_api.py:164:27
    |
163 |         vault_key_name = VAULT_SECRET_NAMES.get(args.environment)
164 |         print_instruction(f"IMPORTANT: Copy the 'Signing Secret' above and store it securely in Vault.")
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
165 |         print_instruction(f"The Vault key name should be: {vault_key_name}")
166 |         print_instruction("If updating an existing webhook, the signing secret might remain the same, but verify.")
    |
help: Remove extraneous `f` prefix

Found 2 errors.
[*] 2 fixable with the `--fix` option.
Python: error backend/scripts/revolut_business_webhook_api.py
F401 [*] `datetime.datetime` imported but unused
  --> backend/scripts/send_newsletter.py:28:22
   |
26 | import os
27 | from typing import Dict, Any, List, Optional
28 | from datetime import datetime, timezone
   |                      ^^^^^^^^
29 |
30 | # Add the backend directory to the Python path
   |
help: Remove unused import

F401 [*] `datetime.timezone` imported but unused
  --> backend/scripts/send_newsletter.py:28:32
   |
26 | import os
27 | from typing import Dict, Any, List, Optional
28 | from datetime import datetime, timezone
   |                                ^^^^^^^^
29 |
30 | # Add the backend directory to the Python path
   |
help: Remove unused import

F841 Local variable `hashed_email` is assigned to but never used
   --> backend/scripts/send_newsletter.py:173:5
    |
171 |     """
172 |     language = subscriber.get("language", "en")
173 |     hashed_email = subscriber.get("hashed_email", "")
    |     ^^^^^^^^^^^^
174 |     
175 |     # Log subscriber info (masked for privacy)
    |
help: Remove assignment to unused variable `hashed_email`

Found 3 errors.
[*] 2 fixable with the `--fix` option (1 hidden fix can be enabled with the `--unsafe-fixes` option).
Python: error backend/scripts/send_newsletter.py
F401 [*] `hashlib` imported but unused
  --> backend/scripts/show_last_user.py:20:8
   |
18 | import asyncio
19 | import argparse
20 | import hashlib
   |        ^^^^^^^
21 | import json
22 | import logging
   |
help: Remove unused import: `hashlib`

F401 [*] `json` imported but unused
  --> backend/scripts/show_last_user.py:21:8
   |
19 | import argparse
20 | import hashlib
21 | import json
   |        ^^^^
22 | import logging
23 | import sys
   |
help: Remove unused import: `json`

F401 [*] `typing.Optional` imported but unused
  --> backend/scripts/show_last_user.py:25:37
   |
23 | import sys
24 | from datetime import datetime
25 | from typing import Dict, Any, List, Optional
   |                                     ^^^^^^^^
26 |
27 | # Add the backend directory to the Python path
   |
help: Remove unused import: `typing.Optional`

E722 Do not use bare `except`
   --> backend/scripts/show_last_user.py:169:9
    |
167 |             dt = datetime.fromisoformat(date_created.replace('Z', '+00:00'))
168 |             date_created_str = dt.strftime("%Y-%m-%d %H:%M:%S UTC")
169 |         except:
    |         ^^^^^^
170 |             date_created_str = str(date_created)
    |

E722 Do not use bare `except`
   --> backend/scripts/show_last_user.py:177:9
    |
175 |             dt = datetime.fromisoformat(last_access.replace('Z', '+00:00'))
176 |             last_access_str = dt.strftime("%Y-%m-%d %H:%M:%S UTC")
177 |         except:
    |         ^^^^^^
178 |             last_access_str = str(last_access)
    |

F541 [*] f-string without any placeholders
   --> backend/scripts/show_last_user.py:188:22
    |
186 |     else:
187 |         lines.append(f"\n{'='*80}")
188 |         lines.append(f"MOST RECENT USER")
    |                      ^^^^^^^^^^^^^^^^^^^
189 |         lines.append(f"{'='*80}")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/scripts/show_last_user.py:196:18
    |
194 |     lines.append(f"Status:         {user_data.get('status', 'N/A')}")
195 |     lines.append(f"Role:           {user_data.get('role', 'N/A')}")
196 |     lines.append(f"")
    |                  ^^^
197 |     lines.append(f"Created:        {date_created_str}")
198 |     lines.append(f"Last Access:    {last_access_str}")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/scripts/show_last_user.py:200:18
    |
198 |     lines.append(f"Last Access:    {last_access_str}")
199 |     lines.append(f"Last Online:    {user_data.get('last_online_timestamp', 'N/A')}")
200 |     lines.append(f"")
    |                  ^^^
201 |     lines.append(f"Credits:        {user_data.get('credits', 0)}")
202 |     lines.append(f"Gifted Credits: {user_data.get('gifted_credits_for_signup', 0)}")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/scripts/show_last_user.py:204:18
    |
202 |     lines.append(f"Gifted Credits: {user_data.get('gifted_credits_for_signup', 0)}")
203 |     lines.append(f"Invoice Counter: {user_data.get('invoice_counter', 0)}")
204 |     lines.append(f"")
    |                  ^^^
205 |     lines.append(f"Language:       {user_data.get('language', 'en')}")
206 |     lines.append(f"Dark Mode:      {user_data.get('darkmode', False)}")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/scripts/show_last_user.py:210:18
    |
208 |     if user_data.get('tfa_app_name'):
209 |         lines.append(f"2FA App:        {user_data.get('tfa_app_name')}")
210 |     lines.append(f"")
    |                  ^^^
211 |     lines.append(f"Account ID:     {user_data.get('account_id', 'N/A')}")
212 |     lines.append(f"Vault Key ID:   {user_data.get('vault_key_id', 'N/A')}")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/scripts/show_last_user.py:214:18
    |
212 |     lines.append(f"Vault Key ID:   {user_data.get('vault_key_id', 'N/A')}")
213 |     lines.append(f"Vault Key Ver:  {user_data.get('vault_key_version', 'N/A')}")
214 |     lines.append(f"")
    |                  ^^^
215 |     
216 |     # Subscription info
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/scripts/show_last_user.py:218:22
    |
216 |     # Subscription info
217 |     if user_data.get('stripe_customer_id') or user_data.get('stripe_subscription_id'):
218 |         lines.append(f"Subscription:")
    |                      ^^^^^^^^^^^^^^^^
219 |         lines.append(f"  Customer ID:  {user_data.get('stripe_customer_id', 'N/A')}")
220 |         lines.append(f"  Subscription: {user_data.get('stripe_subscription_id', 'N/A')}")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/scripts/show_last_user.py:225:22
    |
223 |         lines.append(f"  Currency:     {user_data.get('subscription_currency', 'N/A')}")
224 |         lines.append(f"  Next Billing: {user_data.get('next_billing_date', 'N/A')}")
225 |         lines.append(f"")
    |                      ^^^
226 |     
227 |     # Auto top-up info
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/scripts/show_last_user.py:229:22
    |
227 |     # Auto top-up info
228 |     if user_data.get('auto_topup_low_balance_enabled'):
229 |         lines.append(f"Auto Top-up:")
    |                      ^^^^^^^^^^^^^^^
230 |         lines.append(f"  Enabled:      {user_data.get('auto_topup_low_balance_enabled', False)}")
231 |         lines.append(f"  Threshold:    {user_data.get('auto_topup_low_balance_threshold', 'N/A')}")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/scripts/show_last_user.py:234:22
    |
232 |         lines.append(f"  Amount:       {user_data.get('auto_topup_low_balance_amount', 'N/A')}")
233 |         lines.append(f"  Currency:     {user_data.get('auto_topup_low_balance_currency', 'N/A')}")
234 |         lines.append(f"")
    |                      ^^^
235 |     
236 |     # Profile image
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/scripts/show_last_user.py:239:22
    |
237 |     if user_data.get('profile_image_url'):
238 |         lines.append(f"Profile Image:  {user_data.get('profile_image_url')}")
239 |         lines.append(f"")
    |                      ^^^
240 |     
241 |     # Last opened
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/scripts/show_last_user.py:244:22
    |
242 |     if user_data.get('last_opened'):
243 |         lines.append(f"Last Opened:    {user_data.get('last_opened')}")
244 |         lines.append(f"")
    |                      ^^^
245 |     
246 |     # Lookup hashes count
    |
help: Remove extraneous `f` prefix

Found 17 errors.
[*] 15 fixable with the `--fix` option.
Python: error backend/scripts/show_last_user.py
F541 [*] f-string without any placeholders
  --> backend/scripts/show_user_chats.py:86:18
   |
84 |     lines = []
85 |     lines.append(f"\n{'='*80}")
86 |     lines.append(f"CHAT INFORMATION FOR USER")
   |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
87 |     lines.append(f"{'='*80}")
88 |     lines.append(f"User ID: {user_id}")
   |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
  --> backend/scripts/show_user_chats.py:93:22
   |
92 |     if not chats:
93 |         lines.append(f"\nNo chats found for this user.")
   |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
94 |         lines.append(f"{'='*80}")
95 |         return "\n".join(lines)
   |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/scripts/show_user_chats.py:100:18
    |
 98 |     total_unread = sum(chat.get('unread_count', 0) for chat in chats)
 99 |     lines.append(f"Total Unread Messages: {total_unread}")
100 |     lines.append(f"")
    |                  ^^^
101 |     
102 |     # Show recent chats (last 10)
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/scripts/show_user_chats.py:103:18
    |
102 |     # Show recent chats (last 10)
103 |     lines.append(f"Recent Chats (showing up to 10 most recent):")
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
104 |     lines.append(f"")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/scripts/show_user_chats.py:104:18
    |
102 |     # Show recent chats (last 10)
103 |     lines.append(f"Recent Chats (showing up to 10 most recent):")
104 |     lines.append(f"")
    |                  ^^^
105 |     
106 |     for i, chat in enumerate(chats[:10], 1):
    |
help: Remove extraneous `f` prefix

E722 Do not use bare `except`
   --> backend/scripts/show_user_chats.py:123:13
    |
121 |                     dt = datetime.fromisoformat(str(ts).replace('Z', '+00:00'))
122 |                 return dt.strftime("%Y-%m-%d %H:%M:%S")
123 |             except:
    |             ^^^^^^
124 |                 return str(ts)
    |

F541 [*] f-string without any placeholders
   --> backend/scripts/show_user_chats.py:131:22
    |
129 |         lines.append(f"     Last Msg:   {format_timestamp(last_message)}")
130 |         lines.append(f"     Unread:     {unread}")
131 |         lines.append(f"")
    |                      ^^^
132 |     
133 |     if len(chats) > 10:
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/scripts/show_user_chats.py:135:22
    |
133 |     if len(chats) > 10:
134 |         lines.append(f"  ... and {len(chats) - 10} more chat(s)")
135 |         lines.append(f"")
    |                      ^^^
136 |     
137 |     lines.append(f"{'='*80}")
    |
help: Remove extraneous `f` prefix

Found 8 errors.
[*] 7 fixable with the `--fix` option.
Python: error backend/scripts/show_user_chats.py
F541 [*] f-string without any placeholders
   --> backend/scripts/show_user_stats.py:109:18
    |
107 |     lines = []
108 |     lines.append(f"\n{'='*80}")
109 |     lines.append(f"USER STATISTICS")
    |                  ^^^^^^^^^^^^^^^^^^
110 |     lines.append(f"{'='*80}")
111 |     lines.append(f"")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/scripts/show_user_stats.py:111:18
    |
109 |     lines.append(f"USER STATISTICS")
110 |     lines.append(f"{'='*80}")
111 |     lines.append(f"")
    |                  ^^^
112 |     lines.append(f"Total Users:           {stats['total_users']:,}")
113 |     lines.append(f"Admin Users:           {stats['admin_count']:,}")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/scripts/show_user_stats.py:115:18
    |
113 |     lines.append(f"Admin Users:           {stats['admin_count']:,}")
114 |     lines.append(f"Regular Users:         {stats['total_users'] - stats['admin_count']:,}")
115 |     lines.append(f"")
    |                  ^^^
116 |     lines.append(f"{'='*80}")
117 |     lines.append(f"RECENT SIGNUPS")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/scripts/show_user_stats.py:117:18
    |
115 |     lines.append(f"")
116 |     lines.append(f"{'='*80}")
117 |     lines.append(f"RECENT SIGNUPS")
    |                  ^^^^^^^^^^^^^^^^^
118 |     lines.append(f"{'='*80}")
119 |     lines.append(f"Last 24 hours:         {stats['signups_24h']:,}")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/scripts/show_user_stats.py:122:18
    |
120 |     lines.append(f"Last 7 days:           {stats['signups_7d']:,}")
121 |     lines.append(f"Last 30 days:          {stats['signups_30d']:,}")
122 |     lines.append(f"")
    |                  ^^^
123 |     lines.append(f"{'='*80}")
124 |     lines.append(f"ACTIVE USERS")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/scripts/show_user_stats.py:124:18
    |
122 |     lines.append(f"")
123 |     lines.append(f"{'='*80}")
124 |     lines.append(f"ACTIVE USERS")
    |                  ^^^^^^^^^^^^^^^
125 |     lines.append(f"{'='*80}")
126 |     lines.append(f"Last 24 hours:         {stats['active_24h']:,}")
    |
help: Remove extraneous `f` prefix

F541 [*] f-string without any placeholders
   --> backend/scripts/show_user_stats.py:129:18
    |
127 |     lines.append(f"Last 7 days:           {stats['active_7d']:,}")
128 |     lines.append(f"Last 30 days:          {stats['active_30d']:,}")
129 |     lines.append(f"")
    |                  ^^^
130 |     lines.append(f"{'='*80}")
131 |     lines.append(f"Generated: {datetime.now().strftime('%Y-%m-%d %H:%M:%S UTC')}")
    |
help: Remove extraneous `f` prefix

Found 7 errors.
[*] 7 fixable with the `--fix` option.
Python: error backend/scripts/show_user_stats.py
All checks passed!
Python: ok backend/shared/__init__.py
All checks passed!
Python: ok backend/shared/providers/__init__.py
All checks passed!
Python: ok backend/shared/providers/brave/__init__.py
F401 [*] `typing.List` imported but unused
  --> backend/shared/providers/brave/brave_search.py:17:31
   |
15 | import os
16 | import httpx
17 | from typing import Dict, Any, List, Optional
   |                               ^^^^
18 | from urllib.parse import urlencode
   |
help: Remove unused import: `typing.List`

F401 [*] `urllib.parse.urlencode` imported but unused
  --> backend/shared/providers/brave/brave_search.py:18:26
   |
16 | import httpx
17 | from typing import Dict, Any, List, Optional
18 | from urllib.parse import urlencode
   |                          ^^^^^^^^^
19 |
20 | from backend.core.api.app.utils.secrets_manager import SecretsManager
   |
help: Remove unused import: `urllib.parse.urlencode`

F841 Local variable `favicon` is assigned to but never used
   --> backend/shared/providers/brave/brave_search.py:252:21
    |
250 |                 favicon = None
251 |                 if isinstance(meta_url, dict):
252 |                     favicon = meta_url.get("favicon")
    |                     ^^^^^^^
253 |                 
254 |                 # Extract thumbnail
    |
help: Remove assignment to unused variable `favicon`

F841 Local variable `favicon` is assigned to but never used
   --> backend/shared/providers/brave/brave_search.py:421:21
    |
419 |                 favicon = None
420 |                 if isinstance(meta_url, dict):
421 |                     favicon = meta_url.get("favicon")
    |                     ^^^^^^^
422 |                 
423 |                 # Extract thumbnail
    |
help: Remove assignment to unused variable `favicon`

F841 Local variable `favicon` is assigned to but never used
   --> backend/shared/providers/brave/brave_search.py:594:21
    |
592 |                 favicon = None
593 |                 if isinstance(meta_url, dict):
594 |                     favicon = meta_url.get("favicon")
    |                     ^^^^^^^
595 |                 
596 |                 # Extract thumbnail
    |
help: Remove assignment to unused variable `favicon`

Found 5 errors.
[*] 2 fixable with the `--fix` option (3 hidden fixes can be enabled with the `--unsafe-fixes` option).
Python: error backend/shared/providers/brave/brave_search.py
All checks passed!
Python: ok backend/shared/providers/firecrawl/__init__.py
All checks passed!
Python: ok backend/shared/providers/firecrawl/firecrawl_scrape.py
All checks passed!
Python: ok backend/shared/providers/google_maps/__init__.py
F401 [*] `json` imported but unused
  --> backend/shared/providers/google_maps/google_places.py:14:8
   |
12 | # - Checked every 5 minutes via Celery Beat task
13 |
14 | import json
   |        ^^^^
15 | import logging
16 | import os
   |
help: Remove unused import: `json`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/shared/providers/google_maps/google_places.py
All checks passed!
Python: ok backend/shared/providers/youtube/__init__.py
All checks passed!
Python: ok backend/shared/providers/youtube/youtube_metadata.py
All checks passed!
Python: ok backend/shared/python_schemas/__init__.py
All checks passed!
Python: ok backend/shared/python_schemas/app_metadata_schemas.py
F401 [*] `typing.Union` imported but unused
 --> backend/shared/python_utils/billing_utils.py:7:41
  |
5 | import math
6 | import logging
7 | from typing import Dict, Any, Optional, Union
  |                                         ^^^^^
8 |
9 | logger = logging.getLogger(__name__)
  |
help: Remove unused import: `typing.Union`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error backend/shared/python_utils/billing_utils.py
All checks passed!
Python: ok backend/shared/python_utils/content_hasher.py
All checks passed!
Python: ok backend/shared/python_utils/url_normalizer.py
All checks passed!
Python: ok backend/tests/__init__.py
F401 [*] `os` imported but unused
  --> backend/tests/test_app_skills.py:11:8
   |
 9 | import json
10 | import subprocess
11 | import os
   |        ^^
12 | from pathlib import Path
13 | from typing import Dict, Any, List
   |
help: Remove unused import: `os`

F401 [*] `typing.List` imported but unused
  --> backend/tests/test_app_skills.py:13:31
   |
11 | import os
12 | from pathlib import Path
13 | from typing import Dict, Any, List
   |                               ^^^^
14 | import pytest
   |
help: Remove unused import: `typing.List`

F401 [*] `pytest` imported but unused
  --> backend/tests/test_app_skills.py:14:8
   |
12 | from pathlib import Path
13 | from typing import Dict, Any, List
14 | import pytest
   |        ^^^^^^
15 |
16 | # Test results directory (gitignored)
   |
help: Remove unused import: `pytest`

Found 3 errors.
[*] 3 fixable with the `--fix` option.
Python: error backend/tests/test_app_skills.py
F401 [*] `asyncio` imported but unused
  --> backend/tests/test_encryption_service.py:13:8
   |
12 | import pytest
13 | import asyncio
   |        ^^^^^^^
14 | import base64
15 | import os
   |
help: Remove unused import: `asyncio`

F401 [*] `tempfile` imported but unused
  --> backend/tests/test_encryption_service.py:16:8
   |
14 | import base64
15 | import os
16 | import tempfile
   |        ^^^^^^^^
17 | from unittest.mock import AsyncMock, MagicMock, patch, mock_open
18 | from cryptography.exceptions import InvalidTag
   |
help: Remove unused import: `tempfile`

F401 [*] `unittest.mock.AsyncMock` imported but unused
  --> backend/tests/test_encryption_service.py:17:27
   |
15 | import os
16 | import tempfile
17 | from unittest.mock import AsyncMock, MagicMock, patch, mock_open
   |                           ^^^^^^^^^
18 | from cryptography.exceptions import InvalidTag
   |
help: Remove unused import: `unittest.mock.AsyncMock`

F401 [*] `cryptography.exceptions.InvalidTag` imported but unused
  --> backend/tests/test_encryption_service.py:18:37
   |
16 | import tempfile
17 | from unittest.mock import AsyncMock, MagicMock, patch, mock_open
18 | from cryptography.exceptions import InvalidTag
   |                                     ^^^^^^^^^^
19 |
20 | # Import the encryption service
   |
help: Remove unused import: `cryptography.exceptions.InvalidTag`

F841 Local variable `result` is assigned to but never used
   --> backend/tests/test_encryption_service.py:270:17
    |
269 |             with patch.object(encryption_service, '_vault_request', return_value=mock_vault_response) as mock_request:
270 |                 result = await encryption_service.decrypt(ciphertext, key_name, context)
    |                 ^^^^^^
271 |                 
272 |                 # Verify context was included in request
    |
help: Remove assignment to unused variable `result`

F841 Local variable `result` is assigned to but never used
   --> backend/tests/test_encryption_service.py:325:17
    |
324 |             with patch.object(encryption_service, 'decrypt', return_value="decrypted data") as mock_decrypt:
325 |                 result = await encryption_service.decrypt_with_user_key(ciphertext, key_id)
    |                 ^^^^^^
326 |                 
327 |                 # Verify decrypt was called with correct parameters
    |
help: Remove assignment to unused variable `result`

Found 6 errors.
[*] 4 fixable with the `--fix` option (2 hidden fixes can be enabled with the `--unsafe-fixes` option).
Python: error backend/tests/test_encryption_service.py
F401 [*] `unittest.mock.patch` imported but unused
  --> backend/tests/test_integration_encryption.py:17:27
   |
15 | import json
16 | import base64
17 | from unittest.mock import patch, MagicMock
   |                           ^^^^^
18 | import sys
   |
help: Remove unused import

F401 [*] `unittest.mock.MagicMock` imported but unused
  --> backend/tests/test_integration_encryption.py:17:34
   |
15 | import json
16 | import base64
17 | from unittest.mock import patch, MagicMock
   |                                  ^^^^^^^^^
18 | import sys
   |
help: Remove unused import

F841 Local variable `password` is assigned to but never used
  --> backend/tests/test_integration_encryption.py:58:9
   |
56 |         # Simulate user registration
57 |         email = "integration@test.com"
58 |         password = "secure-password-123"
   |         ^^^^^^^^
59 |         
60 |         # 1. Hash email for lookup
   |
help: Remove assignment to unused variable `password`

F841 Local variable `email_salt` is assigned to but never used
  --> backend/tests/test_integration_encryption.py:89:13
   |
88 |             # Generate email encryption key
89 |             email_salt = nacl.utils.random(16)
   |             ^^^^^^^^^^
90 |             email_key = nacl.utils.random(32)
   |
help: Remove assignment to unused variable `email_salt`

F841 Local variable `chat_id` is assigned to but never used
   --> backend/tests/test_integration_encryption.py:120:9
    |
119 |         # 2. Simulate chat creation
120 |         chat_id = "chat-integration-test-123"
    |         ^^^^^^^
121 |         chat_title = "Integration Test Chat"
    |
help: Remove assignment to unused variable `chat_id`

F841 Local variable `decrypted` is assigned to but never used
   --> backend/tests/test_integration_encryption.py:385:17
    |
383 |             start_time = time.time()
384 |             for _ in range(iterations):
385 |                 decrypted = await encryption_service.decrypt_with_user_key(encrypted, user_key_id)
    |                 ^^^^^^^^^
386 |             decryption_time = time.time() - start_time
    |
help: Remove assignment to unused variable `decrypted`

Found 6 errors.
[*] 2 fixable with the `--fix` option (4 hidden fixes can be enabled with the `--unsafe-fixes` option).
Python: error backend/tests/test_integration_encryption.py
E402 Module level import not at top of file
  --> backend/tests/test_url_validator.py:14:1
   |
12 |   sys.path.insert(0, str(backend_dir))
13 |
14 | / from apps.ai.processing.url_validator import (
15 | |     extract_urls_from_markdown,
16 | |     check_url_status,
17 | |     validate_urls_in_paragraph
18 | | )
   | |_^
   |

Found 1 error.
Python: error backend/tests/test_url_validator.py
All checks passed!
Python: ok changes_report.py
E701 Multiple statements on one line (colon)
   --> project_overview.py:185:40
    |
183 |     try:
184 |         file_info = get_file_info(file_path)
185 |         with open(file_path, 'rb') as f: source_code = f.read()
    |                                        ^
186 |         
187 |         analysis = {}
    |

E701 Multiple statements on one line (colon)
   --> project_overview.py:204:57
    |
202 | def get_file_info(file_path):
203 |     try:
204 |         with open(file_path, 'r', encoding='utf-8') as f: content = f.read()
    |                                                         ^
205 |         return {'lines': len(content.splitlines()), 'size_bytes': len(content.encode('utf-8'))}
206 |     except Exception: return {'lines': 0, 'size_bytes': 0}
    |

E701 Multiple statements on one line (colon)
   --> project_overview.py:206:21
    |
204 |         with open(file_path, 'r', encoding='utf-8') as f: content = f.read()
205 |         return {'lines': len(content.splitlines()), 'size_bytes': len(content.encode('utf-8'))}
206 |     except Exception: return {'lines': 0, 'size_bytes': 0}
    |                     ^
207 |
208 | def load_ignore_rules(root_path):
    |

E701 Multiple statements on one line (colon)
   --> project_overview.py:265:24
    |
263 |         rel_path = os.path.normpath(os.path.relpath(file_path, root_path))
264 |         analysis = analyze_file_structure(file_path, rel_path)
265 |         if not analysis: continue
    |                        ^
266 |         
267 |         # Aggregate summary data
    |

E701 Multiple statements on one line (colon)
   --> project_overview.py:282:54
    |
280 |         file_lang_map[rel_path] = lang
281 |         if lang in symbol_maps:
282 |             for name in analysis.get('functions', {}): symbol_maps[lang][name] = rel_path
    |                                                      ^
283 |             for name in analysis.get('classes', {}): symbol_maps[lang][name] = rel_path
    |

E701 Multiple statements on one line (colon)
   --> project_overview.py:283:52
    |
281 |         if lang in symbol_maps:
282 |             for name in analysis.get('functions', {}): symbol_maps[lang][name] = rel_path
283 |             for name in analysis.get('classes', {}): symbol_maps[lang][name] = rel_path
    |                                                    ^
284 |         
285 |         path_parts = rel_path.split(os.sep)
    |

E701 Multiple statements on one line (colon)
   --> project_overview.py:303:33
    |
302 |         searchable_symbols = set()
303 |         if user_lang == 'python': searchable_symbols = py_symbols
    |                                 ^
304 |         elif user_lang in ['typescript', 'javascript', 'svelte']: searchable_symbols = ts_js_symbols
305 |         if not searchable_symbols: continue
    |

E701 Multiple statements on one line (colon)
   --> project_overview.py:304:65
    |
302 |         searchable_symbols = set()
303 |         if user_lang == 'python': searchable_symbols = py_symbols
304 |         elif user_lang in ['typescript', 'javascript', 'svelte']: searchable_symbols = ts_js_symbols
    |                                                                 ^
305 |         if not searchable_symbols: continue
    |

E701 Multiple statements on one line (colon)
   --> project_overview.py:305:34
    |
303 |         if user_lang == 'python': searchable_symbols = py_symbols
304 |         elif user_lang in ['typescript', 'javascript', 'svelte']: searchable_symbols = ts_js_symbols
305 |         if not searchable_symbols: continue
    |                                  ^
306 |
307 |         try:
    |

E701 Multiple statements on one line (colon)
   --> project_overview.py:308:66
    |
307 |         try:
308 |             with open(user_file_path, 'r', encoding='utf-8') as f: content = f.read()
    |                                                                  ^
309 |         except (IOError, UnicodeDecodeError): continue
    |

E701 Multiple statements on one line (colon)
   --> project_overview.py:309:45
    |
307 |         try:
308 |             with open(user_file_path, 'r', encoding='utf-8') as f: content = f.read()
309 |         except (IOError, UnicodeDecodeError): continue
    |                                             ^
310 |
311 |         words_in_file = set(word_regex.findall(content))
    |

Found 11 errors.
Python: error project_overview.py
F401 [*] `re` imported but unused
  --> scripts/check_og_tags.py:14:8
   |
13 | import sys
14 | import re
   |        ^^
15 | from urllib.request import Request, urlopen
16 | from urllib.error import URLError, HTTPError
   |
help: Remove unused import: `re`

Found 1 error.
[*] 1 fixable with the `--fix` option.
Python: error scripts/check_og_tags.py
TypeScript: errors in frontend/packages/ui (changed files only)
src/components/enter_message/extensions/MarkdownExtensions.ts(152,9): error TS2322: Type 'string' is not assignable to type 'PluginKey<any>'.
src/components/enter_message/extensions/embed_renderers/GroupRenderer.stories.ts(1,37): error TS2307: Cannot find module '@storybook/svelte' or its corresponding type declarations.
src/components/enter_message/extensions/embed_renderers/GroupRenderer.stories.ts(3,42): error TS2307: Cannot find module '../../../../../message_parsing/types' or its corresponding type declarations.
src/i18n/setup.ts(2,25): error TS2307: Cannot find module '$app/environment' or its corresponding type declarations.
src/i18n/translations.ts(3,25): error TS2307: Cannot find module '$app/environment' or its corresponding type declarations.
src/message_parsing/__tests__/parse_message.test.ts(5,25): error TS2459: Module '"../parse_message"' declares 'parseEmbedNodes' locally, but it is not exported.
src/message_parsing/__tests__/parse_message.test.ts(5,42): error TS2459: Module '"../parse_message"' declares 'handleStreamingSemantics' locally, but it is not exported.
src/message_parsing/__tests__/parse_message.test.ts(5,68): error TS2459: Module '"../parse_message"' declares 'enhanceDocumentWithEmbeds' locally, but it is not exported.
src/message_parsing/test_runner.ts(4,25): error TS2459: Module '"./parse_message"' declares 'parseEmbedNodes' locally, but it is not exported.
src/message_parsing/test_runner.ts(4,42): error TS2459: Module '"./parse_message"' declares 'handleStreamingSemantics' locally, but it is not exported.
src/services/__tests__/db.test.ts(132,69): error TS2345: Argument of type 'string' is not assignable to parameter of type 'Promise<string>'.
src/services/__tests__/db.test.ts(133,69): error TS2345: Argument of type 'string' is not assignable to parameter of type 'Promise<string>'.
src/services/__tests__/db.test.ts(135,67): error TS2345: Argument of type 'string' is not assignable to parameter of type 'Promise<string>'.
src/services/__tests__/db.test.ts(136,67): error TS2345: Argument of type 'string' is not assignable to parameter of type 'Promise<string>'.
src/services/__tests__/db.test.ts(137,72): error TS2345: Argument of type 'string' is not assignable to parameter of type 'Promise<string>'.
src/services/__tests__/db.test.ts(138,72): error TS2345: Argument of type 'string[]' is not assignable to parameter of type 'Promise<any[]>'.
src/services/__tests__/db.test.ts(139,76): error TS2345: Argument of type 'string' is not assignable to parameter of type 'Promise<string>'.
src/services/__tests__/db.test.ts(140,76): error TS2345: Argument of type 'Uint8Array<ArrayBuffer>' is not assignable to parameter of type 'Promise<Uint8Array<ArrayBufferLike>>'.
src/services/__tests__/db.test.ts(179,9): error TS2353: Object literal may only specify known properties, and 'mates' does not exist in type 'Chat'.
src/services/__tests__/db.test.ts(240,11): error TS2353: Object literal may only specify known properties, and 'mates' does not exist in type 'Chat'.
src/services/__tests__/db.test.ts(299,9): error TS2322: Type '{ type: string; content: { type: string; content: { type: string; text: string; }[]; }[]; }' is not assignable to type 'string'.
src/services/__tests__/db.test.ts(311,33): error TS2339: Property 'content' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(312,33): error TS2339: Property 'encrypted_content' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(322,33): error TS2339: Property 'sender_name' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(323,33): error TS2339: Property 'encrypted_sender_name' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(333,33): error TS2339: Property 'category' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(334,33): error TS2339: Property 'encrypted_category' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(350,33): error TS2339: Property 'encrypted_sender_name' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(351,33): error TS2339: Property 'encrypted_category' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(383,33): error TS2339: Property 'content' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(384,33): error TS2339: Property 'encrypted_content' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(394,33): error TS2339: Property 'sender_name' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(395,33): error TS2339: Property 'encrypted_sender_name' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(405,33): error TS2339: Property 'category' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(406,33): error TS2339: Property 'encrypted_category' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(423,33): error TS2339: Property 'content' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(424,33): error TS2339: Property 'sender_name' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(425,33): error TS2339: Property 'category' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(434,33): error TS2339: Property 'content' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(435,33): error TS2339: Property 'sender_name' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(436,33): error TS2339: Property 'category' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(444,33): error TS2339: Property 'content' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(445,33): error TS2339: Property 'sender_name' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(446,33): error TS2339: Property 'category' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(450,71): error TS2345: Argument of type 'string' is not assignable to parameter of type 'Promise<string>'.
src/services/__tests__/db.test.ts(457,33): error TS2339: Property 'content' does not exist on type 'Promise<Message>'.
src/services/__tests__/db.test.ts(528,9): error TS2353: Object literal may only specify known properties, and 'mates' does not exist in type 'Chat'.
src/services/__tests__/db.test.ts(591,24): error TS2339: Property 'mates' does not exist on type 'Chat'.
src/services/__tests__/db.test.ts(660,11): error TS2322: Type '{ type: string; content: undefined[]; }' is not assignable to type 'string'.
src/services/__tests__/db.test.ts(759,9): error TS2353: Object literal may only specify known properties, and 'mates' does not exist in type 'Chat'.
./scripts/lint_changed.sh: line 107: printf: write error: Input/output error
